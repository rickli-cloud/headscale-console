var hA=Object.create;var AA=Object.defineProperty;var EA=Object.getOwnPropertyDescriptor;var uA=Object.getOwnPropertyNames,tA=Object.getOwnPropertySymbols,mA=Object.getPrototypeOf,iA=Object.prototype.hasOwnProperty,vA=Object.prototype.propertyIsEnumerable;var PA=(w,G,N)=>G in w?AA(w,G,{enumerable:!0,configurable:!0,writable:!0,value:N}):w[G]=N,rA=(w,G)=>{for(var N in G||(G={}))iA.call(G,N)&&PA(w,N,G[N]);if(tA)for(var N of tA(G))vA.call(G,N)&&PA(w,N,G[N]);return w};var BA=(w,G)=>()=>(G||w((G={exports:{}}).exports,G),G.exports);var XA=(w,G,N,U)=>{if(G&&typeof G=="object"||typeof G=="function")for(let S of uA(G))!iA.call(w,S)&&S!==N&&AA(w,S,{get:()=>G[S],enumerable:!(U=EA(G,S))||U.enumerable});return w};var jA=(w,G,N)=>(N=w!=null?hA(mA(w)):{},XA(G||!w||!w.__esModule?AA(N,"default",{value:w,enumerable:!0}):N,w));var aA=BA((Y,$A)=>{(function(w,G){if(typeof Y=="object"&&typeof $A=="object")$A.exports=G();else if(typeof define=="function"&&define.amd)define([],G);else{var N=G();for(var U in N)(typeof Y=="object"?Y:w)[U]=N[U]}})(self,function(){return(()=>{"use strict";var w={4567:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.AccessibilityManager=void 0;let r=P(9042),s=P(6114),o=P(9924),a=P(3656),l=P(844),c=P(5596),$=P(9631);class A extends l.Disposable{constructor(k,B){super(),this._terminal=k,this._renderService=B,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let t=0;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);if(this._topBoundaryFocusListener=t=>this._handleBoundaryFocus(t,0),this._bottomBoundaryFocusListener=t=>this._handleBoundaryFocus(t,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new o.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize(t=>this._handleResize(t.rows))),this.register(this._terminal.onRender(t=>this._refreshRows(t.start,t.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(t=>this._handleChar(t))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(t=>this._handleTab(t))),this.register(this._terminal.onKey(t=>this._handleKey(t.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new c.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,a.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this.register((0,l.toDisposable)(()=>{(0,$.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0}))}_handleBoundaryFocus(k,B){let t=k.target,n=this._rowElements[B===0?1:this._rowElements.length-2];if(t.getAttribute("aria-posinset")===(B===0?"1":`${this._terminal.buffer.lines.length}`)||k.relatedTarget!==n)return;let p,h;if(B===0?(p=t,h=this._rowElements.pop(),this._rowContainer.removeChild(h)):(p=this._rowElements.shift(),h=t,this._rowContainer.removeChild(p)),p.removeEventListener("focus",this._topBoundaryFocusListener),h.removeEventListener("focus",this._bottomBoundaryFocusListener),B===0){let i=this._createAccessibilityTreeNode();this._rowElements.unshift(i),this._rowContainer.insertAdjacentElement("afterbegin",i)}else{let i=this._createAccessibilityTreeNode();this._rowElements.push(i),this._rowContainer.appendChild(i)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(B===0?-1:1),this._rowElements[B===0?1:this._rowElements.length-2].focus(),k.preventDefault(),k.stopImmediatePropagation()}_handleResize(k){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let B=this._rowContainer.children.length;B<this._terminal.rows;B++)this._rowElements[B]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[B]);for(;this._rowElements.length>k;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let k=document.createElement("div");return k.setAttribute("role","listitem"),k.tabIndex=-1,this._refreshRowDimensions(k),k}_handleTab(k){for(let B=0;B<k;B++)this._handleChar(" ")}_handleChar(k){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==k&&(this._charsToAnnounce+=k):this._charsToAnnounce+=k,k===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=r.tooMuchOutput)),s.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,s.isMac&&(0,$.removeElementFromParent)(this._liveRegion)}_handleKey(k){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(k)||this._charsToConsume.push(k)}_refreshRows(k,B){this._renderRowsDebouncer.refresh(k,B,this._terminal.rows)}_renderRows(k,B){let t=this._terminal.buffer,n=t.lines.length.toString();for(let p=k;p<=B;p++){let h=t.translateBufferLineToString(t.ydisp+p,!0),i=(t.ydisp+p+1).toString(),g=this._rowElements[p];g&&(h.length===0?g.innerText="\xA0":g.textContent=h,g.setAttribute("aria-posinset",i),g.setAttribute("aria-setsize",n))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let k=0;k<this._terminal.rows;k++)this._refreshRowDimensions(this._rowElements[k])}}_refreshRowDimensions(k){k.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}j.AccessibilityManager=A},3614:(S,j)=>{function P(a){return a.replace(/\r?\n/g,"\r")}function r(a,l){return l?"\x1B[200~"+a+"\x1B[201~":a}function s(a,l,c){a=r(a=P(a),c.decPrivateModes.bracketedPasteMode),c.triggerDataEvent(a,!0),l.value=""}function o(a,l,c){let $=c.getBoundingClientRect(),A=a.clientX-$.left-10,e=a.clientY-$.top-10;l.style.width="20px",l.style.height="20px",l.style.left=`${A}px`,l.style.top=`${e}px`,l.style.zIndex="1000",l.focus()}Object.defineProperty(j,"__esModule",{value:!0}),j.rightClickHandler=j.moveTextAreaUnderMouseCursor=j.paste=j.handlePasteEvent=j.copyHandler=j.bracketTextForPaste=j.prepareTextForTerminal=void 0,j.prepareTextForTerminal=P,j.bracketTextForPaste=r,j.copyHandler=function(a,l){a.clipboardData&&a.clipboardData.setData("text/plain",l.selectionText),a.preventDefault()},j.handlePasteEvent=function(a,l,c){a.stopPropagation(),a.clipboardData&&s(a.clipboardData.getData("text/plain"),l,c)},j.paste=s,j.moveTextAreaUnderMouseCursor=o,j.rightClickHandler=function(a,l,c,$,A){o(a,l,c),A&&$.rightClickSelect(a),l.value=$.selectionText,l.select()}},7239:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.ColorContrastCache=void 0;let r=P(1505);j.ColorContrastCache=class{constructor(){this._color=new r.TwoKeyMap,this._css=new r.TwoKeyMap}setCss(s,o,a){this._css.set(s,o,a)}getCss(s,o){return this._css.get(s,o)}setColor(s,o,a){this._color.set(s,o,a)}getColor(s,o){return this._color.get(s,o)}clear(){this._color.clear(),this._css.clear()}}},9631:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.removeElementFromParent=void 0,j.removeElementFromParent=function(...P){var r;for(let s of P)(r=s==null?void 0:s.parentElement)===null||r===void 0||r.removeChild(s)}},3656:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.addDisposableDomListener=void 0,j.addDisposableDomListener=function(P,r,s,o){P.addEventListener(r,s,o);let a=!1;return{dispose:()=>{a||(a=!0,P.removeEventListener(r,s,o))}}}},6465:function(S,j,P){var r=this&&this.__decorate||function(A,e,k,B){var t,n=arguments.length,p=n<3?e:B===null?B=Object.getOwnPropertyDescriptor(e,k):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(A,e,k,B);else for(var h=A.length-1;h>=0;h--)(t=A[h])&&(p=(n<3?t(p):n>3?t(e,k,p):t(e,k))||p);return n>3&&p&&Object.defineProperty(e,k,p),p},s=this&&this.__param||function(A,e){return function(k,B){e(k,B,A)}};Object.defineProperty(j,"__esModule",{value:!0}),j.Linkifier2=void 0;let o=P(2585),a=P(8460),l=P(844),c=P(3656),$=class extends l.Disposable{constructor(A){super(),this._bufferService=A,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new a.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new a.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,l.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,l.toDisposable)(()=>{this._lastMouseEvent=void 0}))}get currentLink(){return this._currentLink}registerLinkProvider(A){return this._linkProviders.push(A),{dispose:()=>{let e=this._linkProviders.indexOf(A);e!==-1&&this._linkProviders.splice(e,1)}}}attachToDom(A,e,k){this._element=A,this._mouseService=e,this._renderService=k,this.register((0,c.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,c.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,c.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(A){if(this._lastMouseEvent=A,!this._element||!this._mouseService)return;let e=this._positionFromMouseEvent(A,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;let k=A.composedPath();for(let B=0;B<k.length;B++){let t=k[B];if(t.classList.contains("xterm"))break;if(t.classList.contains("xterm-hover"))return}this._lastBufferCell&&e.x===this._lastBufferCell.x&&e.y===this._lastBufferCell.y||(this._handleHover(e),this._lastBufferCell=e)}_handleHover(A){if(this._activeLine!==A.y)return this._clearCurrentLink(),void this._askForLink(A,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,A)||(this._clearCurrentLink(),this._askForLink(A,!0))}_askForLink(A,e){var k,B;this._activeProviderReplies&&e||((k=this._activeProviderReplies)===null||k===void 0||k.forEach(n=>{n==null||n.forEach(p=>{p.link.dispose&&p.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=A.y);let t=!1;for(let[n,p]of this._linkProviders.entries())e?!((B=this._activeProviderReplies)===null||B===void 0)&&B.get(n)&&(t=this._checkLinkProviderResult(n,A,t)):p.provideLinks(A.y,h=>{var i,g;if(this._isMouseOut)return;let E=h==null?void 0:h.map(m=>({link:m}));(i=this._activeProviderReplies)===null||i===void 0||i.set(n,E),t=this._checkLinkProviderResult(n,A,t),((g=this._activeProviderReplies)===null||g===void 0?void 0:g.size)===this._linkProviders.length&&this._removeIntersectingLinks(A.y,this._activeProviderReplies)})}_removeIntersectingLinks(A,e){let k=new Set;for(let B=0;B<e.size;B++){let t=e.get(B);if(t)for(let n=0;n<t.length;n++){let p=t[n],h=p.link.range.start.y<A?0:p.link.range.start.x,i=p.link.range.end.y>A?this._bufferService.cols:p.link.range.end.x;for(let g=h;g<=i;g++){if(k.has(g)){t.splice(n--,1);break}k.add(g)}}}}_checkLinkProviderResult(A,e,k){var B;if(!this._activeProviderReplies)return k;let t=this._activeProviderReplies.get(A),n=!1;for(let p=0;p<A;p++)this._activeProviderReplies.has(p)&&!this._activeProviderReplies.get(p)||(n=!0);if(!n&&t){let p=t.find(h=>this._linkAtPosition(h.link,e));p&&(k=!0,this._handleNewLink(p))}if(this._activeProviderReplies.size===this._linkProviders.length&&!k)for(let p=0;p<this._activeProviderReplies.size;p++){let h=(B=this._activeProviderReplies.get(p))===null||B===void 0?void 0:B.find(i=>this._linkAtPosition(i.link,e));if(h){k=!0,this._handleNewLink(h);break}}return k}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(A){if(!this._element||!this._mouseService||!this._currentLink)return;let e=this._positionFromMouseEvent(A,this._element,this._mouseService);e&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(A,this._currentLink.link.text)}_clearCurrentLink(A,e){this._element&&this._currentLink&&this._lastMouseEvent&&(!A||!e||this._currentLink.link.range.start.y>=A&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,l.disposeArray)(this._linkCacheDisposables))}_handleNewLink(A){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(A.link,e)&&(this._currentLink=A,this._currentLink.state={decorations:{underline:A.link.decorations===void 0||A.link.decorations.underline,pointerCursor:A.link.decorations===void 0||A.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,A.link,this._lastMouseEvent),A.link.decorations={},Object.defineProperties(A.link.decorations,{pointerCursor:{get:()=>{var k,B;return(B=(k=this._currentLink)===null||k===void 0?void 0:k.state)===null||B===void 0?void 0:B.decorations.pointerCursor},set:k=>{var B,t;!((B=this._currentLink)===null||B===void 0)&&B.state&&this._currentLink.state.decorations.pointerCursor!==k&&(this._currentLink.state.decorations.pointerCursor=k,this._currentLink.state.isHovered&&((t=this._element)===null||t===void 0||t.classList.toggle("xterm-cursor-pointer",k)))}},underline:{get:()=>{var k,B;return(B=(k=this._currentLink)===null||k===void 0?void 0:k.state)===null||B===void 0?void 0:B.decorations.underline},set:k=>{var B,t,n;!((B=this._currentLink)===null||B===void 0)&&B.state&&((n=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||n===void 0?void 0:n.decorations.underline)!==k&&(this._currentLink.state.decorations.underline=k,this._currentLink.state.isHovered&&this._fireUnderlineEvent(A.link,k))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(k=>{let B=k.start===0?0:k.start+1+this._bufferService.buffer.ydisp,t=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(B,k.end+1+this._bufferService.buffer.ydisp),t&&this._element){let n=this._positionFromMouseEvent(t,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(A,e,k){var B;!((B=this._currentLink)===null||B===void 0)&&B.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&A.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(k,e.text)}_fireUnderlineEvent(A,e){let k=A.range,B=this._bufferService.buffer.ydisp,t=this._createLinkUnderlineEvent(k.start.x-1,k.start.y-B-1,k.end.x,k.end.y-B-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(t)}_linkLeave(A,e,k){var B;!((B=this._currentLink)===null||B===void 0)&&B.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&A.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(k,e.text)}_linkAtPosition(A,e){let k=A.range.start.y*this._bufferService.cols+A.range.start.x,B=A.range.end.y*this._bufferService.cols+A.range.end.x,t=e.y*this._bufferService.cols+e.x;return k<=t&&t<=B}_positionFromMouseEvent(A,e,k){let B=k.getCoords(A,e,this._bufferService.cols,this._bufferService.rows);if(B)return{x:B[0],y:B[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(A,e,k,B,t){return{x1:A,y1:e,x2:k,y2:B,cols:this._bufferService.cols,fg:t}}};$=r([s(0,o.IBufferService)],$),j.Linkifier2=$},9042:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.tooMuchOutput=j.promptLabel=void 0,j.promptLabel="Terminal input",j.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(S,j,P){var r=this&&this.__decorate||function($,A,e,k){var B,t=arguments.length,n=t<3?A:k===null?k=Object.getOwnPropertyDescriptor(A,e):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate($,A,e,k);else for(var p=$.length-1;p>=0;p--)(B=$[p])&&(n=(t<3?B(n):t>3?B(A,e,n):B(A,e))||n);return t>3&&n&&Object.defineProperty(A,e,n),n},s=this&&this.__param||function($,A){return function(e,k){A(e,k,$)}};Object.defineProperty(j,"__esModule",{value:!0}),j.OscLinkProvider=void 0;let o=P(511),a=P(2585),l=class{constructor($,A,e){this._bufferService=$,this._optionsService=A,this._oscLinkService=e}provideLinks($,A){var e;let k=this._bufferService.buffer.lines.get($-1);if(!k)return void A(void 0);let B=[],t=this._optionsService.rawOptions.linkHandler,n=new o.CellData,p=k.getTrimmedLength(),h=-1,i=-1,g=!1;for(let E=0;E<p;E++)if(i!==-1||k.hasContent(E)){if(k.loadCell(E,n),n.hasExtendedAttrs()&&n.extended.urlId){if(i===-1){i=E,h=n.extended.urlId;continue}g=n.extended.urlId!==h}else i!==-1&&(g=!0);if(g||i!==-1&&E===p-1){let m=(e=this._oscLinkService.getLinkData(h))===null||e===void 0?void 0:e.uri;if(m){let v={start:{x:i+1,y:$},end:{x:E+(g||E!==p-1?0:1),y:$}},x=!1;if(!(t!=null&&t.allowNonHttpProtocols))try{let y=new URL(m);["http:","https:"].includes(y.protocol)||(x=!0)}catch(y){x=!0}x||B.push({text:m,range:v,activate:(y,I)=>t?t.activate(y,I,v):c(0,I),hover:(y,I)=>{var F;return(F=t==null?void 0:t.hover)===null||F===void 0?void 0:F.call(t,y,I,v)},leave:(y,I)=>{var F;return(F=t==null?void 0:t.leave)===null||F===void 0?void 0:F.call(t,y,I,v)}})}g=!1,n.hasExtendedAttrs()&&n.extended.urlId?(i=E,h=n.extended.urlId):(i=-1,h=-1)}}A(B)}};function c($,A){if(confirm(`Do you want to navigate to ${A}?

WARNING: This link could potentially be dangerous`)){let e=window.open();if(e){try{e.opener=null}catch(k){}e.location.href=A}else console.warn("Opening link blocked as opener could not be cleared")}}l=r([s(0,a.IBufferService),s(1,a.IOptionsService),s(2,a.IOscLinkService)],l),j.OscLinkProvider=l},6193:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.RenderDebouncer=void 0,j.RenderDebouncer=class{constructor(P,r){this._parentWindow=P,this._renderCallback=r,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(P){return this._refreshCallbacks.push(P),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(P,r,s){this._rowCount=s,P=P!==void 0?P:0,r=r!==void 0?r:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,P):P,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,r):r,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let P=Math.max(this._rowStart,0),r=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(P,r),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let P of this._refreshCallbacks)P(0);this._refreshCallbacks=[]}}},5596:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.ScreenDprMonitor=void 0;let r=P(844);class s extends r.Disposable{constructor(a){super(),this._parentWindow=a,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,r.toDisposable)(()=>{this.clearListener()}))}setListener(a){this._listener&&this.clearListener(),this._listener=a,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var a;this._outerListener&&((a=this._resolutionMediaMatchList)===null||a===void 0||a.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}j.ScreenDprMonitor=s},3236:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.Terminal=void 0;let r=P(2950),s=P(1680),o=P(3614),a=P(2584),l=P(5435),c=P(9312),$=P(6114),A=P(3656),e=P(9042),k=P(4567),B=P(1296),t=P(7399),n=P(8460),p=P(8437),h=P(3230),i=P(4725),g=P(428),E=P(8934),m=P(6465),v=P(5114),x=P(8969),y=P(8055),I=P(4269),F=P(5941),d=P(3107),u=P(5744),H=P(9074),R=P(2585),b=P(3730),Q=P(844),V=P(6731),D=typeof window!="undefined"?window.document:null;class W extends x.CoreTerminal{constructor(X={}){super(X),this.browser=$,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new n.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new n.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new n.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new n.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new n.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new n.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new n.EventEmitter),this._onBlur=this.register(new n.EventEmitter),this._onA11yCharEmitter=this.register(new n.EventEmitter),this._onA11yTabEmitter=this.register(new n.EventEmitter),this._onWillOpen=this.register(new n.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(m.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(b.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(H.DecorationService),this._instantiationService.setService(R.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((C,M)=>this.refresh(C,M))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(C=>this._reportWindowsOptions(C))),this.register(this._inputHandler.onColor(C=>this._handleColorEvent(C))),this.register((0,n.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,n.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,n.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,n.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(C=>this._afterResize(C.cols,C.rows))),this.register((0,Q.toDisposable)(()=>{var C,M;this._customKeyEventHandler=void 0,(M=(C=this.element)===null||C===void 0?void 0:C.parentNode)===null||M===void 0||M.removeChild(this.element)}))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(X){if(this._themeService)for(let C of X){let M,T="";switch(C.index){case 256:M="foreground",T="10";break;case 257:M="background",T="11";break;case 258:M="cursor",T="12";break;default:M="ansi",T="4;"+C.index}switch(C.type){case 0:let _=y.color.toColorRGB(M==="ansi"?this._themeService.colors.ansi[C.index]:this._themeService.colors[M]);this.coreService.triggerDataEvent(`${a.C0.ESC}]${T};${(0,F.toRgbString)(_)}${a.C1_ESCAPED.ST}`);break;case 1:if(M==="ansi")this._themeService.modifyColors(L=>L.ansi[C.index]=y.rgba.toColor(...C.color));else{let L=M;this._themeService.modifyColors(O=>O[L]=y.rgba.toColor(...C.color))}break;case 2:this._themeService.restoreColor(C.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(X){var C;X?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new k.AccessibilityManager(this,this._renderService)):((C=this._accessibilityManager)===null||C===void 0||C.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(X){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(a.C0.ESC+"[I"),this.updateCursorStyle(X),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var X;return(X=this.textarea)===null||X===void 0?void 0:X.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(a.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let X=this.buffer.ybase+this.buffer.y,C=this.buffer.lines.get(X);if(!C)return;let M=Math.min(this.buffer.x,this.cols-1),T=this._renderService.dimensions.css.cell.height,_=C.getWidth(M),L=this._renderService.dimensions.css.cell.width*_,O=this.buffer.y*this._renderService.dimensions.css.cell.height,K=M*this._renderService.dimensions.css.cell.width;this.textarea.style.left=K+"px",this.textarea.style.top=O+"px",this.textarea.style.width=L+"px",this.textarea.style.height=T+"px",this.textarea.style.lineHeight=T+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,A.addDisposableDomListener)(this.element,"copy",C=>{this.hasSelection()&&(0,o.copyHandler)(C,this._selectionService)}));let X=C=>(0,o.handlePasteEvent)(C,this.textarea,this.coreService);this.register((0,A.addDisposableDomListener)(this.textarea,"paste",X)),this.register((0,A.addDisposableDomListener)(this.element,"paste",X)),$.isFirefox?this.register((0,A.addDisposableDomListener)(this.element,"mousedown",C=>{C.button===2&&(0,o.rightClickHandler)(C,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,A.addDisposableDomListener)(this.element,"contextmenu",C=>{(0,o.rightClickHandler)(C,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),$.isLinux&&this.register((0,A.addDisposableDomListener)(this.element,"auxclick",C=>{C.button===1&&(0,o.moveTextAreaUnderMouseCursor)(C,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,A.addDisposableDomListener)(this.textarea,"keyup",X=>this._keyUp(X),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"keydown",X=>this._keyDown(X),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"keypress",X=>this._keyPress(X),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionupdate",X=>this._compositionHelper.compositionupdate(X))),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,A.addDisposableDomListener)(this.textarea,"input",X=>this._inputEvent(X),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(X){var C;if(!X)throw new Error("Terminal requires a parent element.");X.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=X.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),X.appendChild(this.element);let M=D.createDocumentFragment();this._viewportElement=D.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),M.appendChild(this._viewportElement),this._viewportScrollArea=D.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=D.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=D.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),M.appendChild(this.screenElement),this.textarea=D.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",e.promptLabel),$.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(v.CoreBrowserService,this.textarea,(C=this._document.defaultView)!==null&&C!==void 0?C:window),this._instantiationService.setService(i.ICoreBrowserService,this._coreBrowserService),this.register((0,A.addDisposableDomListener)(this.textarea,"focus",T=>this._handleTextAreaFocus(T))),this.register((0,A.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(g.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(i.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(V.ThemeService),this._instantiationService.setService(i.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(I.CharacterJoinerService),this._instantiationService.setService(i.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(h.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(i.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(T=>this._onRender.fire(T))),this.onResize(T=>this._renderService.resize(T.cols,T.rows)),this._compositionView=D.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(M);try{this._onWillOpen.fire(this.element)}catch(T){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(E.MouseService),this._instantiationService.setService(i.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(s.Viewport,T=>this.scrollLines(T,!0,1),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(c.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(i.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(T=>this.scrollLines(T.amount,T.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(T=>this._renderService.handleSelectionChanged(T.start,T.end,T.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(T=>{this.textarea.value=T,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(T=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,A.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(d.BufferDecorationRenderer,this.screenElement)),this.register((0,A.addDisposableDomListener)(this.element,"mousedown",T=>this._selectionService.handleMouseDown(T))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new k.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",T=>this._handleScreenReaderModeOptionChange(T))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",T=>{!this._overviewRulerRenderer&&T&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(B.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let X=this,C=this.element;function M(L){let O=X._mouseService.getMouseReportCoords(L,X.screenElement);if(!O)return!1;let K,Z;switch(L.overrideType||L.type){case"mousemove":Z=32,L.buttons===void 0?(K=3,L.button!==void 0&&(K=L.button<3?L.button:3)):K=1&L.buttons?0:4&L.buttons?1:2&L.buttons?2:3;break;case"mouseup":Z=0,K=L.button<3?L.button:3;break;case"mousedown":Z=1,K=L.button<3?L.button:3;break;case"wheel":if(X.viewport.getLinesScrolled(L)===0)return!1;Z=L.deltaY<0?0:1,K=4;break;default:return!1}return!(Z===void 0||K===void 0||K>4)&&X.coreMouseService.triggerMouseEvent({col:O.col,row:O.row,x:O.x,y:O.y,button:K,action:Z,ctrl:L.ctrlKey,alt:L.altKey,shift:L.shiftKey})}let T={mouseup:null,wheel:null,mousedrag:null,mousemove:null},_={mouseup:L=>(M(L),L.buttons||(this._document.removeEventListener("mouseup",T.mouseup),T.mousedrag&&this._document.removeEventListener("mousemove",T.mousedrag)),this.cancel(L)),wheel:L=>(M(L),this.cancel(L,!0)),mousedrag:L=>{L.buttons&&M(L)},mousemove:L=>{L.buttons||M(L)}};this.register(this.coreMouseService.onProtocolChange(L=>{L?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(L)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&L?T.mousemove||(C.addEventListener("mousemove",_.mousemove),T.mousemove=_.mousemove):(C.removeEventListener("mousemove",T.mousemove),T.mousemove=null),16&L?T.wheel||(C.addEventListener("wheel",_.wheel,{passive:!1}),T.wheel=_.wheel):(C.removeEventListener("wheel",T.wheel),T.wheel=null),2&L?T.mouseup||(T.mouseup=_.mouseup):(this._document.removeEventListener("mouseup",T.mouseup),T.mouseup=null),4&L?T.mousedrag||(T.mousedrag=_.mousedrag):(this._document.removeEventListener("mousemove",T.mousedrag),T.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,A.addDisposableDomListener)(C,"mousedown",L=>{if(L.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(L))return M(L),T.mouseup&&this._document.addEventListener("mouseup",T.mouseup),T.mousedrag&&this._document.addEventListener("mousemove",T.mousedrag),this.cancel(L)})),this.register((0,A.addDisposableDomListener)(C,"wheel",L=>{if(!T.wheel){if(!this.buffer.hasScrollback){let O=this.viewport.getLinesScrolled(L);if(O===0)return;let K=a.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(L.deltaY<0?"A":"B"),Z="";for(let J=0;J<Math.abs(O);J++)Z+=K;return this.coreService.triggerDataEvent(Z,!0),this.cancel(L,!0)}return this.viewport.handleWheel(L)?this.cancel(L):void 0}},{passive:!1})),this.register((0,A.addDisposableDomListener)(C,"touchstart",L=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(L),this.cancel(L)},{passive:!0})),this.register((0,A.addDisposableDomListener)(C,"touchmove",L=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(L)?void 0:this.cancel(L)},{passive:!1}))}refresh(X,C){var M;(M=this._renderService)===null||M===void 0||M.refreshRows(X,C)}updateCursorStyle(X){var C;!((C=this._selectionService)===null||C===void 0)&&C.shouldColumnSelect(X)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(X,C,M=0){super.scrollLines(X,C,M),this.refresh(0,this.rows-1)}paste(X){(0,o.paste)(X,this.textarea,this.coreService)}attachCustomKeyEventHandler(X){this._customKeyEventHandler=X}registerLinkProvider(X){return this.linkifier2.registerLinkProvider(X)}registerCharacterJoiner(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let C=this._characterJoinerService.register(X);return this.refresh(0,this.rows-1),C}deregisterCharacterJoiner(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(X)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(X){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+X)}registerDecoration(X){return this._decorationService.registerDecoration(X)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(X,C,M){this._selectionService.setSelection(X,C,M)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var X;(X=this._selectionService)===null||X===void 0||X.clearSelection()}selectAll(){var X;(X=this._selectionService)===null||X===void 0||X.selectAll()}selectLines(X,C){var M;(M=this._selectionService)===null||M===void 0||M.selectLines(X,C)}_keyDown(X){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;let C=this.browser.isMac&&this.options.macOptionIsMeta&&X.altKey;if(!C&&!this._compositionHelper.keydown(X))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;C||X.key!=="Dead"&&X.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let M=(0,t.evaluateKeyboardEvent)(X,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(X),M.type===3||M.type===2){let T=this.rows-1;return this.scrollLines(M.type===2?-T:T),this.cancel(X,!0)}return M.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,X)||(M.cancel&&this.cancel(X,!0),!M.key||!!(X.key&&!X.ctrlKey&&!X.altKey&&!X.metaKey&&X.key.length===1&&X.key.charCodeAt(0)>=65&&X.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(M.key!==a.C0.ETX&&M.key!==a.C0.CR||(this.textarea.value=""),this._onKey.fire({key:M.key,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(M.key,!0),!this.optionsService.rawOptions.screenReaderMode||X.altKey||X.ctrlKey?this.cancel(X,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(X,C){let M=X.isMac&&!this.options.macOptionIsMeta&&C.altKey&&!C.ctrlKey&&!C.metaKey||X.isWindows&&C.altKey&&C.ctrlKey&&!C.metaKey||X.isWindows&&C.getModifierState("AltGraph");return C.type==="keypress"?M:M&&(!C.keyCode||C.keyCode>47)}_keyUp(X){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1||(function(C){return C.keyCode===16||C.keyCode===17||C.keyCode===18}(X)||this.focus(),this.updateCursorStyle(X),this._keyPressHandled=!1)}_keyPress(X){let C;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;if(this.cancel(X),X.charCode)C=X.charCode;else if(X.which===null||X.which===void 0)C=X.keyCode;else{if(X.which===0||X.charCode===0)return!1;C=X.which}return!(!C||(X.altKey||X.ctrlKey||X.metaKey)&&!this._isThirdLevelShift(this.browser,X)||(C=String.fromCharCode(C),this._onKey.fire({key:C,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(C,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(X){if(X.data&&X.inputType==="insertText"&&(!X.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let C=X.data;return this.coreService.triggerDataEvent(C,!0),this.cancel(X),!0}return!1}resize(X,C){X!==this.cols||C!==this.rows?super.resize(X,C):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(X,C){var M,T;(M=this._charSizeService)===null||M===void 0||M.measure(),(T=this.viewport)===null||T===void 0||T.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let X=1;X<this.rows;X++)this.buffer.lines.push(this.buffer.getBlankLine(p.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var X,C;this.options.rows=this.rows,this.options.cols=this.cols;let M=this._customKeyEventHandler;this._setup(),super.reset(),(X=this._selectionService)===null||X===void 0||X.reset(),this._decorationService.reset(),this._customKeyEventHandler=M,this.refresh(0,this.rows-1),(C=this.viewport)===null||C===void 0||C.syncScrollArea()}clearTextureAtlas(){var X;(X=this._renderService)===null||X===void 0||X.clearTextureAtlas()}_reportFocus(){var X;!((X=this.element)===null||X===void 0)&&X.classList.contains("focus")?this.coreService.triggerDataEvent(a.C0.ESC+"[I"):this.coreService.triggerDataEvent(a.C0.ESC+"[O")}_reportWindowsOptions(X){if(this._renderService)switch(X){case l.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let C=this._renderService.dimensions.css.canvas.width.toFixed(0),M=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${a.C0.ESC}[4;${M};${C}t`);break;case l.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let T=this._renderService.dimensions.css.cell.width.toFixed(0),_=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${a.C0.ESC}[6;${_};${T}t`)}}cancel(X,C){if(this.options.cancelEvents||C)return X.preventDefault(),X.stopPropagation(),!1}}j.Terminal=W},9924:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.TimeBasedDebouncer=void 0,j.TimeBasedDebouncer=class{constructor(P,r=1e3){this._renderCallback=P,this._debounceThresholdMS=r,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(P,r,s){this._rowCount=s,P=P!==void 0?P:0,r=r!==void 0?r:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,P):P,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,r):r;let o=Date.now();if(o-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=o,this._innerRefresh();else if(!this._additionalRefreshRequested){let a=o-this._lastRefreshMs,l=this._debounceThresholdMS-a;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},l)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let P=Math.max(this._rowStart,0),r=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(P,r)}}},1680:function(S,j,P){var r=this&&this.__decorate||function(A,e,k,B){var t,n=arguments.length,p=n<3?e:B===null?B=Object.getOwnPropertyDescriptor(e,k):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(A,e,k,B);else for(var h=A.length-1;h>=0;h--)(t=A[h])&&(p=(n<3?t(p):n>3?t(e,k,p):t(e,k))||p);return n>3&&p&&Object.defineProperty(e,k,p),p},s=this&&this.__param||function(A,e){return function(k,B){e(k,B,A)}};Object.defineProperty(j,"__esModule",{value:!0}),j.Viewport=void 0;let o=P(844),a=P(3656),l=P(4725),c=P(2585),$=class extends o.Disposable{constructor(A,e,k,B,t,n,p,h,i){super(),this._scrollLines=A,this._viewportElement=e,this._scrollArea=k,this._bufferService=B,this._optionsService=t,this._charSizeService=n,this._renderService=p,this._coreBrowserService=h,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,a.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(g=>this._activeBuffer=g.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(g=>this._renderDimensions=g)),this._handleThemeChange(i.colors),this.register(i.onChangeColors(g=>this._handleThemeChange(g))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea(),0)}_handleThemeChange(A){this._viewportElement.style.backgroundColor=A.background.css}_refresh(A){if(A)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let A=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==A&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=A),this._refreshAnimationFrame=null}syncScrollArea(A=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(A);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(A)}_handleScroll(A){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);let e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(e)}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let A=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(A*(this._smoothScrollState.target-this._smoothScrollState.origin)),A<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(A,e){let k=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&this._viewportElement.scrollTop!==0||e>0&&k<this._lastRecordedBufferHeight)||(A.cancelable&&A.preventDefault(),!1)}handleWheel(A){let e=this._getPixelsScrolled(A);return e!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+e:this._smoothScrollState.target+=e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=e,this._bubbleScroll(A,e))}_getPixelsScrolled(A){if(A.deltaY===0||A.shiftKey)return 0;let e=this._applyScrollModifier(A.deltaY,A);return A.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:A.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e}getLinesScrolled(A){if(A.deltaY===0||A.shiftKey)return 0;let e=this._applyScrollModifier(A.deltaY,A);return A.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):A.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e}_applyScrollModifier(A,e){let k=this._optionsService.rawOptions.fastScrollModifier;return k==="alt"&&e.altKey||k==="ctrl"&&e.ctrlKey||k==="shift"&&e.shiftKey?A*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:A*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(A){this._lastTouchY=A.touches[0].pageY}handleTouchMove(A){let e=this._lastTouchY-A.touches[0].pageY;return this._lastTouchY=A.touches[0].pageY,e!==0&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(A,e))}};$=r([s(3,c.IBufferService),s(4,c.IOptionsService),s(5,l.ICharSizeService),s(6,l.IRenderService),s(7,l.ICoreBrowserService),s(8,l.IThemeService)],$),j.Viewport=$},3107:function(S,j,P){var r=this&&this.__decorate||function(A,e,k,B){var t,n=arguments.length,p=n<3?e:B===null?B=Object.getOwnPropertyDescriptor(e,k):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(A,e,k,B);else for(var h=A.length-1;h>=0;h--)(t=A[h])&&(p=(n<3?t(p):n>3?t(e,k,p):t(e,k))||p);return n>3&&p&&Object.defineProperty(e,k,p),p},s=this&&this.__param||function(A,e){return function(k,B){e(k,B,A)}};Object.defineProperty(j,"__esModule",{value:!0}),j.BufferDecorationRenderer=void 0;let o=P(3656),a=P(4725),l=P(844),c=P(2585),$=class extends l.Disposable{constructor(A,e,k,B){super(),this._screenElement=A,this._bufferService=e,this._decorationService=k,this._renderService=B,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,o.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(t=>this._removeDecoration(t))),this.register((0,l.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let A of this._decorationService.decorations)this._renderDecoration(A);this._dimensionsChanged=!1}_renderDecoration(A){this._refreshStyle(A),this._dimensionsChanged&&this._refreshXPosition(A)}_createElement(A){var e;let k=document.createElement("div");k.classList.add("xterm-decoration"),k.style.width=`${Math.round((A.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,k.style.height=(A.options.height||1)*this._renderService.dimensions.css.cell.height+"px",k.style.top=(A.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",k.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let B=(e=A.options.x)!==null&&e!==void 0?e:0;return B&&B>this._bufferService.cols&&(k.style.display="none"),this._refreshXPosition(A,k),k}_refreshStyle(A){let e=A.marker.line-this._bufferService.buffers.active.ydisp;if(e<0||e>=this._bufferService.rows)A.element&&(A.element.style.display="none",A.onRenderEmitter.fire(A.element));else{let k=this._decorationElements.get(A);k||(k=this._createElement(A),A.element=k,this._decorationElements.set(A,k),this._container.appendChild(k)),k.style.top=e*this._renderService.dimensions.css.cell.height+"px",k.style.display=this._altBufferIsActive?"none":"block",A.onRenderEmitter.fire(k)}}_refreshXPosition(A,e=A.element){var k;if(!e)return;let B=(k=A.options.x)!==null&&k!==void 0?k:0;(A.options.anchor||"left")==="right"?e.style.right=B?B*this._renderService.dimensions.css.cell.width+"px":"":e.style.left=B?B*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(A){var e;(e=this._decorationElements.get(A))===null||e===void 0||e.remove(),this._decorationElements.delete(A),A.dispose()}};$=r([s(1,c.IBufferService),s(2,c.IDecorationService),s(3,a.IRenderService)],$),j.BufferDecorationRenderer=$},5871:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.ColorZoneStore=void 0,j.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(P){if(P.options.overviewRulerOptions){for(let r of this._zones)if(r.color===P.options.overviewRulerOptions.color&&r.position===P.options.overviewRulerOptions.position){if(this._lineIntersectsZone(r,P.marker.line))return;if(this._lineAdjacentToZone(r,P.marker.line,P.options.overviewRulerOptions.position))return void this._addLineToZone(r,P.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=P.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=P.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=P.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=P.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:P.options.overviewRulerOptions.color,position:P.options.overviewRulerOptions.position,startBufferLine:P.marker.line,endBufferLine:P.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(P){this._linePadding=P}_lineIntersectsZone(P,r){return r>=P.startBufferLine&&r<=P.endBufferLine}_lineAdjacentToZone(P,r,s){return r>=P.startBufferLine-this._linePadding[s||"full"]&&r<=P.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(P,r){P.startBufferLine=Math.min(P.startBufferLine,r),P.endBufferLine=Math.max(P.endBufferLine,r)}}},5744:function(S,j,P){var r=this&&this.__decorate||function(t,n,p,h){var i,g=arguments.length,E=g<3?n:h===null?h=Object.getOwnPropertyDescriptor(n,p):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(t,n,p,h);else for(var m=t.length-1;m>=0;m--)(i=t[m])&&(E=(g<3?i(E):g>3?i(n,p,E):i(n,p))||E);return g>3&&E&&Object.defineProperty(n,p,E),E},s=this&&this.__param||function(t,n){return function(p,h){n(p,h,t)}};Object.defineProperty(j,"__esModule",{value:!0}),j.OverviewRulerRenderer=void 0;let o=P(5871),a=P(3656),l=P(4725),c=P(844),$=P(2585),A={full:0,left:0,center:0,right:0},e={full:0,left:0,center:0,right:0},k={full:0,left:0,center:0,right:0},B=class extends c.Disposable{constructor(t,n,p,h,i,g,E){var m;super(),this._viewportElement=t,this._screenElement=n,this._bufferService=p,this._decorationService=h,this._renderService=i,this._optionsService=g,this._coreBrowseService=E,this._colorZoneStore=new o.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(m=this._viewportElement.parentElement)===null||m===void 0||m.insertBefore(this._canvas,this._viewportElement);let v=this._canvas.getContext("2d");if(!v)throw new Error("Ctx cannot be null");this._ctx=v,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,c.toDisposable)(()=>{var x;(x=this._canvas)===null||x===void 0||x.remove()}))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,a.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let t=Math.floor(this._canvas.width/3),n=Math.ceil(this._canvas.width/3);e.full=this._canvas.width,e.left=t,e.center=n,e.right=t,this._refreshDrawHeightConstants(),k.full=0,k.left=0,k.center=e.left,k.right=e.left+e.center}_refreshDrawHeightConstants(){A.full=Math.round(2*this._coreBrowseService.dpr);let t=this._canvas.height/this._bufferService.buffer.lines.length,n=Math.round(Math.max(Math.min(t,12),6)*this._coreBrowseService.dpr);A.left=n,A.center=n,A.right=n}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let n of this._decorationService.decorations)this._colorZoneStore.addDecoration(n);this._ctx.lineWidth=1;let t=this._colorZoneStore.zones;for(let n of t)n.position!=="full"&&this._renderColorZone(n);for(let n of t)n.position==="full"&&this._renderColorZone(n);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(t){this._ctx.fillStyle=t.color,this._ctx.fillRect(k[t.position||"full"],Math.round((this._canvas.height-1)*(t.startBufferLine/this._bufferService.buffers.active.lines.length)-A[t.position||"full"]/2),e[t.position||"full"],Math.round((this._canvas.height-1)*((t.endBufferLine-t.startBufferLine)/this._bufferService.buffers.active.lines.length)+A[t.position||"full"]))}_queueRefresh(t,n){this._shouldUpdateDimensions=t||this._shouldUpdateDimensions,this._shouldUpdateAnchor=n||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};B=r([s(2,$.IBufferService),s(3,$.IDecorationService),s(4,l.IRenderService),s(5,$.IOptionsService),s(6,l.ICoreBrowserService)],B),j.OverviewRulerRenderer=B},2950:function(S,j,P){var r=this&&this.__decorate||function($,A,e,k){var B,t=arguments.length,n=t<3?A:k===null?k=Object.getOwnPropertyDescriptor(A,e):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate($,A,e,k);else for(var p=$.length-1;p>=0;p--)(B=$[p])&&(n=(t<3?B(n):t>3?B(A,e,n):B(A,e))||n);return t>3&&n&&Object.defineProperty(A,e,n),n},s=this&&this.__param||function($,A){return function(e,k){A(e,k,$)}};Object.defineProperty(j,"__esModule",{value:!0}),j.CompositionHelper=void 0;let o=P(4725),a=P(2585),l=P(2584),c=class{constructor($,A,e,k,B,t){this._textarea=$,this._compositionView=A,this._bufferService=e,this._optionsService=k,this._coreService=B,this._renderService=t,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate($){this._compositionView.textContent=$.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown($){if(this._isComposing||this._isSendingComposition){if($.keyCode===229||$.keyCode===16||$.keyCode===17||$.keyCode===18)return!1;this._finalizeComposition(!1)}return $.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition($){if(this._compositionView.classList.remove("active"),this._isComposing=!1,$){let A={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let e;this._isSendingComposition=!1,A.start+=this._dataAlreadySent.length,e=this._isComposing?this._textarea.value.substring(A.start,A.end):this._textarea.value.substring(A.start),e.length>0&&this._coreService.triggerDataEvent(e,!0)}},0)}else{this._isSendingComposition=!1;let A=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(A,!0)}}_handleAnyTextareaChanges(){let $=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let A=this._textarea.value,e=A.replace($,"");this._dataAlreadySent=e,A.length>$.length?this._coreService.triggerDataEvent(e,!0):A.length<$.length?this._coreService.triggerDataEvent(`${l.C0.DEL}`,!0):A.length===$.length&&A!==$&&this._coreService.triggerDataEvent(A,!0)}},0)}updateCompositionElements($){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let A=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),e=this._renderService.dimensions.css.cell.height,k=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,B=A*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=B+"px",this._compositionView.style.top=k+"px",this._compositionView.style.height=e+"px",this._compositionView.style.lineHeight=e+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let t=this._compositionView.getBoundingClientRect();this._textarea.style.left=B+"px",this._textarea.style.top=k+"px",this._textarea.style.width=Math.max(t.width,1)+"px",this._textarea.style.height=Math.max(t.height,1)+"px",this._textarea.style.lineHeight=t.height+"px"}$||setTimeout(()=>this.updateCompositionElements(!0),0)}}};c=r([s(2,a.IBufferService),s(3,a.IOptionsService),s(4,a.ICoreService),s(5,o.IRenderService)],c),j.CompositionHelper=c},9806:(S,j)=>{function P(r,s,o){let a=o.getBoundingClientRect(),l=r.getComputedStyle(o),c=parseInt(l.getPropertyValue("padding-left")),$=parseInt(l.getPropertyValue("padding-top"));return[s.clientX-a.left-c,s.clientY-a.top-$]}Object.defineProperty(j,"__esModule",{value:!0}),j.getCoords=j.getCoordsRelativeToElement=void 0,j.getCoordsRelativeToElement=P,j.getCoords=function(r,s,o,a,l,c,$,A,e){if(!c)return;let k=P(r,s,o);return k?(k[0]=Math.ceil((k[0]+(e?$/2:0))/$),k[1]=Math.ceil(k[1]/A),k[0]=Math.min(Math.max(k[0],1),a+(e?1:0)),k[1]=Math.min(Math.max(k[1],1),l),k):void 0}},9504:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.moveToCellSequence=void 0;let r=P(2584);function s(A,e,k,B){let t=A-o(A,k),n=e-o(e,k),p=Math.abs(t-n)-function(h,i,g){let E=0,m=h-o(h,g),v=i-o(i,g);for(let x=0;x<Math.abs(m-v);x++){let y=a(h,i)==="A"?-1:1,I=g.buffer.lines.get(m+y*x);I!=null&&I.isWrapped&&E++}return E}(A,e,k);return $(p,c(a(A,e),B))}function o(A,e){let k=0,B=e.buffer.lines.get(A),t=B==null?void 0:B.isWrapped;for(;t&&A>=0&&A<e.rows;)k++,B=e.buffer.lines.get(--A),t=B==null?void 0:B.isWrapped;return k}function a(A,e){return A>e?"A":"B"}function l(A,e,k,B,t,n){let p=A,h=e,i="";for(;p!==k||h!==B;)p+=t?1:-1,t&&p>n.cols-1?(i+=n.buffer.translateBufferLineToString(h,!1,A,p),p=0,A=0,h++):!t&&p<0&&(i+=n.buffer.translateBufferLineToString(h,!1,0,A+1),p=n.cols-1,A=p,h--);return i+n.buffer.translateBufferLineToString(h,!1,A,p)}function c(A,e){let k=e?"O":"[";return r.C0.ESC+k+A}function $(A,e){A=Math.floor(A);let k="";for(let B=0;B<A;B++)k+=e;return k}j.moveToCellSequence=function(A,e,k,B){let t=k.buffer.x,n=k.buffer.y;if(!k.buffer.hasScrollback)return function(i,g,E,m,v,x){return s(g,m,v,x).length===0?"":$(l(i,g,i,g-o(g,v),!1,v).length,c("D",x))}(t,n,0,e,k,B)+s(n,e,k,B)+function(i,g,E,m,v,x){let y;y=s(g,m,v,x).length>0?m-o(m,v):g;let I=m,F=function(d,u,H,R,b,Q){let V;return V=s(H,R,b,Q).length>0?R-o(R,b):u,d<H&&V<=R||d>=H&&V<R?"C":"D"}(i,g,E,m,v,x);return $(l(i,y,E,I,F==="C",v).length,c(F,x))}(t,n,A,e,k,B);let p;if(n===e)return p=t>A?"D":"C",$(Math.abs(t-A),c(p,B));p=n>e?"D":"C";let h=Math.abs(n-e);return $(function(i,g){return g.cols-i}(n>e?A:t,k)+(h-1)*k.cols+1+((n>e?t:A)-1),c(p,B))}},1296:function(S,j,P){var r=this&&this.__decorate||function(i,g,E,m){var v,x=arguments.length,y=x<3?g:m===null?m=Object.getOwnPropertyDescriptor(g,E):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(i,g,E,m);else for(var I=i.length-1;I>=0;I--)(v=i[I])&&(y=(x<3?v(y):x>3?v(g,E,y):v(g,E))||y);return x>3&&y&&Object.defineProperty(g,E,y),y},s=this&&this.__param||function(i,g){return function(E,m){g(E,m,i)}};Object.defineProperty(j,"__esModule",{value:!0}),j.DomRenderer=void 0;let o=P(9631),a=P(3787),l=P(2223),c=P(6171),$=P(4725),A=P(8055),e=P(8460),k=P(844),B=P(2585),t="xterm-dom-renderer-owner-",n="xterm-focus",p=1,h=class extends k.Disposable{constructor(i,g,E,m,v,x,y,I,F,d){super(),this._element=i,this._screenElement=g,this._viewportElement=E,this._linkifier2=m,this._charSizeService=x,this._optionsService=y,this._bufferService=I,this._coreBrowserService=F,this._terminalClass=p++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new e.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,c.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(d.onChangeColors(u=>this._injectCss(u))),this._injectCss(d.colors),this._rowFactory=v.createInstance(a.DomRendererRowFactory,document),this._element.classList.add(t+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(u=>this._handleLinkHover(u))),this.register(this._linkifier2.onHideLinkUnderline(u=>this._handleLinkLeave(u))),this.register((0,k.toDisposable)(()=>{this._element.classList.remove(t+this._terminalClass),(0,o.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)}))}_updateDimensions(){let i=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*i,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*i),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/i),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/i),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let E of this._rowElements)E.style.width=`${this.dimensions.css.canvas.width}px`,E.style.height=`${this.dimensions.css.cell.height}px`,E.style.lineHeight=`${this.dimensions.css.cell.height}px`,E.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let g=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=g,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(i){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let g=`${this._terminalSelector} .xterm-rows { color: ${i.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;g+=`${this._terminalSelector} span:not(.${a.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${a.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${a.ITALIC_CLASS} { font-style: italic;}`,g+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",g+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${i.cursor.css};  color: ${i.cursorAccent.css}; } 50% {  background-color: ${i.cursorAccent.css};  color: ${i.cursor.css}; }}`,g+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${a.CURSOR_CLASS}.${a.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${i.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${a.CURSOR_CLASS}.${a.CURSOR_BLINK_CLASS}:not(.${a.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${a.CURSOR_CLASS}.${a.CURSOR_BLINK_CLASS}.${a.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${a.CURSOR_CLASS}.${a.CURSOR_STYLE_BLOCK_CLASS} { background-color: ${i.cursor.css}; color: ${i.cursorAccent.css};}${this._terminalSelector} .xterm-rows .${a.CURSOR_CLASS}.${a.CURSOR_STYLE_BAR_CLASS} { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${i.cursor.css} inset;}${this._terminalSelector} .xterm-rows .${a.CURSOR_CLASS}.${a.CURSOR_STYLE_UNDERLINE_CLASS} { box-shadow: 0 -1px 0 ${i.cursor.css} inset;}`,g+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${i.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${i.selectionInactiveBackgroundOpaque.css};}`;for(let[E,m]of i.ansi.entries())g+=`${this._terminalSelector} .xterm-fg-${E} { color: ${m.css}; }${this._terminalSelector} .xterm-bg-${E} { background-color: ${m.css}; }`;g+=`${this._terminalSelector} .xterm-fg-${l.INVERTED_DEFAULT_COLOR} { color: ${A.color.opaque(i.background).css}; }${this._terminalSelector} .xterm-bg-${l.INVERTED_DEFAULT_COLOR} { background-color: ${i.foreground.css}; }`,this._themeStyleElement.textContent=g}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(i,g){for(let E=this._rowElements.length;E<=g;E++){let m=document.createElement("div");this._rowContainer.appendChild(m),this._rowElements.push(m)}for(;this._rowElements.length>g;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(i,g){this._refreshRowElements(i,g),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(n)}handleFocus(){this._rowContainer.classList.add(n)}handleSelectionChanged(i,g,E){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(i,g,E),this.renderRows(0,this._bufferService.rows-1),!i||!g)return;let m=i[1]-this._bufferService.buffer.ydisp,v=g[1]-this._bufferService.buffer.ydisp,x=Math.max(m,0),y=Math.min(v,this._bufferService.rows-1);if(x>=this._bufferService.rows||y<0)return;let I=document.createDocumentFragment();if(E){let F=i[0]>g[0];I.appendChild(this._createSelectionElement(x,F?g[0]:i[0],F?i[0]:g[0],y-x+1))}else{let F=m===x?i[0]:0,d=x===v?g[0]:this._bufferService.cols;I.appendChild(this._createSelectionElement(x,F,d));let u=y-x-1;if(I.appendChild(this._createSelectionElement(x+1,0,this._bufferService.cols,u)),x!==y){let H=v===y?g[0]:this._bufferService.cols;I.appendChild(this._createSelectionElement(y,0,H))}}this._selectionContainer.appendChild(I)}_createSelectionElement(i,g,E,m=1){let v=document.createElement("div");return v.style.height=m*this.dimensions.css.cell.height+"px",v.style.top=i*this.dimensions.css.cell.height+"px",v.style.left=g*this.dimensions.css.cell.width+"px",v.style.width=this.dimensions.css.cell.width*(E-g)+"px",v}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(let i of this._rowElements)i.replaceChildren()}renderRows(i,g){let E=this._bufferService.buffer.ybase+this._bufferService.buffer.y,m=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),v=this._optionsService.rawOptions.cursorBlink;for(let x=i;x<=g;x++){let y=this._rowElements[x],I=x+this._bufferService.buffer.ydisp,F=this._bufferService.buffer.lines.get(I),d=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[x]&&this._cellToRowElements[x].length===this._bufferService.cols||(this._cellToRowElements[x]=new Int16Array(this._bufferService.cols)),y.replaceChildren(this._rowFactory.createRow(F,I,I===E,d,m,v,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[x]))}}get _terminalSelector(){return`.${t}${this._terminalClass}`}_handleLinkHover(i){this._setCellUnderline(i.x1,i.x2,i.y1,i.y2,i.cols,!0)}_handleLinkLeave(i){this._setCellUnderline(i.x1,i.x2,i.y1,i.y2,i.cols,!1)}_setCellUnderline(i,g,E,m,v,x){if(i=this._cellToRowElements[E][i],g=this._cellToRowElements[m][g],i!==-1&&g!==-1)for(;i!==g||E!==m;){let y=this._rowElements[E];if(!y)return;let I=y.children[i];I&&(I.style.textDecoration=x?"underline":"none"),++i>=v&&(i=0,E++)}}};h=r([s(4,B.IInstantiationService),s(5,$.ICharSizeService),s(6,B.IOptionsService),s(7,B.IBufferService),s(8,$.ICoreBrowserService),s(9,$.IThemeService)],h),j.DomRenderer=h},3787:function(S,j,P){var r=this&&this.__decorate||function(p,h,i,g){var E,m=arguments.length,v=m<3?h:g===null?g=Object.getOwnPropertyDescriptor(h,i):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(p,h,i,g);else for(var x=p.length-1;x>=0;x--)(E=p[x])&&(v=(m<3?E(v):m>3?E(h,i,v):E(h,i))||v);return m>3&&v&&Object.defineProperty(h,i,v),v},s=this&&this.__param||function(p,h){return function(i,g){h(i,g,p)}};Object.defineProperty(j,"__esModule",{value:!0}),j.DomRendererRowFactory=j.CURSOR_STYLE_UNDERLINE_CLASS=j.CURSOR_STYLE_BAR_CLASS=j.CURSOR_STYLE_BLOCK_CLASS=j.CURSOR_BLINK_CLASS=j.CURSOR_CLASS=j.STRIKETHROUGH_CLASS=j.UNDERLINE_CLASS=j.ITALIC_CLASS=j.DIM_CLASS=j.BOLD_CLASS=void 0;let o=P(2223),a=P(643),l=P(511),c=P(2585),$=P(8055),A=P(4725),e=P(4269),k=P(6171),B=P(3734);j.BOLD_CLASS="xterm-bold",j.DIM_CLASS="xterm-dim",j.ITALIC_CLASS="xterm-italic",j.UNDERLINE_CLASS="xterm-underline",j.STRIKETHROUGH_CLASS="xterm-strikethrough",j.CURSOR_CLASS="xterm-cursor",j.CURSOR_BLINK_CLASS="xterm-cursor-blink",j.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",j.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",j.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let t=class{constructor(p,h,i,g,E,m,v){this._document=p,this._characterJoinerService=h,this._optionsService=i,this._coreBrowserService=g,this._coreService=E,this._decorationService=m,this._themeService=v,this._workCell=new l.CellData,this._columnSelectMode=!1}handleSelectionChanged(p,h,i){this._selectionStart=p,this._selectionEnd=h,this._columnSelectMode=i}createRow(p,h,i,g,E,m,v,x,y){let I=this._document.createDocumentFragment(),F=this._characterJoinerService.getJoinedCharacters(h),d=0;for(let b=Math.min(p.length,x)-1;b>=0;b--)if(p.loadCell(b,this._workCell).getCode()!==a.NULL_CELL_CODE||i&&b===E){d=b+1;break}let u=this._themeService.colors,H=-1,R=0;for(;R<d;R++){p.loadCell(R,this._workCell);let b=this._workCell.getWidth();if(b===0){y[R]=H;continue}let Q=!1,V=R,D=this._workCell;if(F.length>0&&R===F[0][0]){Q=!0;let J=F.shift();D=new e.JoinedCellData(this._workCell,p.translateToString(!0,J[0],J[1]),J[1]-J[0]),V=J[1]-1,b=D.getWidth()}let W=this._document.createElement("span");if(b>1&&(W.style.width=v*b+"px"),Q&&(W.style.display="inline",E>=R&&E<=V&&(E=R)),!this._coreService.isCursorHidden&&i&&R===E)switch(W.classList.add(j.CURSOR_CLASS),m&&W.classList.add(j.CURSOR_BLINK_CLASS),g){case"bar":W.classList.add(j.CURSOR_STYLE_BAR_CLASS);break;case"underline":W.classList.add(j.CURSOR_STYLE_UNDERLINE_CLASS);break;default:W.classList.add(j.CURSOR_STYLE_BLOCK_CLASS)}if(D.isBold()&&W.classList.add(j.BOLD_CLASS),D.isItalic()&&W.classList.add(j.ITALIC_CLASS),D.isDim()&&W.classList.add(j.DIM_CLASS),D.isInvisible()?W.textContent=a.WHITESPACE_CELL_CHAR:W.textContent=D.getChars()||a.WHITESPACE_CELL_CHAR,D.isUnderline()&&(W.classList.add(`${j.UNDERLINE_CLASS}-${D.extended.underlineStyle}`),W.textContent===" "&&(W.textContent="\xA0"),!D.isUnderlineColorDefault()))if(D.isUnderlineColorRGB())W.style.textDecorationColor=`rgb(${B.AttributeData.toColorRGB(D.getUnderlineColor()).join(",")})`;else{let J=D.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&D.isBold()&&J<8&&(J+=8),W.style.textDecorationColor=u.ansi[J].css}D.isStrikethrough()&&W.classList.add(j.STRIKETHROUGH_CLASS);let f=D.getFgColor(),X=D.getFgColorMode(),C=D.getBgColor(),M=D.getBgColorMode(),T=!!D.isInverse();if(T){let J=f;f=C,C=J;let dA=X;X=M,M=dA}let _,L,O=!1;this._decorationService.forEachDecorationAtCell(R,h,void 0,J=>{J.options.layer!=="top"&&O||(J.backgroundColorRGB&&(M=50331648,C=J.backgroundColorRGB.rgba>>8&16777215,_=J.backgroundColorRGB),J.foregroundColorRGB&&(X=50331648,f=J.foregroundColorRGB.rgba>>8&16777215,L=J.foregroundColorRGB),O=J.options.layer==="top")});let K=this._isCellInSelection(R,h),Z;switch(O||u.selectionForeground&&K&&(X=50331648,f=u.selectionForeground.rgba>>8&16777215,L=u.selectionForeground),K&&(_=this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque,O=!0),O&&W.classList.add("xterm-decoration-top"),M){case 16777216:case 33554432:Z=u.ansi[C],W.classList.add(`xterm-bg-${C}`);break;case 50331648:Z=$.rgba.toColor(C>>16,C>>8&255,255&C),this._addStyle(W,`background-color:#${n((C>>>0).toString(16),"0",6)}`);break;default:T?(Z=u.foreground,W.classList.add(`xterm-bg-${o.INVERTED_DEFAULT_COLOR}`)):Z=u.background}switch(_||D.isDim()&&(_=$.color.multiplyOpacity(Z,.5)),X){case 16777216:case 33554432:D.isBold()&&f<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(f+=8),this._applyMinimumContrast(W,Z,u.ansi[f],D,_,void 0)||W.classList.add(`xterm-fg-${f}`);break;case 50331648:let J=$.rgba.toColor(f>>16&255,f>>8&255,255&f);this._applyMinimumContrast(W,Z,J,D,_,L)||this._addStyle(W,`color:#${n(f.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(W,Z,u.foreground,D,_,void 0)||T&&W.classList.add(`xterm-fg-${o.INVERTED_DEFAULT_COLOR}`)}I.appendChild(W),y[R]=++H,R=V}return R<x-1&&y.subarray(R).fill(++H),I}_applyMinimumContrast(p,h,i,g,E,m){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,k.excludeFromContrastRatioDemands)(g.getCode()))return!1;let v;return E||m||(v=this._themeService.colors.contrastCache.getColor(h.rgba,i.rgba)),v===void 0&&(v=$.color.ensureContrastRatio(E||h,m||i,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((E||h).rgba,(m||i).rgba,v!=null?v:null)),!!v&&(this._addStyle(p,`color:${v.css}`),!0)}_addStyle(p,h){p.setAttribute("style",`${p.getAttribute("style")||""}${h};`)}_isCellInSelection(p,h){let i=this._selectionStart,g=this._selectionEnd;return!(!i||!g)&&(this._columnSelectMode?i[0]<=g[0]?p>=i[0]&&h>=i[1]&&p<g[0]&&h<=g[1]:p<i[0]&&h>=i[1]&&p>=g[0]&&h<=g[1]:h>i[1]&&h<g[1]||i[1]===g[1]&&h===i[1]&&p>=i[0]&&p<g[0]||i[1]<g[1]&&h===g[1]&&p<g[0]||i[1]<g[1]&&h===i[1]&&p>=i[0])}};function n(p,h,i){for(;p.length<i;)p=h+p;return p}t=r([s(1,A.ICharacterJoinerService),s(2,c.IOptionsService),s(3,A.ICoreBrowserService),s(4,c.ICoreService),s(5,c.IDecorationService),s(6,A.IThemeService)],t),j.DomRendererRowFactory=t},2223:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.TEXT_BASELINE=j.DIM_OPACITY=j.INVERTED_DEFAULT_COLOR=void 0;let r=P(6114);j.INVERTED_DEFAULT_COLOR=257,j.DIM_OPACITY=.5,j.TEXT_BASELINE=r.isFirefox||r.isLegacyEdge?"bottom":"ideographic"},6171:(S,j)=>{function P(r){return 57508<=r&&r<=57558}Object.defineProperty(j,"__esModule",{value:!0}),j.createRenderDimensions=j.excludeFromContrastRatioDemands=j.isRestrictedPowerlineGlyph=j.isPowerlineGlyph=j.throwIfFalsy=void 0,j.throwIfFalsy=function(r){if(!r)throw new Error("value must not be falsy");return r},j.isPowerlineGlyph=P,j.isRestrictedPowerlineGlyph=function(r){return 57520<=r&&r<=57527},j.excludeFromContrastRatioDemands=function(r){return P(r)||function(s){return 9472<=s&&s<=9631}(r)},j.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.SelectionModel=void 0,j.SelectionModel=class{constructor(P){this._bufferService=P,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let P=this.selectionStart[0]+this.selectionStartLength;return P>this._bufferService.cols?P%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(P/this._bufferService.cols)-1]:[P%this._bufferService.cols,this.selectionStart[1]+Math.floor(P/this._bufferService.cols)]:[P,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let P=this.selectionStart[0]+this.selectionStartLength;return P>this._bufferService.cols?[P%this._bufferService.cols,this.selectionStart[1]+Math.floor(P/this._bufferService.cols)]:[Math.max(P,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let P=this.selectionStart,r=this.selectionEnd;return!(!P||!r)&&(P[1]>r[1]||P[1]===r[1]&&P[0]>r[0])}handleTrim(P){return this.selectionStart&&(this.selectionStart[1]-=P),this.selectionEnd&&(this.selectionEnd[1]-=P),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(S,j,P){var r=this&&this.__decorate||function(A,e,k,B){var t,n=arguments.length,p=n<3?e:B===null?B=Object.getOwnPropertyDescriptor(e,k):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(A,e,k,B);else for(var h=A.length-1;h>=0;h--)(t=A[h])&&(p=(n<3?t(p):n>3?t(e,k,p):t(e,k))||p);return n>3&&p&&Object.defineProperty(e,k,p),p},s=this&&this.__param||function(A,e){return function(k,B){e(k,B,A)}};Object.defineProperty(j,"__esModule",{value:!0}),j.CharSizeService=void 0;let o=P(2585),a=P(8460),l=P(844),c=class extends l.Disposable{constructor(A,e,k){super(),this._optionsService=k,this.width=0,this.height=0,this._onCharSizeChange=this.register(new a.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new $(A,e,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let A=this._measureStrategy.measure();A.width===this.width&&A.height===this.height||(this.width=A.width,this.height=A.height,this._onCharSizeChange.fire())}};c=r([s(2,o.IOptionsService)],c),j.CharSizeService=c;class ${constructor(e,k,B){this._document=e,this._parentElement=k,this._optionsService=B,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let e=this._measureElement.getBoundingClientRect();return e.width!==0&&e.height!==0&&(this._result.width=e.width,this._result.height=Math.ceil(e.height)),this._result}}},4269:function(S,j,P){var r=this&&this.__decorate||function(e,k,B,t){var n,p=arguments.length,h=p<3?k:t===null?t=Object.getOwnPropertyDescriptor(k,B):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(e,k,B,t);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(h=(p<3?n(h):p>3?n(k,B,h):n(k,B))||h);return p>3&&h&&Object.defineProperty(k,B,h),h},s=this&&this.__param||function(e,k){return function(B,t){k(B,t,e)}};Object.defineProperty(j,"__esModule",{value:!0}),j.CharacterJoinerService=j.JoinedCellData=void 0;let o=P(3734),a=P(643),l=P(511),c=P(2585);class $ extends o.AttributeData{constructor(k,B,t){super(),this.content=0,this.combinedData="",this.fg=k.fg,this.bg=k.bg,this.combinedData=B,this._width=t}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(k){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}j.JoinedCellData=$;let A=class nA{constructor(k){this._bufferService=k,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new l.CellData}register(k){let B={id:this._nextCharacterJoinerId++,handler:k};return this._characterJoiners.push(B),B.id}deregister(k){for(let B=0;B<this._characterJoiners.length;B++)if(this._characterJoiners[B].id===k)return this._characterJoiners.splice(B,1),!0;return!1}getJoinedCharacters(k){if(this._characterJoiners.length===0)return[];let B=this._bufferService.buffer.lines.get(k);if(!B||B.length===0)return[];let t=[],n=B.translateToString(!0),p=0,h=0,i=0,g=B.getFg(0),E=B.getBg(0);for(let m=0;m<B.getTrimmedLength();m++)if(B.loadCell(m,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==g||this._workCell.bg!==E){if(m-p>1){let v=this._getJoinedRanges(n,i,h,B,p);for(let x=0;x<v.length;x++)t.push(v[x])}p=m,i=h,g=this._workCell.fg,E=this._workCell.bg}h+=this._workCell.getChars().length||a.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-p>1){let m=this._getJoinedRanges(n,i,h,B,p);for(let v=0;v<m.length;v++)t.push(m[v])}return t}_getJoinedRanges(k,B,t,n,p){let h=k.substring(B,t),i=[];try{i=this._characterJoiners[0].handler(h)}catch(g){console.error(g)}for(let g=1;g<this._characterJoiners.length;g++)try{let E=this._characterJoiners[g].handler(h);for(let m=0;m<E.length;m++)nA._mergeRanges(i,E[m])}catch(E){console.error(E)}return this._stringRangesToCellRanges(i,n,p),i}_stringRangesToCellRanges(k,B,t){let n=0,p=!1,h=0,i=k[n];if(i){for(let g=t;g<this._bufferService.cols;g++){let E=B.getWidth(g),m=B.getString(g).length||a.WHITESPACE_CELL_CHAR.length;if(E!==0){if(!p&&i[0]<=h&&(i[0]=g,p=!0),i[1]<=h){if(i[1]=g,i=k[++n],!i)break;i[0]<=h?(i[0]=g,p=!0):p=!1}h+=m}}i&&(i[1]=this._bufferService.cols)}}static _mergeRanges(k,B){let t=!1;for(let n=0;n<k.length;n++){let p=k[n];if(t){if(B[1]<=p[0])return k[n-1][1]=B[1],k;if(B[1]<=p[1])return k[n-1][1]=Math.max(B[1],p[1]),k.splice(n,1),k;k.splice(n,1),n--}else{if(B[1]<=p[0])return k.splice(n,0,B),k;if(B[1]<=p[1])return p[0]=Math.min(B[0],p[0]),k;B[0]<p[1]&&(p[0]=Math.min(B[0],p[0]),t=!0)}}return t?k[k.length-1][1]=B[1]:k.push(B),k}};A=r([s(0,c.IBufferService)],A),j.CharacterJoinerService=A},5114:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.CoreBrowserService=void 0,j.CoreBrowserService=class{constructor(P,r){this._textarea=P,this.window=r,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(S,j,P){var r=this&&this.__decorate||function(c,$,A,e){var k,B=arguments.length,t=B<3?$:e===null?e=Object.getOwnPropertyDescriptor($,A):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")t=Reflect.decorate(c,$,A,e);else for(var n=c.length-1;n>=0;n--)(k=c[n])&&(t=(B<3?k(t):B>3?k($,A,t):k($,A))||t);return B>3&&t&&Object.defineProperty($,A,t),t},s=this&&this.__param||function(c,$){return function(A,e){$(A,e,c)}};Object.defineProperty(j,"__esModule",{value:!0}),j.MouseService=void 0;let o=P(4725),a=P(9806),l=class{constructor(c,$){this._renderService=c,this._charSizeService=$}getCoords(c,$,A,e,k){return(0,a.getCoords)(window,c,$,A,e,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,k)}getMouseReportCoords(c,$){let A=(0,a.getCoordsRelativeToElement)(window,c,$);if(!(!this._charSizeService.hasValidSize||A[0]<0||A[1]<0||A[0]>=this._renderService.dimensions.css.canvas.width||A[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(A[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(A[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(A[0]),y:Math.floor(A[1])}}};l=r([s(0,o.IRenderService),s(1,o.ICharSizeService)],l),j.MouseService=l},3230:function(S,j,P){var r=this&&this.__decorate||function(t,n,p,h){var i,g=arguments.length,E=g<3?n:h===null?h=Object.getOwnPropertyDescriptor(n,p):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(t,n,p,h);else for(var m=t.length-1;m>=0;m--)(i=t[m])&&(E=(g<3?i(E):g>3?i(n,p,E):i(n,p))||E);return g>3&&E&&Object.defineProperty(n,p,E),E},s=this&&this.__param||function(t,n){return function(p,h){n(p,h,t)}};Object.defineProperty(j,"__esModule",{value:!0}),j.RenderService=void 0;let o=P(6193),a=P(8460),l=P(844),c=P(5596),$=P(3656),A=P(2585),e=P(4725),k=P(7226),B=class extends l.Disposable{constructor(t,n,p,h,i,g,E,m){if(super(),this._rowCount=t,this._charSizeService=h,this._pausedResizeTask=new k.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new a.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new a.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new a.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new a.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var v;return(v=this._renderer)===null||v===void 0?void 0:v.dispose()}}),this._renderDebouncer=new o.RenderDebouncer(E.window,(v,x)=>this._renderRows(v,x)),this.register(this._renderDebouncer),this._screenDprMonitor=new c.ScreenDprMonitor(E.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(g.onResize(()=>this._fullRefresh())),this.register(g.buffers.onBufferActivate(()=>{var v;return(v=this._renderer)===null||v===void 0?void 0:v.clear()})),this.register(p.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(i.onDecorationRegistered(()=>this._fullRefresh())),this.register(i.onDecorationRemoved(()=>this._fullRefresh())),this.register(p.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(g.cols,g.rows),this._fullRefresh()})),this.register(p.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(g.buffer.y,g.buffer.y,!0))),this.register((0,$.addDisposableDomListener)(E.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(m.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in E.window){let v=new E.window.IntersectionObserver(x=>this._handleIntersectionChange(x[x.length-1]),{threshold:0});v.observe(n),this.register({dispose:()=>v.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(t){this._isPaused=t.isIntersecting===void 0?t.intersectionRatio===0:!t.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(t,n,p=!1){this._isPaused?this._needsFullRefresh=!0:(p||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(t,n,this._rowCount))}_renderRows(t,n){this._renderer&&(this._renderer.renderRows(t,n),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:t,end:n}),this._onRender.fire({start:t,end:n}),this._isNextRenderRedrawOnly=!0)}resize(t,n){this._rowCount=n,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(t){var n;(n=this._renderer)===null||n===void 0||n.dispose(),this._renderer=t,this._renderer.onRequestRedraw(p=>this.refreshRows(p.start,p.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(t){return this._renderDebouncer.addRefreshCallback(t)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var t,n;this._renderer&&((n=(t=this._renderer).clearTextureAtlas)===null||n===void 0||n.call(t),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(t,n){this._renderer&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.handleResize(t,n)):this._renderer.handleResize(t,n),this._fullRefresh())}handleCharSizeChanged(){var t;(t=this._renderer)===null||t===void 0||t.handleCharSizeChanged()}handleBlur(){var t;(t=this._renderer)===null||t===void 0||t.handleBlur()}handleFocus(){var t;(t=this._renderer)===null||t===void 0||t.handleFocus()}handleSelectionChanged(t,n,p){var h;this._selectionState.start=t,this._selectionState.end=n,this._selectionState.columnSelectMode=p,(h=this._renderer)===null||h===void 0||h.handleSelectionChanged(t,n,p)}handleCursorMove(){var t;(t=this._renderer)===null||t===void 0||t.handleCursorMove()}clear(){var t;(t=this._renderer)===null||t===void 0||t.clear()}};B=r([s(2,A.IOptionsService),s(3,e.ICharSizeService),s(4,A.IDecorationService),s(5,A.IBufferService),s(6,e.ICoreBrowserService),s(7,e.IThemeService)],B),j.RenderService=B},9312:function(S,j,P){var r=this&&this.__decorate||function(i,g,E,m){var v,x=arguments.length,y=x<3?g:m===null?m=Object.getOwnPropertyDescriptor(g,E):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(i,g,E,m);else for(var I=i.length-1;I>=0;I--)(v=i[I])&&(y=(x<3?v(y):x>3?v(g,E,y):v(g,E))||y);return x>3&&y&&Object.defineProperty(g,E,y),y},s=this&&this.__param||function(i,g){return function(E,m){g(E,m,i)}};Object.defineProperty(j,"__esModule",{value:!0}),j.SelectionService=void 0;let o=P(6114),a=P(456),l=P(511),c=P(8460),$=P(4725),A=P(2585),e=P(9806),k=P(9504),B=P(844),t=P(4841),n="\xA0",p=new RegExp(n,"g"),h=class extends B.Disposable{constructor(i,g,E,m,v,x,y,I,F){super(),this._element=i,this._screenElement=g,this._linkifier=E,this._bufferService=m,this._coreService=v,this._mouseService=x,this._optionsService=y,this._renderService=I,this._coreBrowserService=F,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new l.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=d=>this._handleMouseMove(d),this._mouseUpListener=d=>this._handleMouseUp(d),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(d=>this._handleTrim(d)),this.register(this._bufferService.buffers.onBufferActivate(d=>this._handleBufferActivate(d))),this.enable(),this._model=new a.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,B.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let i=this._model.finalSelectionStart,g=this._model.finalSelectionEnd;return!(!i||!g||i[0]===g[0]&&i[1]===g[1])}get selectionText(){let i=this._model.finalSelectionStart,g=this._model.finalSelectionEnd;if(!i||!g)return"";let E=this._bufferService.buffer,m=[];if(this._activeSelectionMode===3){if(i[0]===g[0])return"";let v=i[0]<g[0]?i[0]:g[0],x=i[0]<g[0]?g[0]:i[0];for(let y=i[1];y<=g[1];y++){let I=E.translateBufferLineToString(y,!0,v,x);m.push(I)}}else{let v=i[1]===g[1]?g[0]:void 0;m.push(E.translateBufferLineToString(i[1],!0,i[0],v));for(let x=i[1]+1;x<=g[1]-1;x++){let y=E.lines.get(x),I=E.translateBufferLineToString(x,!0);y!=null&&y.isWrapped?m[m.length-1]+=I:m.push(I)}if(i[1]!==g[1]){let x=E.lines.get(g[1]),y=E.translateBufferLineToString(g[1],!0,0,g[0]);x&&x.isWrapped?m[m.length-1]+=y:m.push(y)}}return m.map(v=>v.replace(p," ")).join(o.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(i){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),o.isLinux&&i&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(i){let g=this._getMouseBufferCoords(i),E=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!!(E&&m&&g)&&this._areCoordsInSelection(g,E,m)}isCellInSelection(i,g){let E=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!(!E||!m)&&this._areCoordsInSelection([i,g],E,m)}_areCoordsInSelection(i,g,E){return i[1]>g[1]&&i[1]<E[1]||g[1]===E[1]&&i[1]===g[1]&&i[0]>=g[0]&&i[0]<E[0]||g[1]<E[1]&&i[1]===E[1]&&i[0]<E[0]||g[1]<E[1]&&i[1]===g[1]&&i[0]>=g[0]}_selectWordAtCursor(i,g){var E,m;let v=(m=(E=this._linkifier.currentLink)===null||E===void 0?void 0:E.link)===null||m===void 0?void 0:m.range;if(v)return this._model.selectionStart=[v.start.x-1,v.start.y-1],this._model.selectionStartLength=(0,t.getRangeLength)(v,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let x=this._getMouseBufferCoords(i);return!!x&&(this._selectWordAt(x,g),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(i,g){this._model.clearSelection(),i=Math.max(i,0),g=Math.min(g,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,i],this._model.selectionEnd=[this._bufferService.cols,g],this.refresh(),this._onSelectionChange.fire()}_handleTrim(i){this._model.handleTrim(i)&&this.refresh()}_getMouseBufferCoords(i){let g=this._mouseService.getCoords(i,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(g)return g[0]--,g[1]--,g[1]+=this._bufferService.buffer.ydisp,g}_getMouseEventScrollAmount(i){let g=(0,e.getCoordsRelativeToElement)(this._coreBrowserService.window,i,this._screenElement)[1],E=this._renderService.dimensions.css.canvas.height;return g>=0&&g<=E?0:(g>E&&(g-=E),g=Math.min(Math.max(g,-50),50),g/=50,g/Math.abs(g)+Math.round(14*g))}shouldForceSelection(i){return o.isMac?i.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:i.shiftKey}handleMouseDown(i){if(this._mouseDownTimeStamp=i.timeStamp,(i.button!==2||!this.hasSelection)&&i.button===0){if(!this._enabled){if(!this.shouldForceSelection(i))return;i.stopPropagation()}i.preventDefault(),this._dragScrollAmount=0,this._enabled&&i.shiftKey?this._handleIncrementalClick(i):i.detail===1?this._handleSingleClick(i):i.detail===2?this._handleDoubleClick(i):i.detail===3&&this._handleTripleClick(i),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(i){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(i))}_handleSingleClick(i){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(i)?3:0,this._model.selectionStart=this._getMouseBufferCoords(i),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let g=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);g&&g.length!==this._model.selectionStart[0]&&g.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(i){this._selectWordAtCursor(i,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(i){let g=this._getMouseBufferCoords(i);g&&(this._activeSelectionMode=2,this._selectLineAt(g[1]))}shouldColumnSelect(i){return i.altKey&&!(o.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(i){if(i.stopImmediatePropagation(),!this._model.selectionStart)return;let g=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(i),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(i),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let E=this._bufferService.buffer;if(this._model.selectionEnd[1]<E.lines.length){let m=E.lines.get(this._model.selectionEnd[1]);m&&m.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}g&&g[0]===this._model.selectionEnd[0]&&g[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let i=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(i.ydisp+this._bufferService.rows,i.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=i.ydisp),this.refresh()}}_handleMouseUp(i){let g=i.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&g<500&&i.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let E=this._mouseService.getCoords(i,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(E&&E[0]!==void 0&&E[1]!==void 0){let m=(0,k.moveToCellSequence)(E[0]-1,E[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(m,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let i=this._model.finalSelectionStart,g=this._model.finalSelectionEnd,E=!(!i||!g||i[0]===g[0]&&i[1]===g[1]);E?i&&g&&(this._oldSelectionStart&&this._oldSelectionEnd&&i[0]===this._oldSelectionStart[0]&&i[1]===this._oldSelectionStart[1]&&g[0]===this._oldSelectionEnd[0]&&g[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(i,g,E)):this._oldHasSelection&&this._fireOnSelectionChange(i,g,E)}_fireOnSelectionChange(i,g,E){this._oldSelectionStart=i,this._oldSelectionEnd=g,this._oldHasSelection=E,this._onSelectionChange.fire()}_handleBufferActivate(i){this.clearSelection(),this._trimListener.dispose(),this._trimListener=i.activeBuffer.lines.onTrim(g=>this._handleTrim(g))}_convertViewportColToCharacterIndex(i,g){let E=g;for(let m=0;g>=m;m++){let v=i.loadCell(m,this._workCell).getChars().length;this._workCell.getWidth()===0?E--:v>1&&g!==m&&(E+=v-1)}return E}setSelection(i,g,E){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[i,g],this._model.selectionStartLength=E,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(i){this._isClickInSelection(i)||(this._selectWordAtCursor(i,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(i,g,E=!0,m=!0){if(i[0]>=this._bufferService.cols)return;let v=this._bufferService.buffer,x=v.lines.get(i[1]);if(!x)return;let y=v.translateBufferLineToString(i[1],!1),I=this._convertViewportColToCharacterIndex(x,i[0]),F=I,d=i[0]-I,u=0,H=0,R=0,b=0;if(y.charAt(I)===" "){for(;I>0&&y.charAt(I-1)===" ";)I--;for(;F<y.length&&y.charAt(F+1)===" ";)F++}else{let D=i[0],W=i[0];x.getWidth(D)===0&&(u++,D--),x.getWidth(W)===2&&(H++,W++);let f=x.getString(W).length;for(f>1&&(b+=f-1,F+=f-1);D>0&&I>0&&!this._isCharWordSeparator(x.loadCell(D-1,this._workCell));){x.loadCell(D-1,this._workCell);let X=this._workCell.getChars().length;this._workCell.getWidth()===0?(u++,D--):X>1&&(R+=X-1,I-=X-1),I--,D--}for(;W<x.length&&F+1<y.length&&!this._isCharWordSeparator(x.loadCell(W+1,this._workCell));){x.loadCell(W+1,this._workCell);let X=this._workCell.getChars().length;this._workCell.getWidth()===2?(H++,W++):X>1&&(b+=X-1,F+=X-1),F++,W++}}F++;let Q=I+d-u+R,V=Math.min(this._bufferService.cols,F-I+u+H-R-b);if(g||y.slice(I,F).trim()!==""){if(E&&Q===0&&x.getCodePoint(0)!==32){let D=v.lines.get(i[1]-1);if(D&&x.isWrapped&&D.getCodePoint(this._bufferService.cols-1)!==32){let W=this._getWordAt([this._bufferService.cols-1,i[1]-1],!1,!0,!1);if(W){let f=this._bufferService.cols-W.start;Q-=f,V+=f}}}if(m&&Q+V===this._bufferService.cols&&x.getCodePoint(this._bufferService.cols-1)!==32){let D=v.lines.get(i[1]+1);if(D!=null&&D.isWrapped&&D.getCodePoint(0)!==32){let W=this._getWordAt([0,i[1]+1],!1,!1,!0);W&&(V+=W.length)}}return{start:Q,length:V}}}_selectWordAt(i,g){let E=this._getWordAt(i,g);if(E){for(;E.start<0;)E.start+=this._bufferService.cols,i[1]--;this._model.selectionStart=[E.start,i[1]],this._model.selectionStartLength=E.length}}_selectToWordAt(i){let g=this._getWordAt(i,!0);if(g){let E=i[1];for(;g.start<0;)g.start+=this._bufferService.cols,E--;if(!this._model.areSelectionValuesReversed())for(;g.start+g.length>this._bufferService.cols;)g.length-=this._bufferService.cols,E++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?g.start:g.start+g.length,E]}}_isCharWordSeparator(i){return i.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(i.getChars())>=0}_selectLineAt(i){let g=this._bufferService.buffer.getWrappedRangeForLine(i),E={start:{x:0,y:g.first},end:{x:this._bufferService.cols-1,y:g.last}};this._model.selectionStart=[0,g.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,t.getRangeLength)(E,this._bufferService.cols)}};h=r([s(3,A.IBufferService),s(4,A.ICoreService),s(5,$.IMouseService),s(6,A.IOptionsService),s(7,$.IRenderService),s(8,$.ICoreBrowserService)],h),j.SelectionService=h},4725:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.IThemeService=j.ICharacterJoinerService=j.ISelectionService=j.IRenderService=j.IMouseService=j.ICoreBrowserService=j.ICharSizeService=void 0;let r=P(8343);j.ICharSizeService=(0,r.createDecorator)("CharSizeService"),j.ICoreBrowserService=(0,r.createDecorator)("CoreBrowserService"),j.IMouseService=(0,r.createDecorator)("MouseService"),j.IRenderService=(0,r.createDecorator)("RenderService"),j.ISelectionService=(0,r.createDecorator)("SelectionService"),j.ICharacterJoinerService=(0,r.createDecorator)("CharacterJoinerService"),j.IThemeService=(0,r.createDecorator)("ThemeService")},6731:function(S,j,P){var r=this&&this.__decorate||function(h,i,g,E){var m,v=arguments.length,x=v<3?i:E===null?E=Object.getOwnPropertyDescriptor(i,g):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(h,i,g,E);else for(var y=h.length-1;y>=0;y--)(m=h[y])&&(x=(v<3?m(x):v>3?m(i,g,x):m(i,g))||x);return v>3&&x&&Object.defineProperty(i,g,x),x},s=this&&this.__param||function(h,i){return function(g,E){i(g,E,h)}};Object.defineProperty(j,"__esModule",{value:!0}),j.ThemeService=j.DEFAULT_ANSI_COLORS=void 0;let o=P(7239),a=P(8055),l=P(8460),c=P(844),$=P(2585),A=a.css.toColor("#ffffff"),e=a.css.toColor("#000000"),k=a.css.toColor("#ffffff"),B=a.css.toColor("#000000"),t={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};j.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let h=[a.css.toColor("#2e3436"),a.css.toColor("#cc0000"),a.css.toColor("#4e9a06"),a.css.toColor("#c4a000"),a.css.toColor("#3465a4"),a.css.toColor("#75507b"),a.css.toColor("#06989a"),a.css.toColor("#d3d7cf"),a.css.toColor("#555753"),a.css.toColor("#ef2929"),a.css.toColor("#8ae234"),a.css.toColor("#fce94f"),a.css.toColor("#729fcf"),a.css.toColor("#ad7fa8"),a.css.toColor("#34e2e2"),a.css.toColor("#eeeeec")],i=[0,95,135,175,215,255];for(let g=0;g<216;g++){let E=i[g/36%6|0],m=i[g/6%6|0],v=i[g%6];h.push({css:a.channels.toCss(E,m,v),rgba:a.channels.toRgba(E,m,v)})}for(let g=0;g<24;g++){let E=8+10*g;h.push({css:a.channels.toCss(E,E,E),rgba:a.channels.toRgba(E,E,E)})}return h})());let n=class extends c.Disposable{constructor(h){super(),this._optionsService=h,this._onChangeColors=this.register(new l.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new o.ColorContrastCache,this._colors={foreground:A,background:e,cursor:k,cursorAccent:B,selectionForeground:void 0,selectionBackgroundTransparent:t,selectionBackgroundOpaque:a.color.blend(e,t),selectionInactiveBackgroundTransparent:t,selectionInactiveBackgroundOpaque:a.color.blend(e,t),ansi:j.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(h={}){let i=this._colors;if(i.foreground=p(h.foreground,A),i.background=p(h.background,e),i.cursor=p(h.cursor,k),i.cursorAccent=p(h.cursorAccent,B),i.selectionBackgroundTransparent=p(h.selectionBackground,t),i.selectionBackgroundOpaque=a.color.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=p(h.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=a.color.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=h.selectionForeground?p(h.selectionForeground,a.NULL_COLOR):void 0,i.selectionForeground===a.NULL_COLOR&&(i.selectionForeground=void 0),a.color.isOpaque(i.selectionBackgroundTransparent)&&(i.selectionBackgroundTransparent=a.color.opacity(i.selectionBackgroundTransparent,.3)),a.color.isOpaque(i.selectionInactiveBackgroundTransparent)&&(i.selectionInactiveBackgroundTransparent=a.color.opacity(i.selectionInactiveBackgroundTransparent,.3)),i.ansi=j.DEFAULT_ANSI_COLORS.slice(),i.ansi[0]=p(h.black,j.DEFAULT_ANSI_COLORS[0]),i.ansi[1]=p(h.red,j.DEFAULT_ANSI_COLORS[1]),i.ansi[2]=p(h.green,j.DEFAULT_ANSI_COLORS[2]),i.ansi[3]=p(h.yellow,j.DEFAULT_ANSI_COLORS[3]),i.ansi[4]=p(h.blue,j.DEFAULT_ANSI_COLORS[4]),i.ansi[5]=p(h.magenta,j.DEFAULT_ANSI_COLORS[5]),i.ansi[6]=p(h.cyan,j.DEFAULT_ANSI_COLORS[6]),i.ansi[7]=p(h.white,j.DEFAULT_ANSI_COLORS[7]),i.ansi[8]=p(h.brightBlack,j.DEFAULT_ANSI_COLORS[8]),i.ansi[9]=p(h.brightRed,j.DEFAULT_ANSI_COLORS[9]),i.ansi[10]=p(h.brightGreen,j.DEFAULT_ANSI_COLORS[10]),i.ansi[11]=p(h.brightYellow,j.DEFAULT_ANSI_COLORS[11]),i.ansi[12]=p(h.brightBlue,j.DEFAULT_ANSI_COLORS[12]),i.ansi[13]=p(h.brightMagenta,j.DEFAULT_ANSI_COLORS[13]),i.ansi[14]=p(h.brightCyan,j.DEFAULT_ANSI_COLORS[14]),i.ansi[15]=p(h.brightWhite,j.DEFAULT_ANSI_COLORS[15]),h.extendedAnsi){let g=Math.min(i.ansi.length-16,h.extendedAnsi.length);for(let E=0;E<g;E++)i.ansi[E+16]=p(h.extendedAnsi[E],j.DEFAULT_ANSI_COLORS[E+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(h){this._restoreColor(h),this._onChangeColors.fire(this.colors)}_restoreColor(h){if(h!==void 0)switch(h){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[h]=this._restoreColors.ansi[h]}else for(let i=0;i<this._restoreColors.ansi.length;++i)this._colors.ansi[i]=this._restoreColors.ansi[i]}modifyColors(h){h(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(h,i){if(h!==void 0)try{return a.css.toColor(h)}catch(g){}return i}n=r([s(0,$.IOptionsService)],n),j.ThemeService=n},6349:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.CircularList=void 0;let r=P(8460),s=P(844);class o extends s.Disposable{constructor(l){super(),this._maxLength=l,this.onDeleteEmitter=this.register(new r.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new r.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new r.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(l){if(this._maxLength===l)return;let c=new Array(l);for(let $=0;$<Math.min(l,this.length);$++)c[$]=this._array[this._getCyclicIndex($)];this._array=c,this._maxLength=l,this._startIndex=0}get length(){return this._length}set length(l){if(l>this._length)for(let c=this._length;c<l;c++)this._array[c]=void 0;this._length=l}get(l){return this._array[this._getCyclicIndex(l)]}set(l,c){this._array[this._getCyclicIndex(l)]=c}push(l){this._array[this._getCyclicIndex(this._length)]=l,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(l,c,...$){if(c){for(let A=l;A<this._length-c;A++)this._array[this._getCyclicIndex(A)]=this._array[this._getCyclicIndex(A+c)];this._length-=c,this.onDeleteEmitter.fire({index:l,amount:c})}for(let A=this._length-1;A>=l;A--)this._array[this._getCyclicIndex(A+$.length)]=this._array[this._getCyclicIndex(A)];for(let A=0;A<$.length;A++)this._array[this._getCyclicIndex(l+A)]=$[A];if($.length&&this.onInsertEmitter.fire({index:l,amount:$.length}),this._length+$.length>this._maxLength){let A=this._length+$.length-this._maxLength;this._startIndex+=A,this._length=this._maxLength,this.onTrimEmitter.fire(A)}else this._length+=$.length}trimStart(l){l>this._length&&(l=this._length),this._startIndex+=l,this._length-=l,this.onTrimEmitter.fire(l)}shiftElements(l,c,$){if(!(c<=0)){if(l<0||l>=this._length)throw new Error("start argument out of range");if(l+$<0)throw new Error("Cannot shift elements in list beyond index 0");if($>0){for(let e=c-1;e>=0;e--)this.set(l+e+$,this.get(l+e));let A=l+c+$-this._length;if(A>0)for(this._length+=A;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let A=0;A<c;A++)this.set(l+A+$,this.get(l+A))}}_getCyclicIndex(l){return(this._startIndex+l)%this._maxLength}}j.CircularList=o},1439:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.clone=void 0,j.clone=function P(r,s=5){if(typeof r!="object")return r;let o=Array.isArray(r)?[]:{};for(let a in r)o[a]=s<=1?r[a]:r[a]&&P(r[a],s-1);return o}},8055:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.contrastRatio=j.toPaddedHex=j.rgba=j.rgb=j.css=j.color=j.channels=j.NULL_COLOR=void 0;let r=P(6114),s=0,o=0,a=0,l=0;var c,$,A;function e(B){let t=B.toString(16);return t.length<2?"0"+t:t}function k(B,t){return B<t?(t+.05)/(B+.05):(B+.05)/(t+.05)}j.NULL_COLOR={css:"#00000000",rgba:0},function(B){B.toCss=function(t,n,p,h){return h!==void 0?`#${e(t)}${e(n)}${e(p)}${e(h)}`:`#${e(t)}${e(n)}${e(p)}`},B.toRgba=function(t,n,p,h=255){return(t<<24|n<<16|p<<8|h)>>>0}}(c=j.channels||(j.channels={})),function(B){function t(n,p){return l=Math.round(255*p),[s,o,a]=A.toChannels(n.rgba),{css:c.toCss(s,o,a,l),rgba:c.toRgba(s,o,a,l)}}B.blend=function(n,p){if(l=(255&p.rgba)/255,l===1)return{css:p.css,rgba:p.rgba};let h=p.rgba>>24&255,i=p.rgba>>16&255,g=p.rgba>>8&255,E=n.rgba>>24&255,m=n.rgba>>16&255,v=n.rgba>>8&255;return s=E+Math.round((h-E)*l),o=m+Math.round((i-m)*l),a=v+Math.round((g-v)*l),{css:c.toCss(s,o,a),rgba:c.toRgba(s,o,a)}},B.isOpaque=function(n){return(255&n.rgba)==255},B.ensureContrastRatio=function(n,p,h){let i=A.ensureContrastRatio(n.rgba,p.rgba,h);if(i)return A.toColor(i>>24&255,i>>16&255,i>>8&255)},B.opaque=function(n){let p=(255|n.rgba)>>>0;return[s,o,a]=A.toChannels(p),{css:c.toCss(s,o,a),rgba:p}},B.opacity=t,B.multiplyOpacity=function(n,p){return l=255&n.rgba,t(n,l*p/255)},B.toColorRGB=function(n){return[n.rgba>>24&255,n.rgba>>16&255,n.rgba>>8&255]}}(j.color||(j.color={})),function(B){let t,n;if(!r.isNode){let p=document.createElement("canvas");p.width=1,p.height=1;let h=p.getContext("2d",{willReadFrequently:!0});h&&(t=h,t.globalCompositeOperation="copy",n=t.createLinearGradient(0,0,1,1))}B.toColor=function(p){if(p.match(/#[\da-f]{3,8}/i))switch(p.length){case 4:return s=parseInt(p.slice(1,2).repeat(2),16),o=parseInt(p.slice(2,3).repeat(2),16),a=parseInt(p.slice(3,4).repeat(2),16),A.toColor(s,o,a);case 5:return s=parseInt(p.slice(1,2).repeat(2),16),o=parseInt(p.slice(2,3).repeat(2),16),a=parseInt(p.slice(3,4).repeat(2),16),l=parseInt(p.slice(4,5).repeat(2),16),A.toColor(s,o,a,l);case 7:return{css:p,rgba:(parseInt(p.slice(1),16)<<8|255)>>>0};case 9:return{css:p,rgba:parseInt(p.slice(1),16)>>>0}}let h=p.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(h)return s=parseInt(h[1]),o=parseInt(h[2]),a=parseInt(h[3]),l=Math.round(255*(h[5]===void 0?1:parseFloat(h[5]))),A.toColor(s,o,a,l);if(!t||!n)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=n,t.fillStyle=p,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[s,o,a,l]=t.getImageData(0,0,1,1).data,l!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:c.toRgba(s,o,a,l),css:p}}}(j.css||(j.css={})),function(B){function t(n,p,h){let i=n/255,g=p/255,E=h/255;return .2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))+.0722*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))}B.relativeLuminance=function(n){return t(n>>16&255,n>>8&255,255&n)},B.relativeLuminance2=t}($=j.rgb||(j.rgb={})),function(B){function t(p,h,i){let g=p>>24&255,E=p>>16&255,m=p>>8&255,v=h>>24&255,x=h>>16&255,y=h>>8&255,I=k($.relativeLuminance2(v,x,y),$.relativeLuminance2(g,E,m));for(;I<i&&(v>0||x>0||y>0);)v-=Math.max(0,Math.ceil(.1*v)),x-=Math.max(0,Math.ceil(.1*x)),y-=Math.max(0,Math.ceil(.1*y)),I=k($.relativeLuminance2(v,x,y),$.relativeLuminance2(g,E,m));return(v<<24|x<<16|y<<8|255)>>>0}function n(p,h,i){let g=p>>24&255,E=p>>16&255,m=p>>8&255,v=h>>24&255,x=h>>16&255,y=h>>8&255,I=k($.relativeLuminance2(v,x,y),$.relativeLuminance2(g,E,m));for(;I<i&&(v<255||x<255||y<255);)v=Math.min(255,v+Math.ceil(.1*(255-v))),x=Math.min(255,x+Math.ceil(.1*(255-x))),y=Math.min(255,y+Math.ceil(.1*(255-y))),I=k($.relativeLuminance2(v,x,y),$.relativeLuminance2(g,E,m));return(v<<24|x<<16|y<<8|255)>>>0}B.ensureContrastRatio=function(p,h,i){let g=$.relativeLuminance(p>>8),E=$.relativeLuminance(h>>8);if(k(g,E)<i){if(E<g){let x=t(p,h,i),y=k(g,$.relativeLuminance(x>>8));if(y<i){let I=n(p,h,i);return y>k(g,$.relativeLuminance(I>>8))?x:I}return x}let m=n(p,h,i),v=k(g,$.relativeLuminance(m>>8));if(v<i){let x=t(p,h,i);return v>k(g,$.relativeLuminance(x>>8))?m:x}return m}},B.reduceLuminance=t,B.increaseLuminance=n,B.toChannels=function(p){return[p>>24&255,p>>16&255,p>>8&255,255&p]},B.toColor=function(p,h,i,g){return{css:c.toCss(p,h,i,g),rgba:c.toRgba(p,h,i,g)}}}(A=j.rgba||(j.rgba={})),j.toPaddedHex=e,j.contrastRatio=k},8969:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.CoreTerminal=void 0;let r=P(844),s=P(2585),o=P(4348),a=P(7866),l=P(744),c=P(7302),$=P(6975),A=P(8460),e=P(1753),k=P(1480),B=P(7994),t=P(9282),n=P(5435),p=P(5981),h=P(2660),i=!1;class g extends r.Disposable{constructor(m){super(),this._onBinary=this.register(new A.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new A.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new A.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new A.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new A.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new A.EventEmitter),this._instantiationService=new o.InstantiationService,this.optionsService=this.register(new c.OptionsService(m)),this._instantiationService.setService(s.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(l.BufferService)),this._instantiationService.setService(s.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(a.LogService)),this._instantiationService.setService(s.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance($.CoreService)),this._instantiationService.setService(s.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(e.CoreMouseService)),this._instantiationService.setService(s.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(k.UnicodeService)),this._instantiationService.setService(s.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(B.CharsetService),this._instantiationService.setService(s.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(h.OscLinkService),this._instantiationService.setService(s.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new n.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,A.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,A.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,A.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,A.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onSpecificOptionChange("windowsMode",v=>this._handleWindowsModeOptionChange(v))),this.register(this._bufferService.onScroll(v=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(v=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new p.WriteBuffer((v,x)=>this._inputHandler.parse(v,x))),this.register((0,A.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,r.toDisposable)(()=>{var v;(v=this._windowsMode)===null||v===void 0||v.dispose(),this._windowsMode=void 0}))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new A.EventEmitter),this._onScroll.event(m=>{var v;(v=this._onScrollApi)===null||v===void 0||v.fire(m.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(m){for(let v in m)this.optionsService.options[v]=m[v]}write(m,v){this._writeBuffer.write(m,v)}writeSync(m,v){this._logService.logLevel<=s.LogLevelEnum.WARN&&!i&&(this._logService.warn("writeSync is unreliable and will be removed soon."),i=!0),this._writeBuffer.writeSync(m,v)}resize(m,v){isNaN(m)||isNaN(v)||(m=Math.max(m,l.MINIMUM_COLS),v=Math.max(v,l.MINIMUM_ROWS),this._bufferService.resize(m,v))}scroll(m,v=!1){this._bufferService.scroll(m,v)}scrollLines(m,v,x){this._bufferService.scrollLines(m,v,x)}scrollPages(m){this._bufferService.scrollPages(m)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(m){this._bufferService.scrollToLine(m)}registerEscHandler(m,v){return this._inputHandler.registerEscHandler(m,v)}registerDcsHandler(m,v){return this._inputHandler.registerDcsHandler(m,v)}registerCsiHandler(m,v){return this._inputHandler.registerCsiHandler(m,v)}registerOscHandler(m,v){return this._inputHandler.registerOscHandler(m,v)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(m){var v;m?this._enableWindowsMode():((v=this._windowsMode)===null||v===void 0||v.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){let m=[];m.push(this.onLineFeed(t.updateWindowsModeWrappedState.bind(null,this._bufferService))),m.push(this.registerCsiHandler({final:"H"},()=>((0,t.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsMode={dispose:()=>{for(let v of m)v.dispose()}}}}}j.CoreTerminal=g},8460:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.forwardEvent=j.EventEmitter=void 0,j.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=P=>(this._listeners.push(P),{dispose:()=>{if(!this._disposed){for(let r=0;r<this._listeners.length;r++)if(this._listeners[r]===P)return void this._listeners.splice(r,1)}}})),this._event}fire(P,r){let s=[];for(let o=0;o<this._listeners.length;o++)s.push(this._listeners[o]);for(let o=0;o<s.length;o++)s[o].call(void 0,P,r)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},j.forwardEvent=function(P,r){return P(s=>r.fire(s))}},5435:function(S,j,P){var r=this&&this.__decorate||function(F,d,u,H){var R,b=arguments.length,Q=b<3?d:H===null?H=Object.getOwnPropertyDescriptor(d,u):H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(F,d,u,H);else for(var V=F.length-1;V>=0;V--)(R=F[V])&&(Q=(b<3?R(Q):b>3?R(d,u,Q):R(d,u))||Q);return b>3&&Q&&Object.defineProperty(d,u,Q),Q},s=this&&this.__param||function(F,d){return function(u,H){d(u,H,F)}};Object.defineProperty(j,"__esModule",{value:!0}),j.InputHandler=j.WindowsOptionsReportType=void 0;let o=P(2584),a=P(7116),l=P(2015),c=P(844),$=P(482),A=P(8437),e=P(8460),k=P(643),B=P(511),t=P(3734),n=P(2585),p=P(6242),h=P(6351),i=P(5941),g={"(":0,")":1,"*":2,"+":3,"-":1,".":2},E=131072;function m(F,d){if(F>24)return d.setWinLines||!1;switch(F){case 1:return!!d.restoreWin;case 2:return!!d.minimizeWin;case 3:return!!d.setWinPosition;case 4:return!!d.setWinSizePixels;case 5:return!!d.raiseWin;case 6:return!!d.lowerWin;case 7:return!!d.refreshWin;case 8:return!!d.setWinSizeChars;case 9:return!!d.maximizeWin;case 10:return!!d.fullscreenWin;case 11:return!!d.getWinState;case 13:return!!d.getWinPosition;case 14:return!!d.getWinSizePixels;case 15:return!!d.getScreenSizePixels;case 16:return!!d.getCellSizePixels;case 18:return!!d.getWinSizeChars;case 19:return!!d.getScreenSizeChars;case 20:return!!d.getIconTitle;case 21:return!!d.getWinTitle;case 22:return!!d.pushTitle;case 23:return!!d.popTitle;case 24:return!!d.setWinLines}return!1}var v;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(v=j.WindowsOptionsReportType||(j.WindowsOptionsReportType={}));let x=0;class y extends c.Disposable{constructor(d,u,H,R,b,Q,V,D,W=new l.EscapeSequenceParser){super(),this._bufferService=d,this._charsetService=u,this._coreService=H,this._logService=R,this._optionsService=b,this._oscLinkService=Q,this._coreMouseService=V,this._unicodeService=D,this._parser=W,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new $.StringToUtf32,this._utf8Decoder=new $.Utf8ToUtf32,this._workCell=new B.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new e.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new e.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new e.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new e.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new e.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new e.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new e.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new e.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new e.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new e.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new e.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new e.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new I(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(f=>this._activeBuffer=f.activeBuffer)),this._parser.setCsiHandlerFallback((f,X)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(f),params:X.toArray()})}),this._parser.setEscHandlerFallback(f=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(f)})}),this._parser.setExecuteHandlerFallback(f=>{this._logService.debug("Unknown EXECUTE code: ",{code:f})}),this._parser.setOscHandlerFallback((f,X,C)=>{this._logService.debug("Unknown OSC code: ",{identifier:f,action:X,data:C})}),this._parser.setDcsHandlerFallback((f,X,C)=>{X==="HOOK"&&(C=C.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(f),action:X,payload:C})}),this._parser.setPrintHandler((f,X,C)=>this.print(f,X,C)),this._parser.registerCsiHandler({final:"@"},f=>this.insertChars(f)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},f=>this.scrollLeft(f)),this._parser.registerCsiHandler({final:"A"},f=>this.cursorUp(f)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},f=>this.scrollRight(f)),this._parser.registerCsiHandler({final:"B"},f=>this.cursorDown(f)),this._parser.registerCsiHandler({final:"C"},f=>this.cursorForward(f)),this._parser.registerCsiHandler({final:"D"},f=>this.cursorBackward(f)),this._parser.registerCsiHandler({final:"E"},f=>this.cursorNextLine(f)),this._parser.registerCsiHandler({final:"F"},f=>this.cursorPrecedingLine(f)),this._parser.registerCsiHandler({final:"G"},f=>this.cursorCharAbsolute(f)),this._parser.registerCsiHandler({final:"H"},f=>this.cursorPosition(f)),this._parser.registerCsiHandler({final:"I"},f=>this.cursorForwardTab(f)),this._parser.registerCsiHandler({final:"J"},f=>this.eraseInDisplay(f,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},f=>this.eraseInDisplay(f,!0)),this._parser.registerCsiHandler({final:"K"},f=>this.eraseInLine(f,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},f=>this.eraseInLine(f,!0)),this._parser.registerCsiHandler({final:"L"},f=>this.insertLines(f)),this._parser.registerCsiHandler({final:"M"},f=>this.deleteLines(f)),this._parser.registerCsiHandler({final:"P"},f=>this.deleteChars(f)),this._parser.registerCsiHandler({final:"S"},f=>this.scrollUp(f)),this._parser.registerCsiHandler({final:"T"},f=>this.scrollDown(f)),this._parser.registerCsiHandler({final:"X"},f=>this.eraseChars(f)),this._parser.registerCsiHandler({final:"Z"},f=>this.cursorBackwardTab(f)),this._parser.registerCsiHandler({final:"`"},f=>this.charPosAbsolute(f)),this._parser.registerCsiHandler({final:"a"},f=>this.hPositionRelative(f)),this._parser.registerCsiHandler({final:"b"},f=>this.repeatPrecedingCharacter(f)),this._parser.registerCsiHandler({final:"c"},f=>this.sendDeviceAttributesPrimary(f)),this._parser.registerCsiHandler({prefix:">",final:"c"},f=>this.sendDeviceAttributesSecondary(f)),this._parser.registerCsiHandler({final:"d"},f=>this.linePosAbsolute(f)),this._parser.registerCsiHandler({final:"e"},f=>this.vPositionRelative(f)),this._parser.registerCsiHandler({final:"f"},f=>this.hVPosition(f)),this._parser.registerCsiHandler({final:"g"},f=>this.tabClear(f)),this._parser.registerCsiHandler({final:"h"},f=>this.setMode(f)),this._parser.registerCsiHandler({prefix:"?",final:"h"},f=>this.setModePrivate(f)),this._parser.registerCsiHandler({final:"l"},f=>this.resetMode(f)),this._parser.registerCsiHandler({prefix:"?",final:"l"},f=>this.resetModePrivate(f)),this._parser.registerCsiHandler({final:"m"},f=>this.charAttributes(f)),this._parser.registerCsiHandler({final:"n"},f=>this.deviceStatus(f)),this._parser.registerCsiHandler({prefix:"?",final:"n"},f=>this.deviceStatusPrivate(f)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},f=>this.softReset(f)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},f=>this.setCursorStyle(f)),this._parser.registerCsiHandler({final:"r"},f=>this.setScrollRegion(f)),this._parser.registerCsiHandler({final:"s"},f=>this.saveCursor(f)),this._parser.registerCsiHandler({final:"t"},f=>this.windowOptions(f)),this._parser.registerCsiHandler({final:"u"},f=>this.restoreCursor(f)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},f=>this.insertColumns(f)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},f=>this.deleteColumns(f)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},f=>this.selectProtected(f)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},f=>this.requestMode(f,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},f=>this.requestMode(f,!1)),this._parser.setExecuteHandler(o.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(o.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(o.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(o.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(o.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(o.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(o.C1.IND,()=>this.index()),this._parser.setExecuteHandler(o.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(o.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new p.OscHandler(f=>(this.setTitle(f),this.setIconName(f),!0))),this._parser.registerOscHandler(1,new p.OscHandler(f=>this.setIconName(f))),this._parser.registerOscHandler(2,new p.OscHandler(f=>this.setTitle(f))),this._parser.registerOscHandler(4,new p.OscHandler(f=>this.setOrReportIndexedColor(f))),this._parser.registerOscHandler(8,new p.OscHandler(f=>this.setHyperlink(f))),this._parser.registerOscHandler(10,new p.OscHandler(f=>this.setOrReportFgColor(f))),this._parser.registerOscHandler(11,new p.OscHandler(f=>this.setOrReportBgColor(f))),this._parser.registerOscHandler(12,new p.OscHandler(f=>this.setOrReportCursorColor(f))),this._parser.registerOscHandler(104,new p.OscHandler(f=>this.restoreIndexedColor(f))),this._parser.registerOscHandler(110,new p.OscHandler(f=>this.restoreFgColor(f))),this._parser.registerOscHandler(111,new p.OscHandler(f=>this.restoreBgColor(f))),this._parser.registerOscHandler(112,new p.OscHandler(f=>this.restoreCursorColor(f))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let f in a.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:f},()=>this.selectCharset("("+f)),this._parser.registerEscHandler({intermediates:")",final:f},()=>this.selectCharset(")"+f)),this._parser.registerEscHandler({intermediates:"*",final:f},()=>this.selectCharset("*"+f)),this._parser.registerEscHandler({intermediates:"+",final:f},()=>this.selectCharset("+"+f)),this._parser.registerEscHandler({intermediates:"-",final:f},()=>this.selectCharset("-"+f)),this._parser.registerEscHandler({intermediates:".",final:f},()=>this.selectCharset("."+f)),this._parser.registerEscHandler({intermediates:"/",final:f},()=>this.selectCharset("/"+f));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(f=>(this._logService.error("Parsing error: ",f),f)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new h.DcsHandler((f,X)=>this.requestStatusString(f,X)))}getAttrData(){return this._curAttrData}_preserveStack(d,u,H,R){this._parseStack.paused=!0,this._parseStack.cursorStartX=d,this._parseStack.cursorStartY=u,this._parseStack.decodedLength=H,this._parseStack.position=R}_logSlowResolvingAsync(d){this._logService.logLevel<=n.LogLevelEnum.WARN&&Promise.race([d,new Promise((u,H)=>setTimeout(()=>H("#SLOW_TIMEOUT"),5e3))]).catch(u=>{if(u!=="#SLOW_TIMEOUT")throw u;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(d,u){let H,R=this._activeBuffer.x,b=this._activeBuffer.y,Q=0,V=this._parseStack.paused;if(V){if(H=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,u))return this._logSlowResolvingAsync(H),H;R=this._parseStack.cursorStartX,b=this._parseStack.cursorStartY,this._parseStack.paused=!1,d.length>E&&(Q=this._parseStack.position+E)}if(this._logService.logLevel<=n.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof d=="string"?` "${d}"`:` "${Array.prototype.map.call(d,D=>String.fromCharCode(D)).join("")}"`),typeof d=="string"?d.split("").map(D=>D.charCodeAt(0)):d),this._parseBuffer.length<d.length&&this._parseBuffer.length<E&&(this._parseBuffer=new Uint32Array(Math.min(d.length,E))),V||this._dirtyRowTracker.clearRange(),d.length>E)for(let D=Q;D<d.length;D+=E){let W=D+E<d.length?D+E:d.length,f=typeof d=="string"?this._stringDecoder.decode(d.substring(D,W),this._parseBuffer):this._utf8Decoder.decode(d.subarray(D,W),this._parseBuffer);if(H=this._parser.parse(this._parseBuffer,f))return this._preserveStack(R,b,f,D),this._logSlowResolvingAsync(H),H}else if(!V){let D=typeof d=="string"?this._stringDecoder.decode(d,this._parseBuffer):this._utf8Decoder.decode(d,this._parseBuffer);if(H=this._parser.parse(this._parseBuffer,D))return this._preserveStack(R,b,D,0),this._logSlowResolvingAsync(H),H}this._activeBuffer.x===R&&this._activeBuffer.y===b||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(d,u,H){let R,b,Q=this._charsetService.charset,V=this._optionsService.rawOptions.screenReaderMode,D=this._bufferService.cols,W=this._coreService.decPrivateModes.wraparound,f=this._coreService.modes.insertMode,X=this._curAttrData,C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&H-u>0&&C.getWidth(this._activeBuffer.x-1)===2&&C.setCellFromCodePoint(this._activeBuffer.x-1,0,1,X.fg,X.bg,X.extended);for(let M=u;M<H;++M){if(R=d[M],b=this._unicodeService.wcwidth(R),R<127&&Q){let T=Q[String.fromCharCode(R)];T&&(R=T.charCodeAt(0))}if(V&&this._onA11yChar.fire((0,$.stringFromCodePoint)(R)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),b||!this._activeBuffer.x){if(this._activeBuffer.x+b-1>=D){if(W){for(;this._activeBuffer.x<D;)C.setCellFromCodePoint(this._activeBuffer.x++,0,1,X.fg,X.bg,X.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=D-1,b===2)continue}if(f&&(C.insertCells(this._activeBuffer.x,b,this._activeBuffer.getNullCell(X),X),C.getWidth(D-1)===2&&C.setCellFromCodePoint(D-1,k.NULL_CELL_CODE,k.NULL_CELL_WIDTH,X.fg,X.bg,X.extended)),C.setCellFromCodePoint(this._activeBuffer.x++,R,b,X.fg,X.bg,X.extended),b>0)for(;--b;)C.setCellFromCodePoint(this._activeBuffer.x++,0,0,X.fg,X.bg,X.extended)}else C.getWidth(this._activeBuffer.x-1)?C.addCodepointToCell(this._activeBuffer.x-1,R):C.addCodepointToCell(this._activeBuffer.x-2,R)}H-u>0&&(C.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<D&&H-u>0&&C.getWidth(this._activeBuffer.x)===0&&!C.hasContent(this._activeBuffer.x)&&C.setCellFromCodePoint(this._activeBuffer.x,0,1,X.fg,X.bg,X.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(d,u){return d.final!=="t"||d.prefix||d.intermediates?this._parser.registerCsiHandler(d,u):this._parser.registerCsiHandler(d,H=>!m(H.params[0],this._optionsService.rawOptions.windowOptions)||u(H))}registerDcsHandler(d,u){return this._parser.registerDcsHandler(d,new h.DcsHandler(u))}registerEscHandler(d,u){return this._parser.registerEscHandler(d,u)}registerOscHandler(d,u){return this._parser.registerOscHandler(d,new p.OscHandler(u))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var d;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||d===void 0)&&d.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);u.hasWidth(this._activeBuffer.x)&&!u.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let d=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-d),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(d=this._bufferService.cols-1){this._activeBuffer.x=Math.min(d,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(d,u){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=d,this._activeBuffer.y=this._activeBuffer.scrollTop+u):(this._activeBuffer.x=d,this._activeBuffer.y=u),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(d,u){this._restrictCursor(),this._setCursor(this._activeBuffer.x+d,this._activeBuffer.y+u)}cursorUp(d){let u=this._activeBuffer.y-this._activeBuffer.scrollTop;return u>=0?this._moveCursor(0,-Math.min(u,d.params[0]||1)):this._moveCursor(0,-(d.params[0]||1)),!0}cursorDown(d){let u=this._activeBuffer.scrollBottom-this._activeBuffer.y;return u>=0?this._moveCursor(0,Math.min(u,d.params[0]||1)):this._moveCursor(0,d.params[0]||1),!0}cursorForward(d){return this._moveCursor(d.params[0]||1,0),!0}cursorBackward(d){return this._moveCursor(-(d.params[0]||1),0),!0}cursorNextLine(d){return this.cursorDown(d),this._activeBuffer.x=0,!0}cursorPrecedingLine(d){return this.cursorUp(d),this._activeBuffer.x=0,!0}cursorCharAbsolute(d){return this._setCursor((d.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(d){return this._setCursor(d.length>=2?(d.params[1]||1)-1:0,(d.params[0]||1)-1),!0}charPosAbsolute(d){return this._setCursor((d.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(d){return this._moveCursor(d.params[0]||1,0),!0}linePosAbsolute(d){return this._setCursor(this._activeBuffer.x,(d.params[0]||1)-1),!0}vPositionRelative(d){return this._moveCursor(0,d.params[0]||1),!0}hVPosition(d){return this.cursorPosition(d),!0}tabClear(d){let u=d.params[0];return u===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:u===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(d){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let u=d.params[0]||1;for(;u--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(d){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let u=d.params[0]||1;for(;u--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(d){let u=d.params[0];return u===1&&(this._curAttrData.bg|=536870912),u!==2&&u!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(d,u,H,R=!1,b=!1){let Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+d);Q.replaceCells(u,H,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),b),R&&(Q.isWrapped=!1)}_resetBufferLine(d,u=!1){let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+d);H.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),u),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+d),H.isWrapped=!1}eraseInDisplay(d,u=!1){let H;switch(this._restrictCursor(this._bufferService.cols),d.params[0]){case 0:for(H=this._activeBuffer.y,this._dirtyRowTracker.markDirty(H),this._eraseInBufferLine(H++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,u);H<this._bufferService.rows;H++)this._resetBufferLine(H,u);this._dirtyRowTracker.markDirty(H);break;case 1:for(H=this._activeBuffer.y,this._dirtyRowTracker.markDirty(H),this._eraseInBufferLine(H,0,this._activeBuffer.x+1,!0,u),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(H+1).isWrapped=!1);H--;)this._resetBufferLine(H,u);this._dirtyRowTracker.markDirty(0);break;case 2:for(H=this._bufferService.rows,this._dirtyRowTracker.markDirty(H-1);H--;)this._resetBufferLine(H,u);this._dirtyRowTracker.markDirty(0);break;case 3:let R=this._activeBuffer.lines.length-this._bufferService.rows;R>0&&(this._activeBuffer.lines.trimStart(R),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-R,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-R,0),this._onScroll.fire(0))}return!0}eraseInLine(d,u=!1){switch(this._restrictCursor(this._bufferService.cols),d.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,u);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,u);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,u)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(d){this._restrictCursor();let u=d.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=this._activeBuffer.ybase+this._activeBuffer.y,R=this._bufferService.rows-1-this._activeBuffer.scrollBottom,b=this._bufferService.rows-1+this._activeBuffer.ybase-R+1;for(;u--;)this._activeBuffer.lines.splice(b-1,1),this._activeBuffer.lines.splice(H,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(d){this._restrictCursor();let u=d.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=this._activeBuffer.ybase+this._activeBuffer.y,R;for(R=this._bufferService.rows-1-this._activeBuffer.scrollBottom,R=this._bufferService.rows-1+this._activeBuffer.ybase-R;u--;)this._activeBuffer.lines.splice(H,1),this._activeBuffer.lines.splice(R,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(d){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.insertCells(this._activeBuffer.x,d.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(d){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.deleteCells(this._activeBuffer.x,d.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(d){let u=d.params[0]||1;for(;u--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(d){let u=d.params[0]||1;for(;u--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(A.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(d){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=d.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);R.deleteCells(0,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),R.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(d){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=d.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);R.insertCells(0,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),R.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(d){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=d.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);R.insertCells(this._activeBuffer.x,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),R.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(d){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=d.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);R.deleteCells(this._activeBuffer.x,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),R.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(d){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(d.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(d){if(!this._parser.precedingCodepoint)return!0;let u=d.params[0]||1,H=new Uint32Array(u);for(let R=0;R<u;++R)H[R]=this._parser.precedingCodepoint;return this.print(H,0,H.length),!0}sendDeviceAttributesPrimary(d){return d.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(d){return d.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(d.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c")),!0}_is(d){return(this._optionsService.rawOptions.termName+"").indexOf(d)===0}setMode(d){for(let u=0;u<d.length;u++)switch(d.params[u]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(d){for(let u=0;u<d.length;u++)switch(d.params[u]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),this._charsetService.setgCharset(1,a.DEFAULT_CHARSET),this._charsetService.setgCharset(2,a.DEFAULT_CHARSET),this._charsetService.setgCharset(3,a.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(d){for(let u=0;u<d.length;u++)switch(d.params[u]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(d){for(let u=0;u<d.length;u++)switch(d.params[u]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),d.params[u]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(d,u){let H=this._coreService.decPrivateModes,{activeProtocol:R,activeEncoding:b}=this._coreMouseService,Q=this._coreService,{buffers:V,cols:D}=this._bufferService,{active:W,alt:f}=V,X=this._optionsService.rawOptions,C=L=>L?1:2,M=d.params[0];return T=M,_=u?M===2?3:M===4?C(Q.modes.insertMode):M===12?4:M===20?C(X.convertEol):0:M===1?C(H.applicationCursorKeys):M===3?X.windowOptions.setWinLines?D===80?2:D===132?1:0:0:M===6?C(H.origin):M===7?C(H.wraparound):M===8?3:M===9?C(R==="X10"):M===12?C(X.cursorBlink):M===25?C(!Q.isCursorHidden):M===45?C(H.reverseWraparound):M===66?C(H.applicationKeypad):M===1e3?C(R==="VT200"):M===1002?C(R==="DRAG"):M===1003?C(R==="ANY"):M===1004?C(H.sendFocus):M===1005?4:M===1006?C(b==="SGR"):M===1015?4:M===1016?C(b==="SGR_PIXELS"):M===1048?1:M===47||M===1047||M===1049?C(W===f):M===2004?C(H.bracketedPasteMode):0,Q.triggerDataEvent(`${o.C0.ESC}[${u?"":"?"}${T};${_}$y`),!0;var T,_}_updateAttrColor(d,u,H,R,b){return u===2?(d|=50331648,d&=-16777216,d|=t.AttributeData.fromColorRGB([H,R,b])):u===5&&(d&=-50331904,d|=33554432|255&H),d}_extractColor(d,u,H){let R=[0,0,-1,0,0,0],b=0,Q=0;do{if(R[Q+b]=d.params[u+Q],d.hasSubParams(u+Q)){let V=d.getSubParams(u+Q),D=0;do R[1]===5&&(b=1),R[Q+D+1+b]=V[D];while(++D<V.length&&D+Q+1+b<R.length);break}if(R[1]===5&&Q+b>=2||R[1]===2&&Q+b>=5)break;R[1]&&(b=1)}while(++Q+u<d.length&&Q+b<R.length);for(let V=2;V<R.length;++V)R[V]===-1&&(R[V]=0);switch(R[0]){case 38:H.fg=this._updateAttrColor(H.fg,R[1],R[3],R[4],R[5]);break;case 48:H.bg=this._updateAttrColor(H.bg,R[1],R[3],R[4],R[5]);break;case 58:H.extended=H.extended.clone(),H.extended.underlineColor=this._updateAttrColor(H.extended.underlineColor,R[1],R[3],R[4],R[5])}return Q}_processUnderline(d,u){u.extended=u.extended.clone(),(!~d||d>5)&&(d=1),u.extended.underlineStyle=d,u.fg|=268435456,d===0&&(u.fg&=-268435457),u.updateExtended()}_processSGR0(d){d.fg=A.DEFAULT_ATTR_DATA.fg,d.bg=A.DEFAULT_ATTR_DATA.bg,d.extended=d.extended.clone(),d.extended.underlineStyle=0,d.extended.underlineColor&=-67108864,d.updateExtended()}charAttributes(d){if(d.length===1&&d.params[0]===0)return this._processSGR0(this._curAttrData),!0;let u=d.length,H,R=this._curAttrData;for(let b=0;b<u;b++)H=d.params[b],H>=30&&H<=37?(R.fg&=-50331904,R.fg|=16777216|H-30):H>=40&&H<=47?(R.bg&=-50331904,R.bg|=16777216|H-40):H>=90&&H<=97?(R.fg&=-50331904,R.fg|=16777224|H-90):H>=100&&H<=107?(R.bg&=-50331904,R.bg|=16777224|H-100):H===0?this._processSGR0(R):H===1?R.fg|=134217728:H===3?R.bg|=67108864:H===4?(R.fg|=268435456,this._processUnderline(d.hasSubParams(b)?d.getSubParams(b)[0]:1,R)):H===5?R.fg|=536870912:H===7?R.fg|=67108864:H===8?R.fg|=1073741824:H===9?R.fg|=2147483648:H===2?R.bg|=134217728:H===21?this._processUnderline(2,R):H===22?(R.fg&=-134217729,R.bg&=-134217729):H===23?R.bg&=-67108865:H===24?(R.fg&=-268435457,this._processUnderline(0,R)):H===25?R.fg&=-536870913:H===27?R.fg&=-67108865:H===28?R.fg&=-1073741825:H===29?R.fg&=2147483647:H===39?(R.fg&=-67108864,R.fg|=16777215&A.DEFAULT_ATTR_DATA.fg):H===49?(R.bg&=-67108864,R.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):H===38||H===48||H===58?b+=this._extractColor(d,b,R):H===59?(R.extended=R.extended.clone(),R.extended.underlineColor=-1,R.updateExtended()):H===100?(R.fg&=-67108864,R.fg|=16777215&A.DEFAULT_ATTR_DATA.fg,R.bg&=-67108864,R.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",H);return!0}deviceStatus(d){switch(d.params[0]){case 5:this._coreService.triggerDataEvent(`${o.C0.ESC}[0n`);break;case 6:let u=this._activeBuffer.y+1,H=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[${u};${H}R`)}return!0}deviceStatusPrivate(d){if(d.params[0]===6){let u=this._activeBuffer.y+1,H=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[?${u};${H}R`)}return!0}softReset(d){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(d){let u=d.params[0]||1;switch(u){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let H=u%2==1;return this._optionsService.options.cursorBlink=H,!0}setScrollRegion(d){let u=d.params[0]||1,H;return(d.length<2||(H=d.params[1])>this._bufferService.rows||H===0)&&(H=this._bufferService.rows),H>u&&(this._activeBuffer.scrollTop=u-1,this._activeBuffer.scrollBottom=H-1,this._setCursor(0,0)),!0}windowOptions(d){if(!m(d.params[0],this._optionsService.rawOptions.windowOptions))return!0;let u=d.length>1?d.params[1]:0;switch(d.params[0]){case 14:u!==2&&this._onRequestWindowsOptionsReport.fire(v.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(v.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${o.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:u!==0&&u!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),u!==0&&u!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:u!==0&&u!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),u!==0&&u!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(d){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(d){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(d){return this._windowTitle=d,this._onTitleChange.fire(d),!0}setIconName(d){return this._iconName=d,!0}setOrReportIndexedColor(d){let u=[],H=d.split(";");for(;H.length>1;){let R=H.shift(),b=H.shift();if(/^\d+$/.exec(R)){let Q=parseInt(R);if(0<=Q&&Q<256)if(b==="?")u.push({type:0,index:Q});else{let V=(0,i.parseColor)(b);V&&u.push({type:1,index:Q,color:V})}}}return u.length&&this._onColor.fire(u),!0}setHyperlink(d){let u=d.split(";");return!(u.length<2)&&(u[1]?this._createHyperlink(u[0],u[1]):!u[0]&&this._finishHyperlink())}_createHyperlink(d,u){this._getCurrentLinkId()&&this._finishHyperlink();let H=d.split(":"),R,b=H.findIndex(Q=>Q.startsWith("id="));return b!==-1&&(R=H[b].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:R,uri:u}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(d,u){let H=d.split(";");for(let R=0;R<H.length&&!(u>=this._specialColors.length);++R,++u)if(H[R]==="?")this._onColor.fire([{type:0,index:this._specialColors[u]}]);else{let b=(0,i.parseColor)(H[R]);b&&this._onColor.fire([{type:1,index:this._specialColors[u],color:b}])}return!0}setOrReportFgColor(d){return this._setOrReportSpecialColor(d,0)}setOrReportBgColor(d){return this._setOrReportSpecialColor(d,1)}setOrReportCursorColor(d){return this._setOrReportSpecialColor(d,2)}restoreIndexedColor(d){if(!d)return this._onColor.fire([{type:2}]),!0;let u=[],H=d.split(";");for(let R=0;R<H.length;++R)if(/^\d+$/.exec(H[R])){let b=parseInt(H[R]);0<=b&&b<256&&u.push({type:2,index:b})}return u.length&&this._onColor.fire(u),!0}restoreFgColor(d){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(d){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(d){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),!0}selectCharset(d){return d.length!==2?(this.selectDefaultCharset(),!0):(d[0]==="/"||this._charsetService.setgCharset(g[d[0]],a.CHARSETS[d[1]]||a.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let d=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,d,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(d){return this._charsetService.setgLevel(d),!0}screenAlignmentPattern(){let d=new B.CellData;d.content=4194373,d.fg=this._curAttrData.fg,d.bg=this._curAttrData.bg,this._setCursor(0,0);for(let u=0;u<this._bufferService.rows;++u){let H=this._activeBuffer.ybase+this._activeBuffer.y+u,R=this._activeBuffer.lines.get(H);R&&(R.fill(d),R.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(d,u){let H=this._bufferService.buffer,R=this._optionsService.rawOptions;return(b=>(this._coreService.triggerDataEvent(`${o.C0.ESC}${b}${o.C0.ESC}\\`),!0))(d==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:d==='"p'?'P1$r61;1"p':d==="r"?`P1$r${H.scrollTop+1};${H.scrollBottom+1}r`:d==="m"?"P1$r0m":d===" q"?`P1$r${{block:2,underline:4,bar:6}[R.cursorStyle]-(R.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(d,u){this._dirtyRowTracker.markRangeDirty(d,u)}}j.InputHandler=y;let I=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,d){F>d&&(x=F,F=d,d=x),F<this.start&&(this.start=F),d>this.end&&(this.end=d)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};I=r([s(0,n.IBufferService)],I)},844:(S,j)=>{function P(r){for(let s of r)s.dispose();r.length=0}Object.defineProperty(j,"__esModule",{value:!0}),j.getDisposeArrayDisposable=j.disposeArray=j.toDisposable=j.Disposable=void 0,j.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let r of this._disposables)r.dispose();this._disposables.length=0}register(r){return this._disposables.push(r),r}unregister(r){let s=this._disposables.indexOf(r);s!==-1&&this._disposables.splice(s,1)}},j.toDisposable=function(r){return{dispose:r}},j.disposeArray=P,j.getDisposeArrayDisposable=function(r){return{dispose:()=>P(r)}}},1505:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.FourKeyMap=j.TwoKeyMap=void 0;class P{constructor(){this._data={}}set(s,o,a){this._data[s]||(this._data[s]={}),this._data[s][o]=a}get(s,o){return this._data[s]?this._data[s][o]:void 0}clear(){this._data={}}}j.TwoKeyMap=P,j.FourKeyMap=class{constructor(){this._data=new P}set(r,s,o,a,l){this._data.get(r,s)||this._data.set(r,s,new P),this._data.get(r,s).set(o,a,l)}get(r,s,o,a){var l;return(l=this._data.get(r,s))===null||l===void 0?void 0:l.get(o,a)}clear(){this._data.clear()}}},6114:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.isChromeOS=j.isLinux=j.isWindows=j.isIphone=j.isIpad=j.isMac=j.getSafariVersion=j.isSafari=j.isLegacyEdge=j.isFirefox=j.isNode=void 0,j.isNode=typeof navigator=="undefined";let P=j.isNode?"node":navigator.userAgent,r=j.isNode?"node":navigator.platform;j.isFirefox=P.includes("Firefox"),j.isLegacyEdge=P.includes("Edge"),j.isSafari=/^((?!chrome|android).)*safari/i.test(P),j.getSafariVersion=function(){if(!j.isSafari)return 0;let s=P.match(/Version\/(\d+)/);return s===null||s.length<2?0:parseInt(s[1])},j.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(r),j.isIpad=r==="iPad",j.isIphone=r==="iPhone",j.isWindows=["Windows","Win16","Win32","WinCE"].includes(r),j.isLinux=r.indexOf("Linux")>=0,j.isChromeOS=/\bCrOS\b/.test(P)},6106:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.SortedList=void 0;let P=0;j.SortedList=class{constructor(r){this._getKey=r,this._array=[]}clear(){this._array.length=0}insert(r){this._array.length!==0?(P=this._search(this._getKey(r),0,this._array.length-1),this._array.splice(P,0,r)):this._array.push(r)}delete(r){if(this._array.length===0)return!1;let s=this._getKey(r);if(s===void 0||(P=this._search(s,0,this._array.length-1),P===-1)||this._getKey(this._array[P])!==s)return!1;do if(this._array[P]===r)return this._array.splice(P,1),!0;while(++P<this._array.length&&this._getKey(this._array[P])===s);return!1}*getKeyIterator(r){if(this._array.length!==0&&(P=this._search(r,0,this._array.length-1),!(P<0||P>=this._array.length)&&this._getKey(this._array[P])===r))do yield this._array[P];while(++P<this._array.length&&this._getKey(this._array[P])===r)}forEachByKey(r,s){if(this._array.length!==0&&(P=this._search(r,0,this._array.length-1),!(P<0||P>=this._array.length)&&this._getKey(this._array[P])===r))do s(this._array[P]);while(++P<this._array.length&&this._getKey(this._array[P])===r)}values(){return this._array.values()}_search(r,s,o){if(o<s)return s;let a=Math.floor((s+o)/2),l=this._getKey(this._array[a]);if(l>r)return this._search(r,s,a-1);if(l<r)return this._search(r,a+1,o);for(;a>0&&this._getKey(this._array[a-1])===r;)a--;return a}}},7226:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.DebouncedIdleTask=j.IdleTaskQueue=j.PriorityTaskQueue=void 0;let r=P(6114);class s{constructor(){this._tasks=[],this._i=0}enqueue(l){this._tasks.push(l),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(l){this._idleCallback=void 0;let c=0,$=0,A=l.timeRemaining(),e=0;for(;this._i<this._tasks.length;){if(c=Date.now(),this._tasks[this._i]()||this._i++,c=Math.max(1,Date.now()-c),$=Math.max(c,$),e=l.timeRemaining(),1.5*$>e)return A-c<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(A-c))}ms`),void this._start();A=e}this.clear()}}class o extends s{_requestCallback(l){return setTimeout(()=>l(this._createDeadline(16)))}_cancelCallback(l){clearTimeout(l)}_createDeadline(l){let c=Date.now()+l;return{timeRemaining:()=>Math.max(0,c-Date.now())}}}j.PriorityTaskQueue=o,j.IdleTaskQueue=!r.isNode&&"requestIdleCallback"in window?class extends s{_requestCallback(a){return requestIdleCallback(a)}_cancelCallback(a){cancelIdleCallback(a)}}:o,j.DebouncedIdleTask=class{constructor(){this._queue=new j.IdleTaskQueue}set(a){this._queue.clear(),this._queue.enqueue(a)}flush(){this._queue.flush()}}},9282:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.updateWindowsModeWrappedState=void 0;let r=P(643);j.updateWindowsModeWrappedState=function(s){let o=s.buffer.lines.get(s.buffer.ybase+s.buffer.y-1),a=o==null?void 0:o.get(s.cols-1),l=s.buffer.lines.get(s.buffer.ybase+s.buffer.y);l&&a&&(l.isWrapped=a[r.CHAR_DATA_CODE_INDEX]!==r.NULL_CELL_CODE&&a[r.CHAR_DATA_CODE_INDEX]!==r.WHITESPACE_CELL_CODE)}},3734:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.ExtendedAttrs=j.AttributeData=void 0;class P{constructor(){this.fg=0,this.bg=0,this.extended=new r}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){let o=new P;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}j.AttributeData=P;class r{constructor(o=0,a=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=a}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}clone(){return new r(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}j.ExtendedAttrs=r},9092:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferStringIterator=j.Buffer=j.MAX_BUFFER_SIZE=void 0;let r=P(6349),s=P(8437),o=P(511),a=P(643),l=P(4634),c=P(4863),$=P(7116),A=P(3734),e=P(7226);j.MAX_BUFFER_SIZE=4294967295,j.Buffer=class{constructor(B,t,n){this._hasScrollback=B,this._optionsService=t,this._bufferService=n,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=s.DEFAULT_ATTR_DATA.clone(),this.savedCharset=$.DEFAULT_CHARSET,this.markers=[],this._nullCell=o.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]),this._whitespaceCell=o.CellData.fromCharData([0,a.WHITESPACE_CELL_CHAR,a.WHITESPACE_CELL_WIDTH,a.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new e.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(B){return B?(this._nullCell.fg=B.fg,this._nullCell.bg=B.bg,this._nullCell.extended=B.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new A.ExtendedAttrs),this._nullCell}getWhitespaceCell(B){return B?(this._whitespaceCell.fg=B.fg,this._whitespaceCell.bg=B.bg,this._whitespaceCell.extended=B.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new A.ExtendedAttrs),this._whitespaceCell}getBlankLine(B,t){return new s.BufferLine(this._bufferService.cols,this.getNullCell(B),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let B=this.ybase+this.y-this.ydisp;return B>=0&&B<this._rows}_getCorrectBufferLength(B){if(!this._hasScrollback)return B;let t=B+this._optionsService.rawOptions.scrollback;return t>j.MAX_BUFFER_SIZE?j.MAX_BUFFER_SIZE:t}fillViewportRows(B){if(this.lines.length===0){B===void 0&&(B=s.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(B))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(B,t){let n=this.getNullCell(s.DEFAULT_ATTR_DATA),p=0,h=this._getCorrectBufferLength(t);if(h>this.lines.maxLength&&(this.lines.maxLength=h),this.lines.length>0){if(this._cols<B)for(let g=0;g<this.lines.length;g++)p+=+this.lines.get(g).resize(B,n);let i=0;if(this._rows<t)for(let g=this._rows;g<t;g++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new s.BufferLine(B,n)):this.ybase>0&&this.lines.length<=this.ybase+this.y+i+1?(this.ybase--,i++,this.ydisp>0&&this.ydisp--):this.lines.push(new s.BufferLine(B,n)));else for(let g=this._rows;g>t;g--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(h<this.lines.maxLength){let g=this.lines.length-h;g>0&&(this.lines.trimStart(g),this.ybase=Math.max(this.ybase-g,0),this.ydisp=Math.max(this.ydisp-g,0),this.savedY=Math.max(this.savedY-g,0)),this.lines.maxLength=h}this.x=Math.min(this.x,B-1),this.y=Math.min(this.y,t-1),i&&(this.y+=i),this.savedX=Math.min(this.savedX,B-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(B,t),this._cols>B))for(let i=0;i<this.lines.length;i++)p+=+this.lines.get(i).resize(B,n);this._cols=B,this._rows=t,this._memoryCleanupQueue.clear(),p>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let B=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,B=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return B}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(B,t){this._cols!==B&&(B>this._cols?this._reflowLarger(B,t):this._reflowSmaller(B,t))}_reflowLarger(B,t){let n=(0,l.reflowLargerGetLinesToRemove)(this.lines,this._cols,B,this.ybase+this.y,this.getNullCell(s.DEFAULT_ATTR_DATA));if(n.length>0){let p=(0,l.reflowLargerCreateNewLayout)(this.lines,n);(0,l.reflowLargerApplyNewLayout)(this.lines,p.layout),this._reflowLargerAdjustViewport(B,t,p.countRemoved)}}_reflowLargerAdjustViewport(B,t,n){let p=this.getNullCell(s.DEFAULT_ATTR_DATA),h=n;for(;h-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new s.BufferLine(B,p))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-n,0)}_reflowSmaller(B,t){let n=this.getNullCell(s.DEFAULT_ATTR_DATA),p=[],h=0;for(let i=this.lines.length-1;i>=0;i--){let g=this.lines.get(i);if(!g||!g.isWrapped&&g.getTrimmedLength()<=B)continue;let E=[g];for(;g.isWrapped&&i>0;)g=this.lines.get(--i),E.unshift(g);let m=this.ybase+this.y;if(m>=i&&m<i+E.length)continue;let v=E[E.length-1].getTrimmedLength(),x=(0,l.reflowSmallerGetNewLineLengths)(E,this._cols,B),y=x.length-E.length,I;I=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+y):Math.max(0,this.lines.length-this.lines.maxLength+y);let F=[];for(let Q=0;Q<y;Q++){let V=this.getBlankLine(s.DEFAULT_ATTR_DATA,!0);F.push(V)}F.length>0&&(p.push({start:i+E.length+h,newLines:F}),h+=F.length),E.push(...F);let d=x.length-1,u=x[d];u===0&&(d--,u=x[d]);let H=E.length-y-1,R=v;for(;H>=0;){let Q=Math.min(R,u);if(E[d]===void 0)break;if(E[d].copyCellsFrom(E[H],R-Q,u-Q,Q,!0),u-=Q,u===0&&(d--,u=x[d]),R-=Q,R===0){H--;let V=Math.max(H,0);R=(0,l.getWrappedLineTrimmedLength)(E,V,this._cols)}}for(let Q=0;Q<E.length;Q++)x[Q]<B&&E[Q].setCell(x[Q],n);let b=y-I;for(;b-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+h)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+y,this.ybase+t-1)}if(p.length>0){let i=[],g=[];for(let d=0;d<this.lines.length;d++)g.push(this.lines.get(d));let E=this.lines.length,m=E-1,v=0,x=p[v];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+h);let y=0;for(let d=Math.min(this.lines.maxLength-1,E+h-1);d>=0;d--)if(x&&x.start>m+y){for(let u=x.newLines.length-1;u>=0;u--)this.lines.set(d--,x.newLines[u]);d++,i.push({index:m+1,amount:x.newLines.length}),y+=x.newLines.length,x=p[++v]}else this.lines.set(d,g[m--]);let I=0;for(let d=i.length-1;d>=0;d--)i[d].index+=I,this.lines.onInsertEmitter.fire(i[d]),I+=i[d].amount;let F=Math.max(0,E+h-this.lines.maxLength);F>0&&this.lines.onTrimEmitter.fire(F)}}stringIndexToBufferIndex(B,t,n=!1){for(;t;){let p=this.lines.get(B);if(!p)return[-1,-1];let h=n?p.getTrimmedLength():p.length;for(let i=0;i<h;++i)if(p.get(i)[a.CHAR_DATA_WIDTH_INDEX]&&(t-=p.get(i)[a.CHAR_DATA_CHAR_INDEX].length||1),t<0)return[B,i];B++}return[B,0]}translateBufferLineToString(B,t,n=0,p){let h=this.lines.get(B);return h?h.translateToString(t,n,p):""}getWrappedRangeForLine(B){let t=B,n=B;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;n+1<this.lines.length&&this.lines.get(n+1).isWrapped;)n++;return{first:t,last:n}}setupTabStops(B){for(B!=null?this.tabs[B]||(B=this.prevStop(B)):(this.tabs={},B=0);B<this._cols;B+=this._optionsService.rawOptions.tabStopWidth)this.tabs[B]=!0}prevStop(B){for(B==null&&(B=this.x);!this.tabs[--B]&&B>0;);return B>=this._cols?this._cols-1:B<0?0:B}nextStop(B){for(B==null&&(B=this.x);!this.tabs[++B]&&B<this._cols;);return B>=this._cols?this._cols-1:B<0?0:B}clearMarkers(B){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===B&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let B=0;B<this.markers.length;B++)this.markers[B].dispose(),this.markers.splice(B--,1);this._isClearing=!1}addMarker(B){let t=new c.Marker(B);return this.markers.push(t),t.register(this.lines.onTrim(n=>{t.line-=n,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(n=>{t.line>=n.index&&(t.line+=n.amount)})),t.register(this.lines.onDelete(n=>{t.line>=n.index&&t.line<n.index+n.amount&&t.dispose(),t.line>n.index&&(t.line-=n.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(B){this._isClearing||this.markers.splice(this.markers.indexOf(B),1)}iterator(B,t,n,p,h){return new k(this,B,t,n,p,h)}};class k{constructor(t,n,p=0,h=t.lines.length,i=0,g=0){this._buffer=t,this._trimRight=n,this._startIndex=p,this._endIndex=h,this._startOverscan=i,this._endOverscan=g,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){let t=this._buffer.getWrappedRangeForLine(this._current);t.first<this._startIndex-this._startOverscan&&(t.first=this._startIndex-this._startOverscan),t.last>this._endIndex+this._endOverscan&&(t.last=this._endIndex+this._endOverscan),t.first=Math.max(t.first,0),t.last=Math.min(t.last,this._buffer.lines.length);let n="";for(let p=t.first;p<=t.last;++p)n+=this._buffer.translateBufferLineToString(p,this._trimRight);return this._current=t.last+1,{range:t,content:n}}}j.BufferStringIterator=k},8437:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferLine=j.DEFAULT_ATTR_DATA=void 0;let r=P(482),s=P(643),o=P(511),a=P(3734);j.DEFAULT_ATTR_DATA=Object.freeze(new a.AttributeData);let l=0;class c{constructor(A,e,k=!1){this.isWrapped=k,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*A);let B=e||o.CellData.fromCharData([0,s.NULL_CELL_CHAR,s.NULL_CELL_WIDTH,s.NULL_CELL_CODE]);for(let t=0;t<A;++t)this.setCell(t,B);this.length=A}get(A){let e=this._data[3*A+0],k=2097151&e;return[this._data[3*A+1],2097152&e?this._combined[A]:k?(0,r.stringFromCodePoint)(k):"",e>>22,2097152&e?this._combined[A].charCodeAt(this._combined[A].length-1):k]}set(A,e){this._data[3*A+1]=e[s.CHAR_DATA_ATTR_INDEX],e[s.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[A]=e[1],this._data[3*A+0]=2097152|A|e[s.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*A+0]=e[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[s.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(A){return this._data[3*A+0]>>22}hasWidth(A){return 12582912&this._data[3*A+0]}getFg(A){return this._data[3*A+1]}getBg(A){return this._data[3*A+2]}hasContent(A){return 4194303&this._data[3*A+0]}getCodePoint(A){let e=this._data[3*A+0];return 2097152&e?this._combined[A].charCodeAt(this._combined[A].length-1):2097151&e}isCombined(A){return 2097152&this._data[3*A+0]}getString(A){let e=this._data[3*A+0];return 2097152&e?this._combined[A]:2097151&e?(0,r.stringFromCodePoint)(2097151&e):""}isProtected(A){return 536870912&this._data[3*A+2]}loadCell(A,e){return l=3*A,e.content=this._data[l+0],e.fg=this._data[l+1],e.bg=this._data[l+2],2097152&e.content&&(e.combinedData=this._combined[A]),268435456&e.bg&&(e.extended=this._extendedAttrs[A]),e}setCell(A,e){2097152&e.content&&(this._combined[A]=e.combinedData),268435456&e.bg&&(this._extendedAttrs[A]=e.extended),this._data[3*A+0]=e.content,this._data[3*A+1]=e.fg,this._data[3*A+2]=e.bg}setCellFromCodePoint(A,e,k,B,t,n){268435456&t&&(this._extendedAttrs[A]=n),this._data[3*A+0]=e|k<<22,this._data[3*A+1]=B,this._data[3*A+2]=t}addCodepointToCell(A,e){let k=this._data[3*A+0];2097152&k?this._combined[A]+=(0,r.stringFromCodePoint)(e):(2097151&k?(this._combined[A]=(0,r.stringFromCodePoint)(2097151&k)+(0,r.stringFromCodePoint)(e),k&=-2097152,k|=2097152):k=e|4194304,this._data[3*A+0]=k)}insertCells(A,e,k,B){if((A%=this.length)&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs),e<this.length-A){let t=new o.CellData;for(let n=this.length-A-e-1;n>=0;--n)this.setCell(A+e+n,this.loadCell(A+n,t));for(let n=0;n<e;++n)this.setCell(A+n,k)}else for(let t=A;t<this.length;++t)this.setCell(t,k);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs)}deleteCells(A,e,k,B){if(A%=this.length,e<this.length-A){let t=new o.CellData;for(let n=0;n<this.length-A-e;++n)this.setCell(A+n,this.loadCell(A+e+n,t));for(let n=this.length-e;n<this.length;++n)this.setCell(n,k)}else for(let t=A;t<this.length;++t)this.setCell(t,k);A&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs),this.getWidth(A)!==0||this.hasContent(A)||this.setCellFromCodePoint(A,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs)}replaceCells(A,e,k,B,t=!1){if(t)for(A&&this.getWidth(A-1)===2&&!this.isProtected(A-1)&&this.setCellFromCodePoint(A-1,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs),e<this.length&&this.getWidth(e-1)===2&&!this.isProtected(e)&&this.setCellFromCodePoint(e,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs);A<e&&A<this.length;)this.isProtected(A)||this.setCell(A,k),A++;else for(A&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs),e<this.length&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e,0,1,(B==null?void 0:B.fg)||0,(B==null?void 0:B.bg)||0,(B==null?void 0:B.extended)||new a.ExtendedAttrs);A<e&&A<this.length;)this.setCell(A++,k)}resize(A,e){if(A===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let k=3*A;if(A>this.length){if(this._data.buffer.byteLength>=4*k)this._data=new Uint32Array(this._data.buffer,0,k);else{let B=new Uint32Array(k);B.set(this._data),this._data=B}for(let B=this.length;B<A;++B)this.setCell(B,e)}else{this._data=this._data.subarray(0,k);let B=Object.keys(this._combined);for(let n=0;n<B.length;n++){let p=parseInt(B[n],10);p>=A&&delete this._combined[p]}let t=Object.keys(this._extendedAttrs);for(let n=0;n<t.length;n++){let p=parseInt(t[n],10);p>=A&&delete this._extendedAttrs[p]}}return this.length=A,4*k*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let A=new Uint32Array(this._data.length);return A.set(this._data),this._data=A,1}return 0}fill(A,e=!1){if(e)for(let k=0;k<this.length;++k)this.isProtected(k)||this.setCell(k,A);else{this._combined={},this._extendedAttrs={};for(let k=0;k<this.length;++k)this.setCell(k,A)}}copyFrom(A){this.length!==A.length?this._data=new Uint32Array(A._data):this._data.set(A._data),this.length=A.length,this._combined={};for(let e in A._combined)this._combined[e]=A._combined[e];this._extendedAttrs={};for(let e in A._extendedAttrs)this._extendedAttrs[e]=A._extendedAttrs[e];this.isWrapped=A.isWrapped}clone(){let A=new c(0);A._data=new Uint32Array(this._data),A.length=this.length;for(let e in this._combined)A._combined[e]=this._combined[e];for(let e in this._extendedAttrs)A._extendedAttrs[e]=this._extendedAttrs[e];return A.isWrapped=this.isWrapped,A}getTrimmedLength(){for(let A=this.length-1;A>=0;--A)if(4194303&this._data[3*A+0])return A+(this._data[3*A+0]>>22);return 0}copyCellsFrom(A,e,k,B,t){let n=A._data;if(t)for(let h=B-1;h>=0;h--){for(let i=0;i<3;i++)this._data[3*(k+h)+i]=n[3*(e+h)+i];268435456&n[3*(e+h)+2]&&(this._extendedAttrs[k+h]=A._extendedAttrs[e+h])}else for(let h=0;h<B;h++){for(let i=0;i<3;i++)this._data[3*(k+h)+i]=n[3*(e+h)+i];268435456&n[3*(e+h)+2]&&(this._extendedAttrs[k+h]=A._extendedAttrs[e+h])}let p=Object.keys(A._combined);for(let h=0;h<p.length;h++){let i=parseInt(p[h],10);i>=e&&(this._combined[i-e+k]=A._combined[i])}}translateToString(A=!1,e=0,k=this.length){A&&(k=Math.min(k,this.getTrimmedLength()));let B="";for(;e<k;){let t=this._data[3*e+0],n=2097151&t;B+=2097152&t?this._combined[e]:n?(0,r.stringFromCodePoint)(n):s.WHITESPACE_CELL_CHAR,e+=t>>22||1}return B}}j.BufferLine=c},4841:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.getRangeLength=void 0,j.getRangeLength=function(P,r){if(P.start.y>P.end.y)throw new Error(`Buffer range end (${P.end.x}, ${P.end.y}) cannot be before start (${P.start.x}, ${P.start.y})`);return r*(P.end.y-P.start.y)+(P.end.x-P.start.x+1)}},4634:(S,j)=>{function P(r,s,o){if(s===r.length-1)return r[s].getTrimmedLength();let a=!r[s].hasContent(o-1)&&r[s].getWidth(o-1)===1,l=r[s+1].getWidth(0)===2;return a&&l?o-1:o}Object.defineProperty(j,"__esModule",{value:!0}),j.getWrappedLineTrimmedLength=j.reflowSmallerGetNewLineLengths=j.reflowLargerApplyNewLayout=j.reflowLargerCreateNewLayout=j.reflowLargerGetLinesToRemove=void 0,j.reflowLargerGetLinesToRemove=function(r,s,o,a,l){let c=[];for(let $=0;$<r.length-1;$++){let A=$,e=r.get(++A);if(!e.isWrapped)continue;let k=[r.get($)];for(;A<r.length&&e.isWrapped;)k.push(e),e=r.get(++A);if(a>=$&&a<A){$+=k.length-1;continue}let B=0,t=P(k,B,s),n=1,p=0;for(;n<k.length;){let i=P(k,n,s),g=i-p,E=o-t,m=Math.min(g,E);k[B].copyCellsFrom(k[n],p,t,m,!1),t+=m,t===o&&(B++,t=0),p+=m,p===i&&(n++,p=0),t===0&&B!==0&&k[B-1].getWidth(o-1)===2&&(k[B].copyCellsFrom(k[B-1],o-1,t++,1,!1),k[B-1].setCell(o-1,l))}k[B].replaceCells(t,o,l);let h=0;for(let i=k.length-1;i>0&&(i>B||k[i].getTrimmedLength()===0);i--)h++;h>0&&(c.push($+k.length-h),c.push(h)),$+=k.length-1}return c},j.reflowLargerCreateNewLayout=function(r,s){let o=[],a=0,l=s[a],c=0;for(let $=0;$<r.length;$++)if(l===$){let A=s[++a];r.onDeleteEmitter.fire({index:$-c,amount:A}),$+=A-1,c+=A,l=s[++a]}else o.push($);return{layout:o,countRemoved:c}},j.reflowLargerApplyNewLayout=function(r,s){let o=[];for(let a=0;a<s.length;a++)o.push(r.get(s[a]));for(let a=0;a<o.length;a++)r.set(a,o[a]);r.length=s.length},j.reflowSmallerGetNewLineLengths=function(r,s,o){let a=[],l=r.map((e,k)=>P(r,k,s)).reduce((e,k)=>e+k),c=0,$=0,A=0;for(;A<l;){if(l-A<o){a.push(l-A);break}c+=o;let e=P(r,$,s);c>e&&(c-=e,$++);let k=r[$].getWidth(c-1)===2;k&&c--;let B=k?o-1:o;a.push(B),A+=B}return a},j.getWrappedLineTrimmedLength=P},5295:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferSet=void 0;let r=P(9092),s=P(8460),o=P(844);class a extends o.Disposable{constructor(c,$){super(),this._optionsService=c,this._bufferService=$,this._onBufferActivate=this.register(new s.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new r.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new r.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(c){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(c),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(c,$){this._normal.resize(c,$),this._alt.resize(c,$),this.setupTabStops(c)}setupTabStops(c){this._normal.setupTabStops(c),this._alt.setupTabStops(c)}}j.BufferSet=a},511:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.CellData=void 0;let r=P(482),s=P(643),o=P(3734);class a extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(c){let $=new a;return $.setFromCharData(c),$}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,r.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(c){this.fg=c[s.CHAR_DATA_ATTR_INDEX],this.bg=0;let $=!1;if(c[s.CHAR_DATA_CHAR_INDEX].length>2)$=!0;else if(c[s.CHAR_DATA_CHAR_INDEX].length===2){let A=c[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=A&&A<=56319){let e=c[s.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=e&&e<=57343?this.content=1024*(A-55296)+e-56320+65536|c[s.CHAR_DATA_WIDTH_INDEX]<<22:$=!0}else $=!0}else this.content=c[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|c[s.CHAR_DATA_WIDTH_INDEX]<<22;$&&(this.combinedData=c[s.CHAR_DATA_CHAR_INDEX],this.content=2097152|c[s.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}j.CellData=a},643:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.WHITESPACE_CELL_CODE=j.WHITESPACE_CELL_WIDTH=j.WHITESPACE_CELL_CHAR=j.NULL_CELL_CODE=j.NULL_CELL_WIDTH=j.NULL_CELL_CHAR=j.CHAR_DATA_CODE_INDEX=j.CHAR_DATA_WIDTH_INDEX=j.CHAR_DATA_CHAR_INDEX=j.CHAR_DATA_ATTR_INDEX=j.DEFAULT_EXT=j.DEFAULT_ATTR=j.DEFAULT_COLOR=void 0,j.DEFAULT_COLOR=0,j.DEFAULT_ATTR=256|j.DEFAULT_COLOR<<9,j.DEFAULT_EXT=0,j.CHAR_DATA_ATTR_INDEX=0,j.CHAR_DATA_CHAR_INDEX=1,j.CHAR_DATA_WIDTH_INDEX=2,j.CHAR_DATA_CODE_INDEX=3,j.NULL_CELL_CHAR="",j.NULL_CELL_WIDTH=1,j.NULL_CELL_CODE=0,j.WHITESPACE_CELL_CHAR=" ",j.WHITESPACE_CELL_WIDTH=1,j.WHITESPACE_CELL_CODE=32},4863:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.Marker=void 0;let r=P(8460),s=P(844);class o{constructor(l){this.line=l,this.isDisposed=!1,this._disposables=[],this._id=o._nextId++,this._onDispose=this.register(new r.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,s.disposeArray)(this._disposables),this._disposables.length=0)}register(l){return this._disposables.push(l),l}}j.Marker=o,o._nextId=1},7116:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.DEFAULT_CHARSET=j.CHARSETS=void 0,j.CHARSETS={},j.DEFAULT_CHARSET=j.CHARSETS.B,j.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},j.CHARSETS.A={"#":"\xA3"},j.CHARSETS.B=void 0,j.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},j.CHARSETS.C=j.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},j.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},j.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},j.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},j.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},j.CHARSETS.E=j.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},j.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},j.CHARSETS.H=j.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},j.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(S,j)=>{var P,r;Object.defineProperty(j,"__esModule",{value:!0}),j.C1_ESCAPED=j.C1=j.C0=void 0,function(s){s.NUL="\0",s.SOH="",s.STX="",s.ETX="",s.EOT="",s.ENQ="",s.ACK="",s.BEL="\x07",s.BS="\b",s.HT="	",s.LF=`
`,s.VT="\v",s.FF="\f",s.CR="\r",s.SO="",s.SI="",s.DLE="",s.DC1="",s.DC2="",s.DC3="",s.DC4="",s.NAK="",s.SYN="",s.ETB="",s.CAN="",s.EM="",s.SUB="",s.ESC="\x1B",s.FS="",s.GS="",s.RS="",s.US="",s.SP=" ",s.DEL="\x7F"}(P=j.C0||(j.C0={})),(r=j.C1||(j.C1={})).PAD="\x80",r.HOP="\x81",r.BPH="\x82",r.NBH="\x83",r.IND="\x84",r.NEL="\x85",r.SSA="\x86",r.ESA="\x87",r.HTS="\x88",r.HTJ="\x89",r.VTS="\x8A",r.PLD="\x8B",r.PLU="\x8C",r.RI="\x8D",r.SS2="\x8E",r.SS3="\x8F",r.DCS="\x90",r.PU1="\x91",r.PU2="\x92",r.STS="\x93",r.CCH="\x94",r.MW="\x95",r.SPA="\x96",r.EPA="\x97",r.SOS="\x98",r.SGCI="\x99",r.SCI="\x9A",r.CSI="\x9B",r.ST="\x9C",r.OSC="\x9D",r.PM="\x9E",r.APC="\x9F",(j.C1_ESCAPED||(j.C1_ESCAPED={})).ST=`${P.ESC}\\`},7399:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.evaluateKeyboardEvent=void 0;let r=P(2584),s={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};j.evaluateKeyboardEvent=function(o,a,l,c){let $={type:0,cancel:!1,key:void 0},A=(o.shiftKey?1:0)|(o.altKey?2:0)|(o.ctrlKey?4:0)|(o.metaKey?8:0);switch(o.keyCode){case 0:o.key==="UIKeyInputUpArrow"?$.key=a?r.C0.ESC+"OA":r.C0.ESC+"[A":o.key==="UIKeyInputLeftArrow"?$.key=a?r.C0.ESC+"OD":r.C0.ESC+"[D":o.key==="UIKeyInputRightArrow"?$.key=a?r.C0.ESC+"OC":r.C0.ESC+"[C":o.key==="UIKeyInputDownArrow"&&($.key=a?r.C0.ESC+"OB":r.C0.ESC+"[B");break;case 8:if(o.altKey){$.key=r.C0.ESC+r.C0.DEL;break}$.key=r.C0.DEL;break;case 9:if(o.shiftKey){$.key=r.C0.ESC+"[Z";break}$.key=r.C0.HT,$.cancel=!0;break;case 13:$.key=o.altKey?r.C0.ESC+r.C0.CR:r.C0.CR,$.cancel=!0;break;case 27:$.key=r.C0.ESC,o.altKey&&($.key=r.C0.ESC+r.C0.ESC),$.cancel=!0;break;case 37:if(o.metaKey)break;A?($.key=r.C0.ESC+"[1;"+(A+1)+"D",$.key===r.C0.ESC+"[1;3D"&&($.key=r.C0.ESC+(l?"b":"[1;5D"))):$.key=a?r.C0.ESC+"OD":r.C0.ESC+"[D";break;case 39:if(o.metaKey)break;A?($.key=r.C0.ESC+"[1;"+(A+1)+"C",$.key===r.C0.ESC+"[1;3C"&&($.key=r.C0.ESC+(l?"f":"[1;5C"))):$.key=a?r.C0.ESC+"OC":r.C0.ESC+"[C";break;case 38:if(o.metaKey)break;A?($.key=r.C0.ESC+"[1;"+(A+1)+"A",l||$.key!==r.C0.ESC+"[1;3A"||($.key=r.C0.ESC+"[1;5A")):$.key=a?r.C0.ESC+"OA":r.C0.ESC+"[A";break;case 40:if(o.metaKey)break;A?($.key=r.C0.ESC+"[1;"+(A+1)+"B",l||$.key!==r.C0.ESC+"[1;3B"||($.key=r.C0.ESC+"[1;5B")):$.key=a?r.C0.ESC+"OB":r.C0.ESC+"[B";break;case 45:o.shiftKey||o.ctrlKey||($.key=r.C0.ESC+"[2~");break;case 46:$.key=A?r.C0.ESC+"[3;"+(A+1)+"~":r.C0.ESC+"[3~";break;case 36:$.key=A?r.C0.ESC+"[1;"+(A+1)+"H":a?r.C0.ESC+"OH":r.C0.ESC+"[H";break;case 35:$.key=A?r.C0.ESC+"[1;"+(A+1)+"F":a?r.C0.ESC+"OF":r.C0.ESC+"[F";break;case 33:o.shiftKey?$.type=2:o.ctrlKey?$.key=r.C0.ESC+"[5;"+(A+1)+"~":$.key=r.C0.ESC+"[5~";break;case 34:o.shiftKey?$.type=3:o.ctrlKey?$.key=r.C0.ESC+"[6;"+(A+1)+"~":$.key=r.C0.ESC+"[6~";break;case 112:$.key=A?r.C0.ESC+"[1;"+(A+1)+"P":r.C0.ESC+"OP";break;case 113:$.key=A?r.C0.ESC+"[1;"+(A+1)+"Q":r.C0.ESC+"OQ";break;case 114:$.key=A?r.C0.ESC+"[1;"+(A+1)+"R":r.C0.ESC+"OR";break;case 115:$.key=A?r.C0.ESC+"[1;"+(A+1)+"S":r.C0.ESC+"OS";break;case 116:$.key=A?r.C0.ESC+"[15;"+(A+1)+"~":r.C0.ESC+"[15~";break;case 117:$.key=A?r.C0.ESC+"[17;"+(A+1)+"~":r.C0.ESC+"[17~";break;case 118:$.key=A?r.C0.ESC+"[18;"+(A+1)+"~":r.C0.ESC+"[18~";break;case 119:$.key=A?r.C0.ESC+"[19;"+(A+1)+"~":r.C0.ESC+"[19~";break;case 120:$.key=A?r.C0.ESC+"[20;"+(A+1)+"~":r.C0.ESC+"[20~";break;case 121:$.key=A?r.C0.ESC+"[21;"+(A+1)+"~":r.C0.ESC+"[21~";break;case 122:$.key=A?r.C0.ESC+"[23;"+(A+1)+"~":r.C0.ESC+"[23~";break;case 123:$.key=A?r.C0.ESC+"[24;"+(A+1)+"~":r.C0.ESC+"[24~";break;default:if(!o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)if(l&&!c||!o.altKey||o.metaKey)!l||o.altKey||o.ctrlKey||o.shiftKey||!o.metaKey?o.key&&!o.ctrlKey&&!o.altKey&&!o.metaKey&&o.keyCode>=48&&o.key.length===1?$.key=o.key:o.key&&o.ctrlKey&&(o.key==="_"&&($.key=r.C0.US),o.key==="@"&&($.key=r.C0.NUL)):o.keyCode===65&&($.type=1);else{let e=s[o.keyCode],k=e==null?void 0:e[o.shiftKey?1:0];if(k)$.key=r.C0.ESC+k;else if(o.keyCode>=65&&o.keyCode<=90){let B=o.ctrlKey?o.keyCode-64:o.keyCode+32,t=String.fromCharCode(B);o.shiftKey&&(t=t.toUpperCase()),$.key=r.C0.ESC+t}else if(o.keyCode===32)$.key=r.C0.ESC+(o.ctrlKey?r.C0.NUL:" ");else if(o.key==="Dead"&&o.code.startsWith("Key")){let B=o.code.slice(3,4);o.shiftKey||(B=B.toLowerCase()),$.key=r.C0.ESC+B,$.cancel=!0}}else o.keyCode>=65&&o.keyCode<=90?$.key=String.fromCharCode(o.keyCode-64):o.keyCode===32?$.key=r.C0.NUL:o.keyCode>=51&&o.keyCode<=55?$.key=String.fromCharCode(o.keyCode-51+27):o.keyCode===56?$.key=r.C0.DEL:o.keyCode===219?$.key=r.C0.ESC:o.keyCode===220?$.key=r.C0.FS:o.keyCode===221&&($.key=r.C0.GS)}return $}},482:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.Utf8ToUtf32=j.StringToUtf32=j.utf32ToString=j.stringFromCodePoint=void 0,j.stringFromCodePoint=function(P){return P>65535?(P-=65536,String.fromCharCode(55296+(P>>10))+String.fromCharCode(P%1024+56320)):String.fromCharCode(P)},j.utf32ToString=function(P,r=0,s=P.length){let o="";for(let a=r;a<s;++a){let l=P[a];l>65535?(l-=65536,o+=String.fromCharCode(55296+(l>>10))+String.fromCharCode(l%1024+56320)):o+=String.fromCharCode(l)}return o},j.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(P,r){let s=P.length;if(!s)return 0;let o=0,a=0;if(this._interim){let l=P.charCodeAt(a++);56320<=l&&l<=57343?r[o++]=1024*(this._interim-55296)+l-56320+65536:(r[o++]=this._interim,r[o++]=l),this._interim=0}for(let l=a;l<s;++l){let c=P.charCodeAt(l);if(55296<=c&&c<=56319){if(++l>=s)return this._interim=c,o;let $=P.charCodeAt(l);56320<=$&&$<=57343?r[o++]=1024*(c-55296)+$-56320+65536:(r[o++]=c,r[o++]=$)}else c!==65279&&(r[o++]=c)}return o}},j.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(P,r){let s=P.length;if(!s)return 0;let o,a,l,c,$=0,A=0,e=0;if(this.interim[0]){let t=!1,n=this.interim[0];n&=(224&n)==192?31:(240&n)==224?15:7;let p,h=0;for(;(p=63&this.interim[++h])&&h<4;)n<<=6,n|=p;let i=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,g=i-h;for(;e<g;){if(e>=s)return 0;if(p=P[e++],(192&p)!=128){e--,t=!0;break}this.interim[h++]=p,n<<=6,n|=63&p}t||(i===2?n<128?e--:r[$++]=n:i===3?n<2048||n>=55296&&n<=57343||n===65279||(r[$++]=n):n<65536||n>1114111||(r[$++]=n)),this.interim.fill(0)}let k=s-4,B=e;for(;B<s;){for(;!(!(B<k)||128&(o=P[B])||128&(a=P[B+1])||128&(l=P[B+2])||128&(c=P[B+3]));)r[$++]=o,r[$++]=a,r[$++]=l,r[$++]=c,B+=4;if(o=P[B++],o<128)r[$++]=o;else if((224&o)==192){if(B>=s)return this.interim[0]=o,$;if(a=P[B++],(192&a)!=128){B--;continue}if(A=(31&o)<<6|63&a,A<128){B--;continue}r[$++]=A}else if((240&o)==224){if(B>=s)return this.interim[0]=o,$;if(a=P[B++],(192&a)!=128){B--;continue}if(B>=s)return this.interim[0]=o,this.interim[1]=a,$;if(l=P[B++],(192&l)!=128){B--;continue}if(A=(15&o)<<12|(63&a)<<6|63&l,A<2048||A>=55296&&A<=57343||A===65279)continue;r[$++]=A}else if((248&o)==240){if(B>=s)return this.interim[0]=o,$;if(a=P[B++],(192&a)!=128){B--;continue}if(B>=s)return this.interim[0]=o,this.interim[1]=a,$;if(l=P[B++],(192&l)!=128){B--;continue}if(B>=s)return this.interim[0]=o,this.interim[1]=a,this.interim[2]=l,$;if(c=P[B++],(192&c)!=128){B--;continue}if(A=(7&o)<<18|(63&a)<<12|(63&l)<<6|63&c,A<65536||A>1114111)continue;r[$++]=A}}return $}}},225:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.UnicodeV6=void 0;let P=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],r=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],s;j.UnicodeV6=class{constructor(){if(this.version="6",!s){s=new Uint8Array(65536),s.fill(1),s[0]=0,s.fill(0,1,32),s.fill(0,127,160),s.fill(2,4352,4448),s[9001]=2,s[9002]=2,s.fill(2,11904,42192),s[12351]=1,s.fill(2,44032,55204),s.fill(2,63744,64256),s.fill(2,65040,65050),s.fill(2,65072,65136),s.fill(2,65280,65377),s.fill(2,65504,65511);for(let o=0;o<P.length;++o)s.fill(0,P[o][0],P[o][1]+1)}}wcwidth(o){return o<32?0:o<127?1:o<65536?s[o]:function(a,l){let c,$=0,A=l.length-1;if(a<l[0][0]||a>l[A][1])return!1;for(;A>=$;)if(c=$+A>>1,a>l[c][1])$=c+1;else{if(!(a<l[c][0]))return!0;A=c-1}return!1}(o,r)?0:o>=131072&&o<=196605||o>=196608&&o<=262141?2:1}}},5981:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.WriteBuffer=void 0;let r=P(8460),s=P(844);class o extends s.Disposable{constructor(l){super(),this._action=l,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new r.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(l,c){if(c!==void 0&&this._syncCalls>c)return void(this._syncCalls=0);if(this._pendingData+=l.length,this._writeBuffer.push(l),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let $;for(this._isSyncWriting=!0;$=this._writeBuffer.shift();){this._action($);let A=this._callbacks.shift();A&&A()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(l,c){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=l.length,this._writeBuffer.push(l),this._callbacks.push(c),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=l.length,this._writeBuffer.push(l),this._callbacks.push(c)}_innerWrite(l=0,c=!0){let $=l||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let A=this._writeBuffer[this._bufferOffset],e=this._action(A,c);if(e){let B=t=>Date.now()-$>=12?setTimeout(()=>this._innerWrite(0,t)):this._innerWrite($,t);return void e.catch(t=>(queueMicrotask(()=>{throw t}),Promise.resolve(!1))).then(B)}let k=this._callbacks[this._bufferOffset];if(k&&k(),this._bufferOffset++,this._pendingData-=A.length,Date.now()-$>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}j.WriteBuffer=o},5941:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.toRgbString=j.parseColor=void 0;let P=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,r=/^[\da-f]+$/;function s(o,a){let l=o.toString(16),c=l.length<2?"0"+l:l;switch(a){case 4:return l[0];case 8:return c;case 12:return(c+c).slice(0,3);default:return c+c}}j.parseColor=function(o){if(!o)return;let a=o.toLowerCase();if(a.indexOf("rgb:")===0){a=a.slice(4);let l=P.exec(a);if(l){let c=l[1]?15:l[4]?255:l[7]?4095:65535;return[Math.round(parseInt(l[1]||l[4]||l[7]||l[10],16)/c*255),Math.round(parseInt(l[2]||l[5]||l[8]||l[11],16)/c*255),Math.round(parseInt(l[3]||l[6]||l[9]||l[12],16)/c*255)]}}else if(a.indexOf("#")===0&&(a=a.slice(1),r.exec(a)&&[3,6,9,12].includes(a.length))){let l=a.length/3,c=[0,0,0];for(let $=0;$<3;++$){let A=parseInt(a.slice(l*$,l*$+l),16);c[$]=l===1?A<<4:l===2?A:l===3?A>>4:A>>8}return c}},j.toRgbString=function(o,a=16){let[l,c,$]=o;return`rgb:${s(l,a)}/${s(c,a)}/${s($,a)}`}},5770:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.PAYLOAD_LIMIT=void 0,j.PAYLOAD_LIMIT=1e7},6351:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.DcsHandler=j.DcsParser=void 0;let r=P(482),s=P(8742),o=P(5770),a=[];j.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=a,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=a}registerHandler(c,$){this._handlers[c]===void 0&&(this._handlers[c]=[]);let A=this._handlers[c];return A.push($),{dispose:()=>{let e=A.indexOf($);e!==-1&&A.splice(e,1)}}}clearHandler(c){this._handlers[c]&&delete this._handlers[c]}setHandlerFallback(c){this._handlerFb=c}reset(){if(this._active.length)for(let c=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;c>=0;--c)this._active[c].unhook(!1);this._stack.paused=!1,this._active=a,this._ident=0}hook(c,$){if(this.reset(),this._ident=c,this._active=this._handlers[c]||a,this._active.length)for(let A=this._active.length-1;A>=0;A--)this._active[A].hook($);else this._handlerFb(this._ident,"HOOK",$)}put(c,$,A){if(this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].put(c,$,A);else this._handlerFb(this._ident,"PUT",(0,r.utf32ToString)(c,$,A))}unhook(c,$=!0){if(this._active.length){let A=!1,e=this._active.length-1,k=!1;if(this._stack.paused&&(e=this._stack.loopPosition-1,A=$,k=this._stack.fallThrough,this._stack.paused=!1),!k&&A===!1){for(;e>=0&&(A=this._active[e].unhook(c),A!==!0);e--)if(A instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=e,this._stack.fallThrough=!1,A;e--}for(;e>=0;e--)if(A=this._active[e].unhook(!1),A instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=e,this._stack.fallThrough=!0,A}else this._handlerFb(this._ident,"UNHOOK",c);this._active=a,this._ident=0}};let l=new s.Params;l.addParam(0),j.DcsHandler=class{constructor(c){this._handler=c,this._data="",this._params=l,this._hitLimit=!1}hook(c){this._params=c.length>1||c.params[0]?c.clone():l,this._data="",this._hitLimit=!1}put(c,$,A){this._hitLimit||(this._data+=(0,r.utf32ToString)(c,$,A),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(c){let $=!1;if(this._hitLimit)$=!1;else if(c&&($=this._handler(this._data,this._params),$ instanceof Promise))return $.then(A=>(this._params=l,this._data="",this._hitLimit=!1,A));return this._params=l,this._data="",this._hitLimit=!1,$}}},2015:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.EscapeSequenceParser=j.VT500_TRANSITION_TABLE=j.TransitionTable=void 0;let r=P(844),s=P(8742),o=P(6242),a=P(6351);class l{constructor(e){this.table=new Uint8Array(e)}setDefault(e,k){this.table.fill(e<<4|k)}add(e,k,B,t){this.table[k<<8|e]=B<<4|t}addMany(e,k,B,t){for(let n=0;n<e.length;n++)this.table[k<<8|e[n]]=B<<4|t}}j.TransitionTable=l;let c=160;j.VT500_TRANSITION_TABLE=function(){let A=new l(4095),e=Array.apply(null,Array(256)).map((h,i)=>i),k=(h,i)=>e.slice(h,i),B=k(32,127),t=k(0,24);t.push(25),t.push.apply(t,k(28,32));let n=k(0,14),p;for(p in A.setDefault(1,0),A.addMany(B,0,2,0),n)A.addMany([24,26,153,154],p,3,0),A.addMany(k(128,144),p,3,0),A.addMany(k(144,152),p,3,0),A.add(156,p,0,0),A.add(27,p,11,1),A.add(157,p,4,8),A.addMany([152,158,159],p,0,7),A.add(155,p,11,3),A.add(144,p,11,9);return A.addMany(t,0,3,0),A.addMany(t,1,3,1),A.add(127,1,0,1),A.addMany(t,8,0,8),A.addMany(t,3,3,3),A.add(127,3,0,3),A.addMany(t,4,3,4),A.add(127,4,0,4),A.addMany(t,6,3,6),A.addMany(t,5,3,5),A.add(127,5,0,5),A.addMany(t,2,3,2),A.add(127,2,0,2),A.add(93,1,4,8),A.addMany(B,8,5,8),A.add(127,8,5,8),A.addMany([156,27,24,26,7],8,6,0),A.addMany(k(28,32),8,0,8),A.addMany([88,94,95],1,0,7),A.addMany(B,7,0,7),A.addMany(t,7,0,7),A.add(156,7,0,0),A.add(127,7,0,7),A.add(91,1,11,3),A.addMany(k(64,127),3,7,0),A.addMany(k(48,60),3,8,4),A.addMany([60,61,62,63],3,9,4),A.addMany(k(48,60),4,8,4),A.addMany(k(64,127),4,7,0),A.addMany([60,61,62,63],4,0,6),A.addMany(k(32,64),6,0,6),A.add(127,6,0,6),A.addMany(k(64,127),6,0,0),A.addMany(k(32,48),3,9,5),A.addMany(k(32,48),5,9,5),A.addMany(k(48,64),5,0,6),A.addMany(k(64,127),5,7,0),A.addMany(k(32,48),4,9,5),A.addMany(k(32,48),1,9,2),A.addMany(k(32,48),2,9,2),A.addMany(k(48,127),2,10,0),A.addMany(k(48,80),1,10,0),A.addMany(k(81,88),1,10,0),A.addMany([89,90,92],1,10,0),A.addMany(k(96,127),1,10,0),A.add(80,1,11,9),A.addMany(t,9,0,9),A.add(127,9,0,9),A.addMany(k(28,32),9,0,9),A.addMany(k(32,48),9,9,12),A.addMany(k(48,60),9,8,10),A.addMany([60,61,62,63],9,9,10),A.addMany(t,11,0,11),A.addMany(k(32,128),11,0,11),A.addMany(k(28,32),11,0,11),A.addMany(t,10,0,10),A.add(127,10,0,10),A.addMany(k(28,32),10,0,10),A.addMany(k(48,60),10,8,10),A.addMany([60,61,62,63],10,0,11),A.addMany(k(32,48),10,9,12),A.addMany(t,12,0,12),A.add(127,12,0,12),A.addMany(k(28,32),12,0,12),A.addMany(k(32,48),12,9,12),A.addMany(k(48,64),12,0,11),A.addMany(k(64,127),12,12,13),A.addMany(k(64,127),10,12,13),A.addMany(k(64,127),9,12,13),A.addMany(t,13,13,13),A.addMany(B,13,13,13),A.add(127,13,0,13),A.addMany([27,156,24,26],13,14,0),A.add(c,0,2,0),A.add(c,8,5,8),A.add(c,6,0,6),A.add(c,11,0,11),A.add(c,13,13,13),A}();class $ extends r.Disposable{constructor(e=j.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new s.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(k,B,t)=>{},this._executeHandlerFb=k=>{},this._csiHandlerFb=(k,B)=>{},this._escHandlerFb=k=>{},this._errorHandlerFb=k=>k,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,r.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new o.OscParser),this._dcsParser=this.register(new a.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,k=[64,126]){let B=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(B=e.prefix.charCodeAt(0),B&&60>B||B>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let n=0;n<e.intermediates.length;++n){let p=e.intermediates.charCodeAt(n);if(32>p||p>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");B<<=8,B|=p}}if(e.final.length!==1)throw new Error("final must be a single byte");let t=e.final.charCodeAt(0);if(k[0]>t||t>k[1])throw new Error(`final must be in range ${k[0]} .. ${k[1]}`);return B<<=8,B|=t,B}identToString(e){let k=[];for(;e;)k.push(String.fromCharCode(255&e)),e>>=8;return k.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,k){let B=this._identifier(e,[48,126]);this._escHandlers[B]===void 0&&(this._escHandlers[B]=[]);let t=this._escHandlers[B];return t.push(k),{dispose:()=>{let n=t.indexOf(k);n!==-1&&t.splice(n,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,k){this._executeHandlers[e.charCodeAt(0)]=k}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,k){let B=this._identifier(e);this._csiHandlers[B]===void 0&&(this._csiHandlers[B]=[]);let t=this._csiHandlers[B];return t.push(k),{dispose:()=>{let n=t.indexOf(k);n!==-1&&t.splice(n,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,k){return this._dcsParser.registerHandler(this._identifier(e),k)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,k){return this._oscParser.registerHandler(e,k)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,k,B,t,n){this._parseStack.state=e,this._parseStack.handlers=k,this._parseStack.handlerPos=B,this._parseStack.transition=t,this._parseStack.chunkPos=n}parse(e,k,B){let t,n=0,p=0,h=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,h=this._parseStack.chunkPos+1;else{if(B===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let i=this._parseStack.handlers,g=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(B===!1&&g>-1){for(;g>=0&&(t=i[g](this._params),t!==!0);g--)if(t instanceof Promise)return this._parseStack.handlerPos=g,t}this._parseStack.handlers=[];break;case 4:if(B===!1&&g>-1){for(;g>=0&&(t=i[g](),t!==!0);g--)if(t instanceof Promise)return this._parseStack.handlerPos=g,t}this._parseStack.handlers=[];break;case 6:if(n=e[this._parseStack.chunkPos],t=this._dcsParser.unhook(n!==24&&n!==26,B),t)return t;n===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(n=e[this._parseStack.chunkPos],t=this._oscParser.end(n!==24&&n!==26,B),t)return t;n===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,h=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let i=h;i<k;++i){switch(n=e[i],p=this._transitions.table[this.currentState<<8|(n<160?n:c)],p>>4){case 2:for(let x=i+1;;++x){if(x>=k||(n=e[x])<32||n>126&&n<c){this._printHandler(e,i,x),i=x-1;break}if(++x>=k||(n=e[x])<32||n>126&&n<c){this._printHandler(e,i,x),i=x-1;break}if(++x>=k||(n=e[x])<32||n>126&&n<c){this._printHandler(e,i,x),i=x-1;break}if(++x>=k||(n=e[x])<32||n>126&&n<c){this._printHandler(e,i,x),i=x-1;break}}break;case 3:this._executeHandlers[n]?this._executeHandlers[n]():this._executeHandlerFb(n),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:i,code:n,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let g=this._csiHandlers[this._collect<<8|n],E=g?g.length-1:-1;for(;E>=0&&(t=g[E](this._params),t!==!0);E--)if(t instanceof Promise)return this._preserveStack(3,g,E,p,i),t;E<0&&this._csiHandlerFb(this._collect<<8|n,this._params),this.precedingCodepoint=0;break;case 8:do switch(n){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(n-48)}while(++i<k&&(n=e[i])>47&&n<60);i--;break;case 9:this._collect<<=8,this._collect|=n;break;case 10:let m=this._escHandlers[this._collect<<8|n],v=m?m.length-1:-1;for(;v>=0&&(t=m[v](),t!==!0);v--)if(t instanceof Promise)return this._preserveStack(4,m,v,p,i),t;v<0&&this._escHandlerFb(this._collect<<8|n),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|n,this._params);break;case 13:for(let x=i+1;;++x)if(x>=k||(n=e[x])===24||n===26||n===27||n>127&&n<c){this._dcsParser.put(e,i,x),i=x-1;break}break;case 14:if(t=this._dcsParser.unhook(n!==24&&n!==26),t)return this._preserveStack(6,[],0,p,i),t;n===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let x=i+1;;x++)if(x>=k||(n=e[x])<32||n>127&&n<c){this._oscParser.put(e,i,x),i=x-1;break}break;case 6:if(t=this._oscParser.end(n!==24&&n!==26),t)return this._preserveStack(5,[],0,p,i),t;n===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&p}}}j.EscapeSequenceParser=$},6242:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.OscHandler=j.OscParser=void 0;let r=P(5770),s=P(482),o=[];j.OscParser=class{constructor(){this._state=0,this._active=o,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(a,l){this._handlers[a]===void 0&&(this._handlers[a]=[]);let c=this._handlers[a];return c.push(l),{dispose:()=>{let $=c.indexOf(l);$!==-1&&c.splice($,1)}}}clearHandler(a){this._handlers[a]&&delete this._handlers[a]}setHandlerFallback(a){this._handlerFb=a}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}reset(){if(this._state===2)for(let a=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;a>=0;--a)this._active[a].end(!1);this._stack.paused=!1,this._active=o,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||o,this._active.length)for(let a=this._active.length-1;a>=0;a--)this._active[a].start();else this._handlerFb(this._id,"START")}_put(a,l,c){if(this._active.length)for(let $=this._active.length-1;$>=0;$--)this._active[$].put(a,l,c);else this._handlerFb(this._id,"PUT",(0,s.utf32ToString)(a,l,c))}start(){this.reset(),this._state=1}put(a,l,c){if(this._state!==3){if(this._state===1)for(;l<c;){let $=a[l++];if($===59){this._state=2,this._start();break}if($<48||57<$)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+$-48}this._state===2&&c-l>0&&this._put(a,l,c)}}end(a,l=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let c=!1,$=this._active.length-1,A=!1;if(this._stack.paused&&($=this._stack.loopPosition-1,c=l,A=this._stack.fallThrough,this._stack.paused=!1),!A&&c===!1){for(;$>=0&&(c=this._active[$].end(a),c!==!0);$--)if(c instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=$,this._stack.fallThrough=!1,c;$--}for(;$>=0;$--)if(c=this._active[$].end(!1),c instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=$,this._stack.fallThrough=!0,c}else this._handlerFb(this._id,"END",a);this._active=o,this._id=-1,this._state=0}}},j.OscHandler=class{constructor(a){this._handler=a,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(a,l,c){this._hitLimit||(this._data+=(0,s.utf32ToString)(a,l,c),this._data.length>r.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(a){let l=!1;if(this._hitLimit)l=!1;else if(a&&(l=this._handler(this._data),l instanceof Promise))return l.then(c=>(this._data="",this._hitLimit=!1,c));return this._data="",this._hitLimit=!1,l}}},8742:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.Params=void 0;let P=2147483647;class r{constructor(o=32,a=32){if(this.maxLength=o,this.maxSubParamsLength=a,a>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(a),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(o){let a=new r;if(!o.length)return a;for(let l=Array.isArray(o[0])?1:0;l<o.length;++l){let c=o[l];if(Array.isArray(c))for(let $=0;$<c.length;++$)a.addSubParam(c[$]);else a.addParam(c)}return a}clone(){let o=new r(this.maxLength,this.maxSubParamsLength);return o.params.set(this.params),o.length=this.length,o._subParams.set(this._subParams),o._subParamsLength=this._subParamsLength,o._subParamsIdx.set(this._subParamsIdx),o._rejectDigits=this._rejectDigits,o._rejectSubDigits=this._rejectSubDigits,o._digitIsSub=this._digitIsSub,o}toArray(){let o=[];for(let a=0;a<this.length;++a){o.push(this.params[a]);let l=this._subParamsIdx[a]>>8,c=255&this._subParamsIdx[a];c-l>0&&o.push(Array.prototype.slice.call(this._subParams,l,c))}return o}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(o){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=o>P?P:o}}addSubParam(o){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=o>P?P:o,this._subParamsIdx[this.length-1]++}}hasSubParams(o){return(255&this._subParamsIdx[o])-(this._subParamsIdx[o]>>8)>0}getSubParams(o){let a=this._subParamsIdx[o]>>8,l=255&this._subParamsIdx[o];return l-a>0?this._subParams.subarray(a,l):null}getSubParamsAll(){let o={};for(let a=0;a<this.length;++a){let l=this._subParamsIdx[a]>>8,c=255&this._subParamsIdx[a];c-l>0&&(o[a]=this._subParams.slice(l,c))}return o}addDigit(o){let a;if(this._rejectDigits||!(a=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let l=this._digitIsSub?this._subParams:this.params,c=l[a-1];l[a-1]=~c?Math.min(10*c+o,P):o}}j.Params=r},5741:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.AddonManager=void 0,j.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let P=this._addons.length-1;P>=0;P--)this._addons[P].instance.dispose()}loadAddon(P,r){let s={instance:r,dispose:r.dispose,isDisposed:!1};this._addons.push(s),r.dispose=()=>this._wrappedAddonDispose(s),r.activate(P)}_wrappedAddonDispose(P){if(P.isDisposed)return;let r=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===P){r=s;break}if(r===-1)throw new Error("Could not dispose an addon that has not been loaded");P.isDisposed=!0,P.dispose.apply(P.instance),this._addons.splice(r,1)}}},8771:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferApiView=void 0;let r=P(3785),s=P(511);j.BufferApiView=class{constructor(o,a){this._buffer=o,this.type=a}init(o){return this._buffer=o,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(o){let a=this._buffer.lines.get(o);if(a)return new r.BufferLineApiView(a)}getNullCell(){return new s.CellData}}},3785:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferLineApiView=void 0;let r=P(511);j.BufferLineApiView=class{constructor(s){this._line=s}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(s,o){if(!(s<0||s>=this._line.length))return o?(this._line.loadCell(s,o),o):this._line.loadCell(s,new r.CellData)}translateToString(s,o,a){return this._line.translateToString(s,o,a)}}},8285:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.BufferNamespaceApi=void 0;let r=P(8771),s=P(8460);j.BufferNamespaceApi=class{constructor(o){this._core=o,this._onBufferChange=new s.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new r.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new r.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.ParserApi=void 0,j.ParserApi=class{constructor(P){this._core=P}registerCsiHandler(P,r){return this._core.registerCsiHandler(P,s=>r(s.toArray()))}addCsiHandler(P,r){return this.registerCsiHandler(P,r)}registerDcsHandler(P,r){return this._core.registerDcsHandler(P,(s,o)=>r(s,o.toArray()))}addDcsHandler(P,r){return this.registerDcsHandler(P,r)}registerEscHandler(P,r){return this._core.registerEscHandler(P,r)}addEscHandler(P,r){return this.registerEscHandler(P,r)}registerOscHandler(P,r){return this._core.registerOscHandler(P,r)}addOscHandler(P,r){return this.registerOscHandler(P,r)}}},7090:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.UnicodeApi=void 0,j.UnicodeApi=class{constructor(P){this._core=P}register(P){this._core.unicodeService.register(P)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(P){this._core.unicodeService.activeVersion=P}}},744:function(S,j,P){var r=this&&this.__decorate||function(A,e,k,B){var t,n=arguments.length,p=n<3?e:B===null?B=Object.getOwnPropertyDescriptor(e,k):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(A,e,k,B);else for(var h=A.length-1;h>=0;h--)(t=A[h])&&(p=(n<3?t(p):n>3?t(e,k,p):t(e,k))||p);return n>3&&p&&Object.defineProperty(e,k,p),p},s=this&&this.__param||function(A,e){return function(k,B){e(k,B,A)}};Object.defineProperty(j,"__esModule",{value:!0}),j.BufferService=j.MINIMUM_ROWS=j.MINIMUM_COLS=void 0;let o=P(2585),a=P(5295),l=P(8460),c=P(844);j.MINIMUM_COLS=2,j.MINIMUM_ROWS=1;let $=class extends c.Disposable{constructor(A){super(),this.isUserScrolling=!1,this._onResize=this.register(new l.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new l.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(A.rawOptions.cols||0,j.MINIMUM_COLS),this.rows=Math.max(A.rawOptions.rows||0,j.MINIMUM_ROWS),this.buffers=this.register(new a.BufferSet(A,this))}get buffer(){return this.buffers.active}resize(A,e){this.cols=A,this.rows=e,this.buffers.resize(A,e),this._onResize.fire({cols:A,rows:e})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(A,e=!1){let k=this.buffer,B;B=this._cachedBlankLine,B&&B.length===this.cols&&B.getFg(0)===A.fg&&B.getBg(0)===A.bg||(B=k.getBlankLine(A,e),this._cachedBlankLine=B),B.isWrapped=e;let t=k.ybase+k.scrollTop,n=k.ybase+k.scrollBottom;if(k.scrollTop===0){let p=k.lines.isFull;n===k.lines.length-1?p?k.lines.recycle().copyFrom(B):k.lines.push(B.clone()):k.lines.splice(n+1,0,B.clone()),p?this.isUserScrolling&&(k.ydisp=Math.max(k.ydisp-1,0)):(k.ybase++,this.isUserScrolling||k.ydisp++)}else{let p=n-t+1;k.lines.shiftElements(t+1,p-1,-1),k.lines.set(n,B.clone())}this.isUserScrolling||(k.ydisp=k.ybase),this._onScroll.fire(k.ydisp)}scrollLines(A,e,k){let B=this.buffer;if(A<0){if(B.ydisp===0)return;this.isUserScrolling=!0}else A+B.ydisp>=B.ybase&&(this.isUserScrolling=!1);let t=B.ydisp;B.ydisp=Math.max(Math.min(B.ydisp+A,B.ybase),0),t!==B.ydisp&&(e||this._onScroll.fire(B.ydisp))}scrollPages(A){this.scrollLines(A*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(A){let e=A-this.buffer.ydisp;e!==0&&this.scrollLines(e)}};$=r([s(0,o.IOptionsService)],$),j.BufferService=$},7994:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.CharsetService=void 0,j.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(P){this.glevel=P,this.charset=this._charsets[P]}setgCharset(P,r){this._charsets[P]=r,this.glevel===P&&(this.charset=r)}}},1753:function(S,j,P){var r=this&&this.__decorate||function(B,t,n,p){var h,i=arguments.length,g=i<3?t:p===null?p=Object.getOwnPropertyDescriptor(t,n):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(B,t,n,p);else for(var E=B.length-1;E>=0;E--)(h=B[E])&&(g=(i<3?h(g):i>3?h(t,n,g):h(t,n))||g);return i>3&&g&&Object.defineProperty(t,n,g),g},s=this&&this.__param||function(B,t){return function(n,p){t(n,p,B)}};Object.defineProperty(j,"__esModule",{value:!0}),j.CoreMouseService=void 0;let o=P(2585),a=P(8460),l=P(844),c={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:B=>B.button!==4&&B.action===1&&(B.ctrl=!1,B.alt=!1,B.shift=!1,!0)},VT200:{events:19,restrict:B=>B.action!==32},DRAG:{events:23,restrict:B=>B.action!==32||B.button!==3},ANY:{events:31,restrict:B=>!0}};function $(B,t){let n=(B.ctrl?16:0)|(B.shift?4:0)|(B.alt?8:0);return B.button===4?(n|=64,n|=B.action):(n|=3&B.button,4&B.button&&(n|=64),8&B.button&&(n|=128),B.action===32?n|=32:B.action!==0||t||(n|=3)),n}let A=String.fromCharCode,e={DEFAULT:B=>{let t=[$(B,!1)+32,B.col+32,B.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${A(t[0])}${A(t[1])}${A(t[2])}`},SGR:B=>{let t=B.action===0&&B.button!==4?"m":"M";return`\x1B[<${$(B,!0)};${B.col};${B.row}${t}`},SGR_PIXELS:B=>{let t=B.action===0&&B.button!==4?"m":"M";return`\x1B[<${$(B,!0)};${B.x};${B.y}${t}`}},k=class extends l.Disposable{constructor(B,t){super(),this._bufferService=B,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new a.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let n of Object.keys(c))this.addProtocol(n,c[n]);for(let n of Object.keys(e))this.addEncoding(n,e[n]);this.reset()}addProtocol(B,t){this._protocols[B]=t}addEncoding(B,t){this._encodings[B]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(B){if(!this._protocols[B])throw new Error(`unknown protocol "${B}"`);this._activeProtocol=B,this._onProtocolChange.fire(this._protocols[B].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(B){if(!this._encodings[B])throw new Error(`unknown encoding "${B}"`);this._activeEncoding=B}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(B){if(B.col<0||B.col>=this._bufferService.cols||B.row<0||B.row>=this._bufferService.rows||B.button===4&&B.action===32||B.button===3&&B.action!==32||B.button!==4&&(B.action===2||B.action===3)||(B.col++,B.row++,B.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,B,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(B))return!1;let t=this._encodings[this._activeEncoding](B);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=B,!0}explainEvents(B){return{down:!!(1&B),up:!!(2&B),drag:!!(4&B),move:!!(8&B),wheel:!!(16&B)}}_equalEvents(B,t,n){if(n){if(B.x!==t.x||B.y!==t.y)return!1}else if(B.col!==t.col||B.row!==t.row)return!1;return B.button===t.button&&B.action===t.action&&B.ctrl===t.ctrl&&B.alt===t.alt&&B.shift===t.shift}};k=r([s(0,o.IBufferService),s(1,o.ICoreService)],k),j.CoreMouseService=k},6975:function(S,j,P){var r=this&&this.__decorate||function(k,B,t,n){var p,h=arguments.length,i=h<3?B:n===null?n=Object.getOwnPropertyDescriptor(B,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(k,B,t,n);else for(var g=k.length-1;g>=0;g--)(p=k[g])&&(i=(h<3?p(i):h>3?p(B,t,i):p(B,t))||i);return h>3&&i&&Object.defineProperty(B,t,i),i},s=this&&this.__param||function(k,B){return function(t,n){B(t,n,k)}};Object.defineProperty(j,"__esModule",{value:!0}),j.CoreService=void 0;let o=P(2585),a=P(8460),l=P(1439),c=P(844),$=Object.freeze({insertMode:!1}),A=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),e=class extends c.Disposable{constructor(k,B,t){super(),this._bufferService=k,this._logService=B,this._optionsService=t,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new a.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new a.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new a.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new a.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,l.clone)($),this.decPrivateModes=(0,l.clone)(A)}reset(){this.modes=(0,l.clone)($),this.decPrivateModes=(0,l.clone)(A)}triggerDataEvent(k,B=!1){if(this._optionsService.rawOptions.disableStdin)return;let t=this._bufferService.buffer;B&&this._optionsService.rawOptions.scrollOnUserInput&&t.ybase!==t.ydisp&&this._onRequestScrollToBottom.fire(),B&&this._onUserInput.fire(),this._logService.debug(`sending data "${k}"`,()=>k.split("").map(n=>n.charCodeAt(0))),this._onData.fire(k)}triggerBinaryEvent(k){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${k}"`,()=>k.split("").map(B=>B.charCodeAt(0))),this._onBinary.fire(k))}};e=r([s(0,o.IBufferService),s(1,o.ILogService),s(2,o.IOptionsService)],e),j.CoreService=e},9074:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.DecorationService=void 0;let r=P(8055),s=P(8460),o=P(844),a=P(6106),l=0,c=0;class $ extends o.Disposable{constructor(){super(),this._decorations=new a.SortedList(k=>k==null?void 0:k.marker.line),this._onDecorationRegistered=this.register(new s.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new s.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,o.toDisposable)(()=>{for(let k of this._decorations.values())this._onDecorationRemoved.fire(k);this.reset()}))}get decorations(){return this._decorations.values()}registerDecoration(k){if(k.marker.isDisposed)return;let B=new A(k);if(B){let t=B.marker.onDispose(()=>B.dispose());B.onDispose(()=>{B&&(this._decorations.delete(B)&&this._onDecorationRemoved.fire(B),t.dispose())}),this._decorations.insert(B),this._onDecorationRegistered.fire(B)}return B}reset(){for(let k of this._decorations.values())k.dispose();this._decorations.clear()}*getDecorationsAtCell(k,B,t){var n,p,h;let i=0,g=0;for(let E of this._decorations.getKeyIterator(B))i=(n=E.options.x)!==null&&n!==void 0?n:0,g=i+((p=E.options.width)!==null&&p!==void 0?p:1),k>=i&&k<g&&(!t||((h=E.options.layer)!==null&&h!==void 0?h:"bottom")===t)&&(yield E)}forEachDecorationAtCell(k,B,t,n){this._decorations.forEachByKey(B,p=>{var h,i,g;l=(h=p.options.x)!==null&&h!==void 0?h:0,c=l+((i=p.options.width)!==null&&i!==void 0?i:1),k>=l&&k<c&&(!t||((g=p.options.layer)!==null&&g!==void 0?g:"bottom")===t)&&n(p)})}dispose(){for(let k of this._decorations.values())this._onDecorationRemoved.fire(k);this.reset()}}j.DecorationService=$;class A extends o.Disposable{constructor(k){super(),this.options=k,this.isDisposed=!1,this.onRenderEmitter=this.register(new s.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new s.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=k.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=r.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=r.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.InstantiationService=j.ServiceCollection=void 0;let r=P(2585),s=P(8343);class o{constructor(...l){this._entries=new Map;for(let[c,$]of l)this.set(c,$)}set(l,c){let $=this._entries.get(l);return this._entries.set(l,c),$}forEach(l){for(let[c,$]of this._entries.entries())l(c,$)}has(l){return this._entries.has(l)}get(l){return this._entries.get(l)}}j.ServiceCollection=o,j.InstantiationService=class{constructor(){this._services=new o,this._services.set(r.IInstantiationService,this)}setService(a,l){this._services.set(a,l)}getService(a){return this._services.get(a)}createInstance(a,...l){let c=(0,s.getServiceDependencies)(a).sort((e,k)=>e.index-k.index),$=[];for(let e of c){let k=this._services.get(e.id);if(!k)throw new Error(`[createInstance] ${a.name} depends on UNKNOWN service ${e.id}.`);$.push(k)}let A=c.length>0?c[0].index:l.length;if(l.length!==A)throw new Error(`[createInstance] First service dependency of ${a.name} at position ${A+1} conflicts with ${l.length} static arguments`);return new a(...l,...$)}}},7866:function(S,j,P){var r=this&&this.__decorate||function($,A,e,k){var B,t=arguments.length,n=t<3?A:k===null?k=Object.getOwnPropertyDescriptor(A,e):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate($,A,e,k);else for(var p=$.length-1;p>=0;p--)(B=$[p])&&(n=(t<3?B(n):t>3?B(A,e,n):B(A,e))||n);return t>3&&n&&Object.defineProperty(A,e,n),n},s=this&&this.__param||function($,A){return function(e,k){A(e,k,$)}};Object.defineProperty(j,"__esModule",{value:!0}),j.LogService=void 0;let o=P(844),a=P(2585),l={debug:a.LogLevelEnum.DEBUG,info:a.LogLevelEnum.INFO,warn:a.LogLevelEnum.WARN,error:a.LogLevelEnum.ERROR,off:a.LogLevelEnum.OFF},c=class extends o.Disposable{constructor($){super(),this._optionsService=$,this.logLevel=a.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}_updateLogLevel(){this.logLevel=l[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams($){for(let A=0;A<$.length;A++)typeof $[A]=="function"&&($[A]=$[A]())}_log($,A,e){this._evalLazyOptionalParams(e),$.call(console,"xterm.js: "+A,...e)}debug($,...A){this.logLevel<=a.LogLevelEnum.DEBUG&&this._log(console.log,$,A)}info($,...A){this.logLevel<=a.LogLevelEnum.INFO&&this._log(console.info,$,A)}warn($,...A){this.logLevel<=a.LogLevelEnum.WARN&&this._log(console.warn,$,A)}error($,...A){this.logLevel<=a.LogLevelEnum.ERROR&&this._log(console.error,$,A)}};c=r([s(0,a.IOptionsService)],c),j.LogService=c},7302:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.OptionsService=j.DEFAULT_OPTIONS=void 0;let r=P(8460),s=P(6114),o=P(844);j.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:s.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let a=["normal","bold","100","200","300","400","500","600","700","800","900"];class l extends o.Disposable{constructor($){super(),this._onOptionChange=this.register(new r.EventEmitter),this.onOptionChange=this._onOptionChange.event;let A=Object.assign({},j.DEFAULT_OPTIONS);for(let e in $)if(e in A)try{let k=$[e];A[e]=this._sanitizeAndValidateOption(e,k)}catch(k){console.error(k)}this.rawOptions=A,this.options=Object.assign({},A),this._setupOptions()}onSpecificOptionChange($,A){return this.onOptionChange(e=>{e===$&&A(this.rawOptions[$])})}onMultipleOptionChange($,A){return this.onOptionChange(e=>{$.indexOf(e)!==-1&&A()})}_setupOptions(){let $=e=>{if(!(e in j.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},A=(e,k)=>{if(!(e in j.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);k=this._sanitizeAndValidateOption(e,k),this.rawOptions[e]!==k&&(this.rawOptions[e]=k,this._onOptionChange.fire(e))};for(let e in this.rawOptions){let k={get:$.bind(this,e),set:A.bind(this,e)};Object.defineProperty(this.options,e,k)}}_sanitizeAndValidateOption($,A){switch($){case"cursorStyle":if(A||(A=j.DEFAULT_OPTIONS[$]),!function(e){return e==="block"||e==="underline"||e==="bar"}(A))throw new Error(`"${A}" is not a valid value for ${$}`);break;case"wordSeparator":A||(A=j.DEFAULT_OPTIONS[$]);break;case"fontWeight":case"fontWeightBold":if(typeof A=="number"&&1<=A&&A<=1e3)break;A=a.includes(A)?A:j.DEFAULT_OPTIONS[$];break;case"cursorWidth":A=Math.floor(A);case"lineHeight":case"tabStopWidth":if(A<1)throw new Error(`${$} cannot be less than 1, value: ${A}`);break;case"minimumContrastRatio":A=Math.max(1,Math.min(21,Math.round(10*A)/10));break;case"scrollback":if((A=Math.min(A,4294967295))<0)throw new Error(`${$} cannot be less than 0, value: ${A}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(A<=0)throw new Error(`${$} cannot be less than or equal to 0, value: ${A}`);case"rows":case"cols":if(!A&&A!==0)throw new Error(`${$} must be numeric, value: ${A}`)}return A}}j.OptionsService=l},2660:function(S,j,P){var r=this&&this.__decorate||function(l,c,$,A){var e,k=arguments.length,B=k<3?c:A===null?A=Object.getOwnPropertyDescriptor(c,$):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(l,c,$,A);else for(var t=l.length-1;t>=0;t--)(e=l[t])&&(B=(k<3?e(B):k>3?e(c,$,B):e(c,$))||B);return k>3&&B&&Object.defineProperty(c,$,B),B},s=this&&this.__param||function(l,c){return function($,A){c($,A,l)}};Object.defineProperty(j,"__esModule",{value:!0}),j.OscLinkService=void 0;let o=P(2585),a=class{constructor(l){this._bufferService=l,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(l){let c=this._bufferService.buffer;if(l.id===void 0){let t=c.addMarker(c.ybase+c.y),n={data:l,id:this._nextId++,lines:[t]};return t.onDispose(()=>this._removeMarkerFromLink(n,t)),this._dataByLinkId.set(n.id,n),n.id}let $=l,A=this._getEntryIdKey($),e=this._entriesWithId.get(A);if(e)return this.addLineToLink(e.id,c.ybase+c.y),e.id;let k=c.addMarker(c.ybase+c.y),B={id:this._nextId++,key:this._getEntryIdKey($),data:$,lines:[k]};return k.onDispose(()=>this._removeMarkerFromLink(B,k)),this._entriesWithId.set(B.key,B),this._dataByLinkId.set(B.id,B),B.id}addLineToLink(l,c){let $=this._dataByLinkId.get(l);if($&&$.lines.every(A=>A.line!==c)){let A=this._bufferService.buffer.addMarker(c);$.lines.push(A),A.onDispose(()=>this._removeMarkerFromLink($,A))}}getLinkData(l){var c;return(c=this._dataByLinkId.get(l))===null||c===void 0?void 0:c.data}_getEntryIdKey(l){return`${l.id};;${l.uri}`}_removeMarkerFromLink(l,c){let $=l.lines.indexOf(c);$!==-1&&(l.lines.splice($,1),l.lines.length===0&&(l.data.id!==void 0&&this._entriesWithId.delete(l.key),this._dataByLinkId.delete(l.id)))}};a=r([s(0,o.IBufferService)],a),j.OscLinkService=a},8343:(S,j)=>{function P(r,s,o){s.di$target===s?s.di$dependencies.push({id:r,index:o}):(s.di$dependencies=[{id:r,index:o}],s.di$target=s)}Object.defineProperty(j,"__esModule",{value:!0}),j.createDecorator=j.getServiceDependencies=j.serviceRegistry=void 0,j.serviceRegistry=new Map,j.getServiceDependencies=function(r){return r.di$dependencies||[]},j.createDecorator=function(r){if(j.serviceRegistry.has(r))return j.serviceRegistry.get(r);let s=function(o,a,l){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");P(s,o,l)};return s.toString=()=>r,j.serviceRegistry.set(r,s),s}},2585:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.IDecorationService=j.IUnicodeService=j.IOscLinkService=j.IOptionsService=j.ILogService=j.LogLevelEnum=j.IInstantiationService=j.ICharsetService=j.ICoreService=j.ICoreMouseService=j.IBufferService=void 0;let r=P(8343);var s;j.IBufferService=(0,r.createDecorator)("BufferService"),j.ICoreMouseService=(0,r.createDecorator)("CoreMouseService"),j.ICoreService=(0,r.createDecorator)("CoreService"),j.ICharsetService=(0,r.createDecorator)("CharsetService"),j.IInstantiationService=(0,r.createDecorator)("InstantiationService"),(s=j.LogLevelEnum||(j.LogLevelEnum={}))[s.DEBUG=0]="DEBUG",s[s.INFO=1]="INFO",s[s.WARN=2]="WARN",s[s.ERROR=3]="ERROR",s[s.OFF=4]="OFF",j.ILogService=(0,r.createDecorator)("LogService"),j.IOptionsService=(0,r.createDecorator)("OptionsService"),j.IOscLinkService=(0,r.createDecorator)("OscLinkService"),j.IUnicodeService=(0,r.createDecorator)("UnicodeService"),j.IDecorationService=(0,r.createDecorator)("DecorationService")},1480:(S,j,P)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.UnicodeService=void 0;let r=P(8460),s=P(225);j.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new r.EventEmitter,this.onChange=this._onChange.event;let o=new s.UnicodeV6;this.register(o),this._active=o.version,this._activeProvider=o}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(o){if(!this._providers[o])throw new Error(`unknown Unicode version "${o}"`);this._active=o,this._activeProvider=this._providers[o],this._onChange.fire(o)}register(o){this._providers[o.version]=o}wcwidth(o){return this._activeProvider.wcwidth(o)}getStringCellWidth(o){let a=0,l=o.length;for(let c=0;c<l;++c){let $=o.charCodeAt(c);if(55296<=$&&$<=56319){if(++c>=l)return a+this.wcwidth($);let A=o.charCodeAt(c);56320<=A&&A<=57343?$=1024*($-55296)+A-56320+65536:a+=this.wcwidth(A)}a+=this.wcwidth($)}return a}}}},G={};function N(S){var j=G[S];if(j!==void 0)return j.exports;var P=G[S]={exports:{}};return w[S].call(P.exports,P,P.exports,N),P.exports}var U={};return(()=>{var S=U;Object.defineProperty(S,"__esModule",{value:!0}),S.Terminal=void 0;let j=N(3236),P=N(9042),r=N(7975),s=N(7090),o=N(5741),a=N(8285),l=["cols","rows"];S.Terminal=class{constructor(c){this._core=new j.Terminal(c),this._addonManager=new o.AddonManager,this._publicOptions=Object.assign({},this._core.options);let $=e=>this._core.options[e],A=(e,k)=>{this._checkReadonlyOptions(e),this._core.options[e]=k};for(let e in this._core.options){let k={get:$.bind(this,e),set:A.bind(this,e)};Object.defineProperty(this._publicOptions,e,k)}}_checkReadonlyOptions(c){if(l.includes(c))throw new Error(`Option "${c}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new r.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new s.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new a.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let c=this._core.coreService.decPrivateModes,$="none";switch(this._core.coreMouseService.activeProtocol){case"X10":$="x10";break;case"VT200":$="vt200";break;case"DRAG":$="drag";break;case"ANY":$="any"}return{applicationCursorKeysMode:c.applicationCursorKeys,applicationKeypadMode:c.applicationKeypad,bracketedPasteMode:c.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:$,originMode:c.origin,reverseWraparoundMode:c.reverseWraparound,sendFocusMode:c.sendFocus,wraparoundMode:c.wraparound}}get options(){return this._publicOptions}set options(c){for(let $ in c)this._publicOptions[$]=c[$]}blur(){this._core.blur()}focus(){this._core.focus()}resize(c,$){this._verifyIntegers(c,$),this._core.resize(c,$)}open(c){this._core.open(c)}attachCustomKeyEventHandler(c){this._core.attachCustomKeyEventHandler(c)}registerLinkProvider(c){return this._core.registerLinkProvider(c)}registerCharacterJoiner(c){return this._checkProposedApi(),this._core.registerCharacterJoiner(c)}deregisterCharacterJoiner(c){this._checkProposedApi(),this._core.deregisterCharacterJoiner(c)}registerMarker(c=0){return this._verifyIntegers(c),this._core.addMarker(c)}registerDecoration(c){var $,A,e;return this._checkProposedApi(),this._verifyPositiveIntegers(($=c.x)!==null&&$!==void 0?$:0,(A=c.width)!==null&&A!==void 0?A:0,(e=c.height)!==null&&e!==void 0?e:0),this._core.registerDecoration(c)}hasSelection(){return this._core.hasSelection()}select(c,$,A){this._verifyIntegers(c,$,A),this._core.select(c,$,A)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(c,$){this._verifyIntegers(c,$),this._core.selectLines(c,$)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(c){this._verifyIntegers(c),this._core.scrollLines(c)}scrollPages(c){this._verifyIntegers(c),this._core.scrollPages(c)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(c){this._verifyIntegers(c),this._core.scrollToLine(c)}clear(){this._core.clear()}write(c,$){this._core.write(c,$)}writeln(c,$){this._core.write(c),this._core.write(`\r
`,$)}paste(c){this._core.paste(c)}refresh(c,$){this._verifyIntegers(c,$),this._core.refresh(c,$)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(c){return this._addonManager.loadAddon(this,c)}static get strings(){return P}_verifyIntegers(...c){for(let $ of c)if($===1/0||isNaN($)||$%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...c){for(let $ of c)if($&&($===1/0||isNaN($)||$%1!=0||$<0))throw new Error("This API only accepts positive integers")}}})(),U})()})});var sA=BA((q,eA)=>{(function(w,G){typeof q=="object"&&typeof eA=="object"?eA.exports=G():typeof define=="function"&&define.amd?define([],G):typeof q=="object"?q.FitAddon=G():w.FitAddon=G()})(self,function(){return(()=>{"use strict";var w={};return(()=>{var G=w;Object.defineProperty(G,"__esModule",{value:!0}),G.FitAddon=void 0,G.FitAddon=class{constructor(){}activate(N){this._terminal=N}dispose(){}fit(){let N=this.proposeDimensions();if(!N||!this._terminal||isNaN(N.cols)||isNaN(N.rows))return;let U=this._terminal._core;this._terminal.rows===N.rows&&this._terminal.cols===N.cols||(U._renderService.clear(),this._terminal.resize(N.cols,N.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let N=this._terminal._core,U=N._renderService.dimensions;if(U.css.cell.width===0||U.css.cell.height===0)return;let S=this._terminal.options.scrollback===0?0:N.viewport.scrollBarWidth,j=window.getComputedStyle(this._terminal.element.parentElement),P=parseInt(j.getPropertyValue("height")),r=Math.max(0,parseInt(j.getPropertyValue("width"))),s=window.getComputedStyle(this._terminal.element),o=P-(parseInt(s.getPropertyValue("padding-top"))+parseInt(s.getPropertyValue("padding-bottom"))),a=r-(parseInt(s.getPropertyValue("padding-right"))+parseInt(s.getPropertyValue("padding-left")))-S;return{cols:Math.max(2,Math.floor(a/U.css.cell.width)),rows:Math.max(1,Math.floor(o/U.css.cell.height))}}}})(),w})()})});var cA=BA((z,kA)=>{(function(w,G){typeof z=="object"&&typeof kA=="object"?kA.exports=G():typeof define=="function"&&define.amd?define([],G):typeof z=="object"?z.WebLinksAddon=G():w.WebLinksAddon=G()})(self,function(){return(()=>{"use strict";var w={6:(S,j)=>{Object.defineProperty(j,"__esModule",{value:!0}),j.LinkComputer=j.WebLinkProvider=void 0,j.WebLinkProvider=class{constructor(r,s,o,a={}){this._terminal=r,this._regex=s,this._handler=o,this._options=a}provideLinks(r,s){let o=P.computeLink(r,this._regex,this._terminal,this._handler);s(this._addCallbacks(o))}_addCallbacks(r){return r.map(s=>(s.leave=this._options.leave,s.hover=(o,a)=>{if(this._options.hover){let{range:l}=s;this._options.hover(o,a,l)}},s))}};class P{static computeLink(s,o,a,l){let c=new RegExp(o.source,(o.flags||"")+"g"),[$,A]=P._getWindowedLineStrings(s-1,a),e=$.join(""),k,B=[];for(;k=c.exec(e);){let t=k[0];try{let E=new URL(t),m=decodeURI(E.toString());if(t!==m&&t+"/"!==m)continue}catch(E){continue}let[n,p]=P._mapStrIdx(a,A,0,k.index),[h,i]=P._mapStrIdx(a,n,p,t.length);if(n===-1||p===-1||h===-1||i===-1)continue;let g={start:{x:p+1,y:n+1},end:{x:i,y:h+1}};B.push({range:g,text:t,activate:l})}return B}static _getWindowedLineStrings(s,o){let a,l=s,c=s,$=0,A="",e=[];if(a=o.buffer.active.getLine(s)){let k=a.translateToString(!0);if(a.isWrapped&&k[0]!==" "){for($=0;(a=o.buffer.active.getLine(--l))&&$<2048&&(A=a.translateToString(!0),$+=A.length,e.push(A),a.isWrapped&&A.indexOf(" ")===-1););e.reverse()}for(e.push(k),$=0;(a=o.buffer.active.getLine(++c))&&a.isWrapped&&$<2048&&(A=a.translateToString(!0),$+=A.length,e.push(A),A.indexOf(" ")===-1););}return[e,l]}static _mapStrIdx(s,o,a,l){let c=s.buffer.active,$=c.getNullCell(),A=a;for(;l;){let e=c.getLine(o);if(!e)return[-1,-1];for(let k=A;k<e.length;++k){e.getCell(k,$);let B=$.getChars();if($.getWidth()&&(l-=B.length||1,k===e.length-1&&B==="")){let t=c.getLine(o+1);t&&t.isWrapped&&(t.getCell(0,$),$.getWidth()===2&&(l+=1))}if(l<0)return[o,k]}o++,A=0}return[o,A]}}j.LinkComputer=P}},G={};function N(S){var j=G[S];if(j!==void 0)return j.exports;var P=G[S]={exports:{}};return w[S](P,P.exports,N),P.exports}var U={};return(()=>{var S=U;Object.defineProperty(S,"__esModule",{value:!0}),S.WebLinksAddon=void 0;let j=N(6),P=/https?:[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function r(s,o){let a=window.open();if(a){try{a.opener=null}catch(l){}a.location.href=o}else console.warn("Opening link blocked as opener could not be cleared")}S.WebLinksAddon=class{constructor(s=r,o={}){this._handler=s,this._options=o}activate(s){this._terminal=s;let o=this._options,a=o.urlRegex||P;this._linkProvider=this._terminal.registerLinkProvider(new j.WebLinkProvider(this._terminal,a,this._handler,o))}dispose(){var s;(s=this._linkProvider)===null||s===void 0||s.dispose()}}})(),U})()})});(()=>{let w=()=>{let U=new Error("not implemented");return U.code="ENOSYS",U};if(!globalThis.fs){let U="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1,O_DIRECTORY:-1},writeSync(S,j){U+=N.decode(j);let P=U.lastIndexOf(`
`);return P!=-1&&(console.log(U.substring(0,P)),U=U.substring(P+1)),j.length},write(S,j,P,r,s,o){if(P!==0||r!==j.length||s!==null){o(w());return}let a=this.writeSync(S,j);o(null,a)},chmod(S,j,P){P(w())},chown(S,j,P,r){r(w())},close(S,j){j(w())},fchmod(S,j,P){P(w())},fchown(S,j,P,r){r(w())},fstat(S,j){j(w())},fsync(S,j){j(null)},ftruncate(S,j,P){P(w())},lchown(S,j,P,r){r(w())},link(S,j,P){P(w())},lstat(S,j){j(w())},mkdir(S,j,P){P(w())},open(S,j,P,r){r(w())},read(S,j,P,r,s,o){o(w())},readdir(S,j){j(w())},readlink(S,j){j(w())},rename(S,j,P){P(w())},rmdir(S,j){j(w())},stat(S,j){j(w())},symlink(S,j,P){P(w())},truncate(S,j,P){P(w())},unlink(S,j){j(w())},utimes(S,j,P,r){r(w())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw w()},pid:-1,ppid:-1,umask(){throw w()},cwd(){throw w()},chdir(){throw w()}}),globalThis.path||(globalThis.path={resolve(...U){return U.join("/")}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");let G=new TextEncoder("utf-8"),N=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=$=>{$!==0&&console.warn("exit code:",$)},this._exitPromise=new Promise($=>{this._resolveExitPromise=$}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;let U=($,A)=>{this.mem.setUint32($+0,A,!0),this.mem.setUint32($+4,Math.floor(A/4294967296),!0)},S=($,A)=>{this.mem.setUint32($+0,A,!0)},j=$=>{let A=this.mem.getUint32($+0,!0),e=this.mem.getInt32($+4,!0);return A+e*4294967296},P=$=>{let A=this.mem.getFloat64($,!0);if(A===0)return;if(!isNaN(A))return A;let e=this.mem.getUint32($,!0);return this._values[e]},r=($,A)=>{if(typeof A=="number"&&A!==0){if(isNaN(A)){this.mem.setUint32($+4,2146959360,!0),this.mem.setUint32($,0,!0);return}this.mem.setFloat64($,A,!0);return}if(A===void 0){this.mem.setFloat64($,0,!0);return}let k=this._ids.get(A);k===void 0&&(k=this._idPool.pop(),k===void 0&&(k=this._values.length),this._values[k]=A,this._goRefCounts[k]=0,this._ids.set(A,k)),this._goRefCounts[k]++;let B=0;switch(typeof A){case"object":A!==null&&(B=1);break;case"string":B=2;break;case"symbol":B=3;break;case"function":B=4;break}this.mem.setUint32($+4,2146959360|B,!0),this.mem.setUint32($,k,!0)},s=$=>{let A=j($+0),e=j($+8);return new Uint8Array(this._inst.exports.mem.buffer,A,e)},o=$=>{let A=j($+0),e=j($+8),k=new Array(e);for(let B=0;B<e;B++)k[B]=P(A+B*8);return k},a=$=>{let A=j($+0),e=j($+8);return N.decode(new DataView(this._inst.exports.mem.buffer,A,e))},l=($,A)=>(this._inst.exports.testExport0(),this._inst.exports.testExport($,A)),c=Date.now()-performance.now();this.importObject={_gotest:{add:($,A)=>$+A,callExport:l},gojs:{"runtime.wasmExit":$=>{$>>>=0;let A=this.mem.getInt32($+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(A)},"runtime.wasmWrite":$=>{$>>>=0;let A=j($+8),e=j($+16),k=this.mem.getInt32($+24,!0);fs.writeSync(A,new Uint8Array(this._inst.exports.mem.buffer,e,k))},"runtime.resetMemoryDataView":$=>{$>>>=0,this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":$=>{$>>>=0,U($+8,(c+performance.now())*1e6)},"runtime.walltime":$=>{$>>>=0;let A=new Date().getTime();U($+8,A/1e3),this.mem.setInt32($+16,A%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":$=>{$>>>=0;let A=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(A,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(A);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},j($+8))),this.mem.setInt32($+16,A,!0)},"runtime.clearTimeoutEvent":$=>{$>>>=0;let A=this.mem.getInt32($+8,!0);clearTimeout(this._scheduledTimeouts.get(A)),this._scheduledTimeouts.delete(A)},"runtime.getRandomData":$=>{$>>>=0,crypto.getRandomValues(s($+8))},"syscall/js.finalizeRef":$=>{$>>>=0;let A=this.mem.getUint32($+8,!0);if(this._goRefCounts[A]--,this._goRefCounts[A]===0){let e=this._values[A];this._values[A]=null,this._ids.delete(e),this._idPool.push(A)}},"syscall/js.stringVal":$=>{$>>>=0,r($+24,a($+8))},"syscall/js.valueGet":$=>{$>>>=0;let A=Reflect.get(P($+8),a($+16));$=this._inst.exports.getsp()>>>0,r($+32,A)},"syscall/js.valueSet":$=>{$>>>=0,Reflect.set(P($+8),a($+16),P($+32))},"syscall/js.valueDelete":$=>{$>>>=0,Reflect.deleteProperty(P($+8),a($+16))},"syscall/js.valueIndex":$=>{$>>>=0,r($+24,Reflect.get(P($+8),j($+16)))},"syscall/js.valueSetIndex":$=>{$>>>=0,Reflect.set(P($+8),j($+16),P($+24))},"syscall/js.valueCall":$=>{$>>>=0;try{let A=P($+8),e=Reflect.get(A,a($+16)),k=o($+32),B=Reflect.apply(e,A,k);$=this._inst.exports.getsp()>>>0,r($+56,B),this.mem.setUint8($+64,1)}catch(A){$=this._inst.exports.getsp()>>>0,r($+56,A),this.mem.setUint8($+64,0)}},"syscall/js.valueInvoke":$=>{$>>>=0;try{let A=P($+8),e=o($+16),k=Reflect.apply(A,void 0,e);$=this._inst.exports.getsp()>>>0,r($+40,k),this.mem.setUint8($+48,1)}catch(A){$=this._inst.exports.getsp()>>>0,r($+40,A),this.mem.setUint8($+48,0)}},"syscall/js.valueNew":$=>{$>>>=0;try{let A=P($+8),e=o($+16),k=Reflect.construct(A,e);$=this._inst.exports.getsp()>>>0,r($+40,k),this.mem.setUint8($+48,1)}catch(A){$=this._inst.exports.getsp()>>>0,r($+40,A),this.mem.setUint8($+48,0)}},"syscall/js.valueLength":$=>{$>>>=0,U($+16,parseInt(P($+8).length))},"syscall/js.valuePrepareString":$=>{$>>>=0;let A=G.encode(String(P($+8)));r($+16,A),U($+24,A.length)},"syscall/js.valueLoadString":$=>{$>>>=0;let A=P($+8);s($+16).set(A)},"syscall/js.valueInstanceOf":$=>{$>>>=0,this.mem.setUint8($+24,P($+8)instanceof P($+16)?1:0)},"syscall/js.copyBytesToGo":$=>{$>>>=0;let A=s($+8),e=P($+32);if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray)){this.mem.setUint8($+48,0);return}let k=e.subarray(0,A.length);A.set(k),U($+40,k.length),this.mem.setUint8($+48,1)},"syscall/js.copyBytesToJS":$=>{$>>>=0;let A=P($+8),e=s($+16);if(!(A instanceof Uint8Array||A instanceof Uint8ClampedArray)){this.mem.setUint8($+48,0);return}let k=e.subarray(0,A.length);A.set(k),U($+40,k.length),this.mem.setUint8($+48,1)},debug:$=>{console.log($)}}}}async run(U){if(!(U instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=U,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let S=4096,j=l=>{let c=S,$=G.encode(l+"\0");return new Uint8Array(this.mem.buffer,S,$.length).set($),S+=$.length,S%8!==0&&(S+=8-S%8),c},P=this.argv.length,r=[];this.argv.forEach(l=>{r.push(j(l))}),r.push(0),Object.keys(this.env).sort().forEach(l=>{r.push(j(`${l}=${this.env[l]}`))}),r.push(0);let o=S;if(r.forEach(l=>{this.mem.setUint32(S,l,!0),this.mem.setUint32(S+4,0,!0),S+=8}),S>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(P,o),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(U){let S=this;return function(){let j={id:U,this:this,args:arguments};return S._pendingEvent=j,S._resume(),j.result}}}})();var oA="./main.wasm";var pA=jA(aA()),lA=jA(sA()),gA=jA(cA());function fA(w,G,N,U,S){var $;let j=($=w.ownerDocument.defaultView)!=null?$:window,P=new pA.Terminal(rA({cursorBlink:!0,allowProposedApi:!0},S)),r=new lA.FitAddon;P.loadAddon(r),P.open(w),r.fit();let s=new gA.WebLinksAddon((A,e)=>{var k;return(k=A.view)==null?void 0:k.open(e,"_blank","noopener")});P.loadAddon(s);let o;P.onData(A=>{o==null||o(A)}),P.focus();let a,l,c=N.ssh(G.hostname,G.username,{writeFn(A){P.write(A)},writeErrorFn(A){var e;(e=U.onError)==null||e.call(U,A),P.write(A)},setReadFn(A){o=A},rows:P.rows,cols:P.cols,onConnectionProgress:U.onConnectionProgress,onConnected:U.onConnected,onDone(){a==null||a.disconnect(),P.dispose(),l&&j.removeEventListener("unload",l),U.onDone()},timeoutSeconds:G.timeoutSeconds});a=new j.ResizeObserver(()=>r.fit()),a.observe(w),P.onResize(({rows:A,cols:e})=>c.resize(A,e)),l=()=>c.close(),j.addEventListener("unload",l)}async function b7(w){var U;let G=new Go,N=await WebAssembly.instantiateStreaming(fetch((U=w.wasmURL)!=null?U:oA),G.importObject);return G.run(N.instance).then(()=>w.panicHandler("Unexpected shutdown")),newIPN(w)}export{b7 as createIPN,fA as runSSHSession};
//# sourceMappingURL=pkg.js.map
